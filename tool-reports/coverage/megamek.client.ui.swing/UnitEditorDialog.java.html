<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="nl"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UnitEditorDialog.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">PlayerTest Coverage Results</a> &gt; <a href="index.source.html" class="el_package">megamek.client.ui.swing</a> &gt; <span class="el_source">UnitEditorDialog.java</span></div><h1>UnitEditorDialog.java</h1><pre class="source lang-java linenums">/*
 * MechEditor.java - Copyright (C) 2013 Jay Lawson
 *
 *  This program is free software; you can redistribute it and/or modify it
 *  under the terms of the GNU General Public License as published by the Free
 *  Software Foundation; either version 2 of the License, or (at your option)
 *  any later version.
 *
 *  This program is distributed in the hope that it will be useful, but
 *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
 *  for more details.
 */

package megamek.client.ui.swing;

import java.awt.BorderLayout;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.GridLayout;
import java.awt.Insets;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;
import java.util.TreeMap;
import java.util.Vector;
import java.util.function.BiConsumer;

import javax.swing.BorderFactory;
import javax.swing.BoxLayout;
import javax.swing.JButton;
import javax.swing.JCheckBox;
import javax.swing.JDialog;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JSpinner;
import javax.swing.SpinnerNumberModel;

import megamek.client.ui.Messages;

import megamek.common.ASFBay;
import megamek.common.Aero;
import megamek.common.BattleArmor;
import megamek.common.Bay;
import megamek.common.CriticalSlot;
import megamek.common.DockingCollar;
import megamek.common.Dropship;
import megamek.common.Entity;
import megamek.common.IArmorState;
import megamek.common.Infantry;
import megamek.common.Jumpship;
import megamek.common.LandAirMech;
import megamek.common.Mech;
import megamek.common.Mounted;
import megamek.common.Protomech;
import megamek.common.QuadMech;
import megamek.common.QuadVee;
import megamek.common.SmallCraft;
import megamek.common.SmallCraftBay;
import megamek.common.Tank;
import megamek.common.VTOL;
import megamek.common.options.OptionsConstants;

/**
 *
 * @author Jay Lawson &lt;jaylawson39 at yahoo.com&gt; This dialog will allow the user
 *         to edit the damage and status characteristics of a unit This designed
 *         for use in both MegaMek and MHQ so don't go messing things up for MHQ
 *         by changing a bunch of stuff
 */
public class UnitEditorDialog extends JDialog {

    /**
     *
     */
    private static final long serialVersionUID = 8144354264100884817L;

    private Entity entity;

    JPanel panArmor;
    JPanel panSystem;
    JPanel panEquip;

    JSpinner[] spnInternal;
    JSpinner[] spnArmor;
    JSpinner[] spnRear;

    HashMap&lt;Integer, CheckCritPanel&gt; equipCrits;

    /* system crits */
    CheckCritPanel engineCrit;
    CheckCritPanel leftEngineCrit;
    CheckCritPanel rightEngineCrit;
    CheckCritPanel centerEngineCrit;
    CheckCritPanel gyroCrit;
    CheckCritPanel sensorCrit;
    CheckCritPanel lifeSupportCrit;
    CheckCritPanel cockpitCrit;
    Map&lt;Integer,CheckCritPanel&gt; lamAvionicsCrit;
    Map&lt;Integer,CheckCritPanel&gt; lamLandingGearCrit;
    CheckCritPanel[][] actuatorCrits;
    CheckCritPanel turretlockCrit;
    CheckCritPanel motiveCrit;
    CheckCritPanel[] stabilizerCrits;
    CheckCritPanel flightStabilizerCrit;
    CheckCritPanel avionicsCrit;
    CheckCritPanel fcsCrit;
    CheckCritPanel cicCrit;
    CheckCritPanel gearCrit;
    CheckCritPanel leftThrusterCrit;
    CheckCritPanel rightThrusterCrit;
    CheckCritPanel kfboomCrit;
    CheckCritPanel dockCollarCrit;
    CheckCritPanel gravDeckCrit;
    JSpinner[] bayDamage;
    CheckCritPanel[] bayDoorCrit;
    JSpinner collarDamage;
    JSpinner kfDamage;
    CheckCritPanel driveCoilCrit;
    CheckCritPanel chargingSystemCrit;
    CheckCritPanel fieldInitiatorCrit;
    CheckCritPanel driveControllerCrit;
    CheckCritPanel heliumTankCrit;
    CheckCritPanel lfBatteryCrit;
    JSpinner sailDamage;
    CheckCritPanel[] protoCrits;

    public UnitEditorDialog(JFrame parent, Entity m) {
<span class="nc" id="L133">        super(parent, true);</span>
<span class="nc" id="L134">        entity = m;</span>
<span class="nc" id="L135">        initComponents();</span>
<span class="nc" id="L136">        setLocationRelativeTo(parent);</span>
<span class="nc" id="L137">    }</span>

    private void initComponents() {
        GridBagConstraints gridBagConstraints;

<span class="nc" id="L142">        getContentPane().setLayout(new BorderLayout());</span>

<span class="nc" id="L144">        setTitle(&quot;Edit damage for &quot; + entity.getDisplayName());</span>

<span class="nc" id="L146">        JPanel panMain = new JPanel(new GridBagLayout());</span>
<span class="nc" id="L147">        JPanel panButtons = new JPanel(new GridLayout(1, 2));</span>

        // TODO: protomeks
<span class="nc" id="L150">        initArmorPanel();</span>
<span class="nc" id="L151">        initSystemPanel();</span>
<span class="nc" id="L152">        initEquipPanel();</span>

<span class="nc" id="L154">        gridBagConstraints = new GridBagConstraints();</span>
<span class="nc" id="L155">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L156">        gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L157">        gridBagConstraints.anchor = GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L158">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L159">        gridBagConstraints.weighty = 0.0;</span>
<span class="nc" id="L160">        gridBagConstraints.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L161">        panMain.add(panArmor, gridBagConstraints);</span>
<span class="nc bnc" id="L162" title="All 4 branches missed.">        if (!((entity instanceof Infantry) &amp;&amp; !(entity instanceof BattleArmor))) {</span>
<span class="nc" id="L163">            gridBagConstraints.gridy = 1;</span>
<span class="nc" id="L164">            gridBagConstraints.weighty = 1.0;</span>
<span class="nc" id="L165">            panMain.add(new JScrollPane(panSystem), gridBagConstraints);</span>
<span class="nc" id="L166">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L167">            gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L168">            gridBagConstraints.anchor = GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L169">            gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L170">            gridBagConstraints.gridheight = 2;</span>
<span class="nc" id="L171">            panMain.add(new JScrollPane(panEquip), gridBagConstraints);</span>
        }

<span class="nc" id="L174">        getContentPane().add(panMain, BorderLayout.CENTER);</span>

<span class="nc" id="L176">        JButton butOK = new JButton(Messages.getString(&quot;Okay&quot;));</span>
<span class="nc" id="L177">        butOK.addActionListener(new java.awt.event.ActionListener() {</span>
            public void actionPerformed(java.awt.event.ActionEvent evt) {
<span class="nc" id="L179">                btnOkayActionPerformed(evt);</span>
<span class="nc" id="L180">                setVisible(false);</span>
<span class="nc" id="L181">            }</span>
        });
<span class="nc" id="L183">        JButton butCancel = new JButton(Messages.getString(&quot;Cancel&quot;));</span>
<span class="nc" id="L184">        butCancel.addActionListener(new java.awt.event.ActionListener() {</span>
            public void actionPerformed(java.awt.event.ActionEvent evt) {
<span class="nc" id="L186">                setVisible(false);</span>
<span class="nc" id="L187">            }</span>
        });

<span class="nc" id="L190">        panButtons.add(butOK);</span>
<span class="nc" id="L191">        panButtons.add(butCancel);</span>

<span class="nc" id="L193">        getContentPane().add(panButtons, BorderLayout.PAGE_END);</span>

        // TODO: size right

<span class="nc" id="L197">        pack();</span>
<span class="nc" id="L198">    }</span>

    private void initArmorPanel() {
<span class="nc bnc" id="L201" title="All 2 branches missed.">        if (entity instanceof Aero) {</span>
<span class="nc" id="L202">            initAeroArmorPanel();</span>
<span class="nc" id="L203">            return;</span>
<span class="nc bnc" id="L204" title="All 4 branches missed.">        } else if ((entity instanceof Infantry)</span>
                &amp;&amp; !(entity instanceof BattleArmor)) {
<span class="nc" id="L206">            initInfantryArmorPanel();</span>
<span class="nc" id="L207">            return;</span>
        }

        GridBagConstraints gridBagConstraints;

<span class="nc" id="L212">        panArmor = new JPanel(new GridBagLayout());</span>
<span class="nc" id="L213">        panArmor.setBorder(BorderFactory</span>
<span class="nc" id="L214">                .createTitledBorder(Messages.getString(&quot;UnitEditorDialog.internalsAndArmor&quot;)));</span>

<span class="nc" id="L216">        spnArmor = new JSpinner[entity.locations()];</span>
<span class="nc" id="L217">        spnInternal = new JSpinner[entity.locations()];</span>
<span class="nc" id="L218">        spnRear = new JSpinner[entity.locations()];</span>

<span class="nc" id="L220">        gridBagConstraints = new GridBagConstraints();</span>
<span class="nc" id="L221">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L222">        gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L223">        gridBagConstraints.insets = new Insets(1, 10, 1, 1);</span>
<span class="nc" id="L224">        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;</span>
<span class="nc" id="L225">        panArmor.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.location&quot;) + &quot;&lt;/b&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L227">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L228">        panArmor.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.internal&quot;) + &quot;&lt;/b&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L230">        gridBagConstraints.gridx = 2;</span>
<span class="nc" id="L231">        panArmor.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.frontArmor&quot;) + &quot;&lt;/b&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L233">        gridBagConstraints.gridx = 3;</span>
<span class="nc" id="L234">        panArmor.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.rearArmor&quot;) + &quot;&lt;/b&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);

<span class="nc bnc" id="L237" title="All 2 branches missed.">        for (int i = 0; i &lt; entity.locations(); i++) {</span>
            // some units have hidden locations, skip these
<span class="nc bnc" id="L239" title="All 2 branches missed.">            if (entity.getOInternal(i) &lt;= 0) {</span>
<span class="nc" id="L240">                continue;</span>
            }
<span class="nc" id="L242">            int internal = Math.max(entity.getInternal(i), 0);</span>
<span class="nc" id="L243">            int armor = Math.max(entity.getArmor(i, false), 0);</span>
<span class="nc" id="L244">            spnArmor[i] = new JSpinner(new SpinnerNumberModel(armor, 0,</span>
<span class="nc" id="L245">                    entity.getOArmor(i), 1));</span>
<span class="nc" id="L246">            spnInternal[i] = new JSpinner(new SpinnerNumberModel(internal, 0,</span>
<span class="nc" id="L247">                    entity.getOInternal(i), 1));</span>
<span class="nc" id="L248">            gridBagConstraints = new GridBagConstraints();</span>
<span class="nc" id="L249">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L250">            gridBagConstraints.gridy = i + 1;</span>
<span class="nc" id="L251">            gridBagConstraints.insets = new Insets(1, 10, 1, 1);</span>
<span class="nc" id="L252">            gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;</span>
<span class="nc" id="L253">            panArmor.add(new JLabel(entity.getLocationName(i)),</span>
                    gridBagConstraints);
<span class="nc" id="L255">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L256">            panArmor.add(spnInternal[i], gridBagConstraints);</span>
<span class="nc" id="L257">            gridBagConstraints.gridx = 2;</span>
<span class="nc" id="L258">            panArmor.add(spnArmor[i], gridBagConstraints);</span>
<span class="nc bnc" id="L259" title="All 2 branches missed.">            if (entity.hasRearArmor(i)) {</span>
<span class="nc" id="L260">                int rear = Math.max(entity.getArmor(i, true), 0);</span>
<span class="nc" id="L261">                spnRear[i] = new JSpinner(new SpinnerNumberModel(rear, 0,</span>
<span class="nc" id="L262">                        entity.getOArmor(i, true), 1));</span>
<span class="nc" id="L263">                gridBagConstraints.gridx = 3;</span>
<span class="nc" id="L264">                panArmor.add(spnRear[i], gridBagConstraints);</span>
            }
        }
<span class="nc" id="L267">    }</span>

    private void initAeroArmorPanel() {
        GridBagConstraints gridBagConstraints;

<span class="nc" id="L272">        Aero aero = (Aero) entity;</span>

<span class="nc" id="L274">        panArmor = new JPanel(new GridBagLayout());</span>
<span class="nc" id="L275">        panArmor.setBorder(BorderFactory.createTitledBorder(Messages.getString(&quot;UnitEditorDialog.siAndArmor&quot;)));</span>

<span class="nc" id="L277">        spnArmor = new JSpinner[entity.locations()];</span>
<span class="nc" id="L278">        spnInternal = new JSpinner[entity.locations()];</span>
<span class="nc" id="L279">        spnRear = new JSpinner[entity.locations()];</span>

<span class="nc" id="L281">        gridBagConstraints = new GridBagConstraints();</span>
<span class="nc" id="L282">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L283">        gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L284">        gridBagConstraints.insets = new Insets(1, 10, 1, 1);</span>
<span class="nc" id="L285">        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;</span>
<span class="nc" id="L286">        panArmor.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.location&quot;) + &quot;&lt;/b&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L288">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L289">        panArmor.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.points&quot;) + &quot;&lt;/b&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);

<span class="nc" id="L292">        int si = Math.max(aero.getSI(), 0);</span>
<span class="nc" id="L293">        spnInternal[0] = new JSpinner(new SpinnerNumberModel(si, 0,</span>
<span class="nc" id="L294">                aero.get0SI(), 1));</span>
<span class="nc" id="L295">        gridBagConstraints = new GridBagConstraints();</span>
<span class="nc" id="L296">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L297">        gridBagConstraints.gridy = 1;</span>
<span class="nc" id="L298">        gridBagConstraints.insets = new Insets(1, 10, 1, 1);</span>
<span class="nc" id="L299">        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;</span>
<span class="nc" id="L300">        panArmor.add(new JLabel(Messages.getString(&quot;UnitEditorDialog.structuralIntegrity&quot;)), gridBagConstraints);</span>
<span class="nc" id="L301">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L302">        panArmor.add(spnInternal[0], gridBagConstraints);</span>

<span class="nc bnc" id="L304" title="All 2 branches missed.">        for (int i = 0; i &lt; entity.locations(); i++) {</span>
            // some units have hidden locations, skip these
<span class="nc bnc" id="L306" title="All 2 branches missed.">            if (entity.getOArmor(i) &lt;= 0) {</span>
<span class="nc" id="L307">                continue;</span>
            }
<span class="nc" id="L309">            int armor = Math.max(entity.getArmor(i, false), 0);</span>
<span class="nc" id="L310">            spnArmor[i] = new JSpinner(new SpinnerNumberModel(armor, 0,</span>
<span class="nc" id="L311">                    entity.getOArmor(i), 1));</span>
<span class="nc" id="L312">            gridBagConstraints = new GridBagConstraints();</span>
<span class="nc" id="L313">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L314">            gridBagConstraints.gridy = i + 2;</span>
<span class="nc" id="L315">            gridBagConstraints.insets = new Insets(1, 10, 1, 1);</span>
<span class="nc" id="L316">            gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;</span>
<span class="nc" id="L317">            panArmor.add(new JLabel(entity.getLocationName(i)),</span>
                    gridBagConstraints);
<span class="nc" id="L319">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L320">            panArmor.add(spnArmor[i], gridBagConstraints);</span>
        }
<span class="nc" id="L322">    }</span>

    private void initInfantryArmorPanel() {
        GridBagConstraints gridBagConstraints;

<span class="nc" id="L327">        Infantry infantry = (Infantry) entity;</span>

<span class="nc" id="L329">        panArmor = new JPanel(new GridBagLayout());</span>
<span class="nc" id="L330">        panArmor.setBorder(BorderFactory.createTitledBorder(Messages.getString(&quot;UnitEditorDialog.troopersLeft&quot;)));</span>

<span class="nc" id="L332">        spnArmor = new JSpinner[entity.locations()];</span>
<span class="nc" id="L333">        spnInternal = new JSpinner[entity.locations()];</span>
<span class="nc" id="L334">        spnRear = new JSpinner[entity.locations()];</span>

<span class="nc" id="L336">        int men = Math.max(infantry.getShootingStrength(), 0);</span>
<span class="nc" id="L337">        spnInternal[0] = new JSpinner(new SpinnerNumberModel(men, 0,</span>
<span class="nc" id="L338">                infantry.getSquadN() * infantry.getSquadSize(), 1));</span>
<span class="nc" id="L339">        gridBagConstraints = new GridBagConstraints();</span>
<span class="nc" id="L340">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L341">        gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L342">        gridBagConstraints.insets = new Insets(1, 10, 1, 1);</span>
<span class="nc" id="L343">        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;</span>
<span class="nc" id="L344">        panArmor.add(new JLabel(Messages.getString(&quot;UnitEditorDialog.menLeft&quot;)), gridBagConstraints);</span>
<span class="nc" id="L345">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L346">        panArmor.add(spnInternal[0], gridBagConstraints);</span>
<span class="nc" id="L347">    }</span>

    private void initEquipPanel() {
<span class="nc" id="L350">        equipCrits = new HashMap&lt;Integer, CheckCritPanel&gt;();</span>
<span class="nc" id="L351">        panEquip = new JPanel();</span>
<span class="nc" id="L352">        panEquip.setLayout(new GridBagLayout());</span>
<span class="nc" id="L353">        panEquip.setBorder(BorderFactory.createTitledBorder(Messages.getString(&quot;UnitEditorDialog.equipment&quot;)));</span>
<span class="nc" id="L354">        GridBagConstraints gridBagConstraints = new GridBagConstraints();</span>
<span class="nc" id="L355">        gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L356">        gridBagConstraints.insets = new Insets(2, 2, 2, 2);</span>
<span class="nc" id="L357">        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;</span>
<span class="nc bnc" id="L358" title="All 2 branches missed.">        for (Mounted m : entity.getEquipment()) {</span>
<span class="nc bnc" id="L359" title="All 2 branches missed.">            if ((m.getLocation() == Entity.LOC_NONE)</span>
<span class="nc bnc" id="L360" title="All 4 branches missed.">                    || !m.getType().isHittable() || m.isWeaponGroup()) {</span>
<span class="nc" id="L361">                continue;</span>
            }
<span class="nc" id="L363">            int nCrits = m.getCriticals();</span>
<span class="nc" id="L364">            int eqNum = entity.getEquipmentNum(m);</span>
<span class="nc" id="L365">            int hits = entity.getDamagedCriticals(CriticalSlot.TYPE_EQUIPMENT,</span>
<span class="nc" id="L366">                    eqNum, m.getLocation());</span>
<span class="nc bnc" id="L367" title="All 2 branches missed.">            if (m.isSplit()) {</span>
<span class="nc" id="L368">                hits += entity.getDamagedCriticals(CriticalSlot.TYPE_EQUIPMENT,</span>
<span class="nc" id="L369">                        eqNum, m.getSecondLocation());</span>
            }
<span class="nc bnc" id="L371" title="All 2 branches missed.">            if (!(entity instanceof Mech)) {</span>
<span class="nc" id="L372">                nCrits = 1;</span>
<span class="nc bnc" id="L373" title="All 2 branches missed.">                if (hits &gt; 1) {</span>
<span class="nc" id="L374">                    hits = 1;</span>
                }
            }
<span class="nc" id="L377">            CheckCritPanel crit = new CheckCritPanel(nCrits, hits);</span>
<span class="nc" id="L378">            equipCrits.put(eqNum, crit);</span>
<span class="nc" id="L379">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L380">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L381">            gridBagConstraints.weighty = 0.0;</span>
<span class="nc" id="L382">            gridBagConstraints.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L383">            panEquip.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + m.getName() + &quot;&lt;/b&gt;&lt;br&gt;&quot;</span>
<span class="nc" id="L384">                    + entity.getLocationName(m.getLocation()) + &quot;&lt;/html&gt;&quot;),</span>
                    gridBagConstraints);
<span class="nc" id="L386">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L387">            gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L388">            panEquip.add(crit, gridBagConstraints);</span>
<span class="nc" id="L389">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L390">        }</span>
<span class="nc" id="L391">    }</span>

    private void initSystemPanel() {

        // systems are the hard part, because these are all unit specific
        // lets start with a mech
<span class="nc" id="L397">        panSystem = new JPanel(new GridBagLayout());</span>
<span class="nc" id="L398">        panSystem.setBorder(BorderFactory.createTitledBorder(Messages.getString(&quot;UnitEditorDialog.system&quot;)));</span>

<span class="nc bnc" id="L400" title="All 2 branches missed.">        if (entity instanceof Mech) {</span>
<span class="nc" id="L401">            setupMechSystemPanel();</span>
<span class="nc bnc" id="L402" title="All 2 branches missed.">        } else if (entity instanceof VTOL) {</span>
<span class="nc" id="L403">            setupVtolSystemPanel();</span>
<span class="nc bnc" id="L404" title="All 2 branches missed.">        } else if (entity instanceof Tank) {</span>
<span class="nc" id="L405">            setupTankSystemPanel();</span>
<span class="nc bnc" id="L406" title="All 2 branches missed.">        } else if (entity instanceof Aero) {</span>
<span class="nc" id="L407">            setupAeroSystemPanel();</span>
<span class="nc bnc" id="L408" title="All 2 branches missed.">        } else if (entity instanceof Protomech) {</span>
<span class="nc" id="L409">            setupProtoSystemPanel();</span>
        }
<span class="nc" id="L411">    }</span>

    private void setupMechSystemPanel() {
<span class="nc" id="L414">        GridBagConstraints gridBagConstraints = new GridBagConstraints();</span>
        /*
         * For the moment, I am going to cap out the number of hits at what the
         * record sheets show (i.e. 3 for engines). If we want to switch this to
         * the actual number then we can, see
         * enginePart.updateConditionFromEntity in MekHQ for an example of how
         * to retrieve all of the available system crits
         */
<span class="nc" id="L422">        int centerEngineHits = 0;</span>
<span class="nc" id="L423">        int leftEngineHits = 0;</span>
<span class="nc" id="L424">        int rightEngineHits = 0;</span>
<span class="nc" id="L425">        int gyroHits = 0;</span>
<span class="nc" id="L426">        int cockpitHits = 0;</span>
<span class="nc" id="L427">        int sensorHits = 0;</span>
<span class="nc" id="L428">        int lifeSupportHits = 0;</span>

<span class="nc" id="L430">        int centerEngineCrits = 0;</span>
<span class="nc" id="L431">        int leftEngineCrits = 0;</span>
<span class="nc" id="L432">        int rightEngineCrits = 0;</span>
<span class="nc" id="L433">        int gyroCrits = 0;</span>
<span class="nc" id="L434">        int cockpitCrits = 0;</span>
<span class="nc" id="L435">        int sensorCrits = 0;</span>
<span class="nc" id="L436">        int lifeSupportCrits = 0;</span>
<span class="nc bnc" id="L437" title="All 2 branches missed.">        for (int i = 0; i &lt; entity.locations(); i++) {</span>
<span class="nc bnc" id="L438" title="All 2 branches missed.">            if (i == Mech.LOC_CT) {</span>
<span class="nc" id="L439">                centerEngineHits = entity.getDamagedCriticals(</span>
                        CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_ENGINE, i);
<span class="nc" id="L441">                centerEngineCrits = entity.getNumberOfCriticals(</span>
                        CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_ENGINE, i);
            }
<span class="nc bnc" id="L444" title="All 2 branches missed.">            if (i == Mech.LOC_LT) {</span>
<span class="nc" id="L445">                leftEngineHits = entity.getDamagedCriticals(</span>
                        CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_ENGINE, i);
<span class="nc" id="L447">                leftEngineCrits = entity.getNumberOfCriticals(</span>
                        CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_ENGINE, i);
            }
<span class="nc bnc" id="L450" title="All 2 branches missed.">            if (i == Mech.LOC_RT) {</span>
<span class="nc" id="L451">                rightEngineHits = entity.getDamagedCriticals(</span>
                        CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_ENGINE, i);
<span class="nc" id="L453">                rightEngineCrits = entity.getNumberOfCriticals(</span>
                        CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_ENGINE, i);
            }
<span class="nc" id="L456">            gyroHits += entity.getDamagedCriticals(CriticalSlot.TYPE_SYSTEM,</span>
                    Mech.SYSTEM_GYRO, i);
<span class="nc" id="L458">            gyroCrits += entity.getNumberOfCriticals(CriticalSlot.TYPE_SYSTEM,</span>
                    Mech.SYSTEM_GYRO, i);
<span class="nc" id="L460">            cockpitHits += entity.getDamagedCriticals(CriticalSlot.TYPE_SYSTEM,</span>
                    Mech.SYSTEM_COCKPIT, i);
<span class="nc" id="L462">            cockpitCrits += entity.getNumberOfCriticals(</span>
                    CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_COCKPIT, i);
<span class="nc" id="L464">            sensorHits += entity.getDamagedCriticals(CriticalSlot.TYPE_SYSTEM,</span>
                    Mech.SYSTEM_SENSORS, i);
<span class="nc" id="L466">            sensorCrits += entity.getNumberOfCriticals(</span>
                    CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_SENSORS, i);
<span class="nc" id="L468">            lifeSupportHits += entity.getDamagedCriticals(</span>
                    CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_LIFE_SUPPORT, i);
<span class="nc" id="L470">            lifeSupportCrits += entity.getNumberOfCriticals(</span>
                    CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_LIFE_SUPPORT, i);
        }
<span class="nc" id="L473">        gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L474">        gridBagConstraints.insets = new Insets(2, 2, 2, 2);</span>
<span class="nc" id="L475">        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L476">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L477">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L478">        gridBagConstraints.weighty = 0.0;</span>
<span class="nc" id="L479">        gridBagConstraints.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L480">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.engine&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L482">        centerEngineCrit = new CheckCritPanel(centerEngineCrits,</span>
                centerEngineHits);
<span class="nc" id="L484">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L485">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L486">        panSystem.add(centerEngineCrit, gridBagConstraints);</span>

<span class="nc bnc" id="L488" title="All 2 branches missed.">        if (entity.getNumberOfCriticals(CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_ENGINE, Mech.LOC_RT) &gt; 0) {</span>
<span class="nc" id="L489">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L490">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L491">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L492">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.engineLT&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                    gridBagConstraints);
<span class="nc" id="L494">            leftEngineCrit = new CheckCritPanel(leftEngineCrits, leftEngineHits);</span>
<span class="nc" id="L495">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L496">            gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L497">            panSystem.add(leftEngineCrit, gridBagConstraints);</span>
    
<span class="nc" id="L499">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L500">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L501">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L502">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.engineRT&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                    gridBagConstraints);
<span class="nc" id="L504">            rightEngineCrit = new CheckCritPanel(rightEngineCrits, rightEngineHits);</span>
<span class="nc" id="L505">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L506">            gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L507">            panSystem.add(rightEngineCrit, gridBagConstraints);</span>
        }

<span class="nc" id="L510">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L511">        gridBagConstraints.gridy++;</span>
<span class="nc" id="L512">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L513">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.gyro&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L515">        gyroCrit = new CheckCritPanel(gyroCrits, gyroHits);</span>
<span class="nc" id="L516">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L517">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L518">        panSystem.add(gyroCrit, gridBagConstraints);</span>

<span class="nc" id="L520">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L521">        gridBagConstraints.gridy++;</span>
<span class="nc" id="L522">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L523">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.sensor&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L525">        sensorCrit = new CheckCritPanel(sensorCrits, sensorHits);</span>
<span class="nc" id="L526">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L527">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L528">        panSystem.add(sensorCrit, gridBagConstraints);</span>

<span class="nc" id="L530">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L531">        gridBagConstraints.gridy++;</span>
<span class="nc" id="L532">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L533">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.lifeSupport&quot;)</span>
                + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L535">        lifeSupportCrit = new CheckCritPanel(lifeSupportCrits, lifeSupportHits);</span>
<span class="nc" id="L536">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L537">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L538">        panSystem.add(lifeSupportCrit, gridBagConstraints);</span>

<span class="nc" id="L540">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L541">        gridBagConstraints.gridy++;</span>
<span class="nc" id="L542">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L543">        gridBagConstraints.weighty = 0.0;</span>
<span class="nc" id="L544">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.cockpit&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L546">        cockpitCrit = new CheckCritPanel(cockpitCrits, cockpitHits);</span>
<span class="nc" id="L547">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L548">        panSystem.add(cockpitCrit, gridBagConstraints);</span>
        
<span class="nc bnc" id="L550" title="All 2 branches missed.">        if (entity instanceof LandAirMech) {</span>
<span class="nc" id="L551">            lamAvionicsCrit = new TreeMap&lt;&gt;();</span>
<span class="nc" id="L552">            lamLandingGearCrit = new TreeMap&lt;&gt;();</span>
<span class="nc bnc" id="L553" title="All 2 branches missed.">            for (int loc = 0; loc &lt; entity.locations(); loc++) {</span>
<span class="nc" id="L554">                int crits = entity.getNumberOfCriticals(CriticalSlot.TYPE_SYSTEM, LandAirMech.LAM_AVIONICS, loc);</span>
<span class="nc bnc" id="L555" title="All 2 branches missed.">                if (crits &gt; 0) {</span>
<span class="nc" id="L556">                    int hits = entity.getBadCriticals(CriticalSlot.TYPE_SYSTEM, LandAirMech.LAM_AVIONICS, loc);</span>
<span class="nc" id="L557">                    CheckCritPanel critPanel = new CheckCritPanel(crits, hits);</span>
<span class="nc" id="L558">                    lamAvionicsCrit.put(loc, critPanel);</span>
                }
<span class="nc" id="L560">                crits = entity.getNumberOfCriticals(CriticalSlot.TYPE_SYSTEM, LandAirMech.LAM_LANDING_GEAR, loc);</span>
<span class="nc bnc" id="L561" title="All 2 branches missed.">                if (crits &gt; 0) {</span>
<span class="nc" id="L562">                    int hits = entity.getBadCriticals(CriticalSlot.TYPE_SYSTEM, LandAirMech.LAM_LANDING_GEAR, loc);</span>
<span class="nc" id="L563">                    CheckCritPanel critPanel = new CheckCritPanel(crits, hits);</span>
<span class="nc" id="L564">                    lamLandingGearCrit.put(loc, critPanel);</span>
                }
            }
<span class="nc" id="L567">            BiConsumer&lt;Map.Entry&lt;Integer,CheckCritPanel&gt;, String&gt; addToPanel = (entry, critName) -&gt; {</span>
<span class="nc" id="L568">                gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L569">                gridBagConstraints.gridy++;</span>
<span class="nc" id="L570">                gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L571">                panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + </span>
<span class="nc" id="L572">                        String.format(Messages.getString(&quot;UnitEditorDialog.critStringLocation&quot;), critName, entity.getLocationAbbr(entry.getKey())) </span>
                        + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),
                        gridBagConstraints);
<span class="nc" id="L575">                gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L576">                gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L577">                panSystem.add(entry.getValue(), gridBagConstraints);</span>
<span class="nc" id="L578">            };</span>
<span class="nc" id="L579">            lamAvionicsCrit.entrySet().forEach(e -&gt; addToPanel.accept(e, Messages.getString(&quot;UnitEditorDialog.avionics&quot;)));</span>
<span class="nc" id="L580">            lamLandingGearCrit.entrySet().forEach(e -&gt; addToPanel.accept(e, Messages.getString(&quot;UnitEditorDialog.landingGear&quot;)));</span>
        }

<span class="nc bnc" id="L583" title="All 2 branches missed.">        if (entity instanceof QuadVee) {</span>
<span class="nc" id="L584">            actuatorCrits = new CheckCritPanel[4][5];</span>
        } else {
<span class="nc" id="L586">            actuatorCrits = new CheckCritPanel[4][4];</span>
        }

<span class="nc bnc" id="L589" title="All 2 branches missed.">        for (int loc = Mech.LOC_RARM; loc &lt;= Mech.LOC_LLEG; loc++) {</span>
<span class="nc" id="L590">            int start = Mech.ACTUATOR_SHOULDER;</span>
<span class="nc" id="L591">            int end = Mech.ACTUATOR_HAND;</span>
<span class="nc bnc" id="L592" title="All 4 branches missed.">            if ((loc &gt;= Mech.LOC_RLEG) || (entity instanceof QuadMech)) {</span>
<span class="nc" id="L593">                start = Mech.ACTUATOR_HIP;</span>
<span class="nc" id="L594">                end = Mech.ACTUATOR_FOOT;</span>
            }
<span class="nc bnc" id="L596" title="All 2 branches missed.">            for (int i = start; i &lt;= end; i++) {</span>
<span class="nc bnc" id="L597" title="All 2 branches missed.">                if (!entity.hasSystem(i, loc)) {</span>
<span class="nc" id="L598">                    continue;</span>
                }
<span class="nc" id="L600">                gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L601">                gridBagConstraints.gridy++;</span>
<span class="nc" id="L602">                gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L603">                gridBagConstraints.weighty = 0.0;</span>
<span class="nc bnc" id="L604" title="All 6 branches missed.">                if ((loc == Mech.LOC_LLEG) &amp;&amp; (i == end) &amp;&amp; !(entity instanceof QuadVee)) {</span>
<span class="nc" id="L605">                    gridBagConstraints.weighty = 1.0;</span>
                }
<span class="nc" id="L607">                panSystem.add(</span>
                        new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + 
<span class="nc" id="L609">                                String.format(Messages.getString(&quot;UnitEditorDialog.critString&quot;), </span>
<span class="nc" id="L610">                                        entity.getLocationName(loc), </span>
<span class="nc" id="L611">                                        ((Mech) entity).getSystemName(i))</span>
                                + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L613">                CheckCritPanel actuatorCrit = new CheckCritPanel(1,</span>
<span class="nc" id="L614">                        entity.getDamagedCriticals(CriticalSlot.TYPE_SYSTEM, i,</span>
                                loc));
<span class="nc" id="L616">                actuatorCrits[loc - Mech.LOC_RARM][i - start] = actuatorCrit;</span>
<span class="nc" id="L617">                gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L618">                panSystem.add(actuatorCrit, gridBagConstraints);</span>
            }
<span class="nc bnc" id="L620" title="All 2 branches missed.">            if (entity instanceof QuadVee) {</span>
<span class="nc" id="L621">                gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L622">                gridBagConstraints.gridy++;</span>
<span class="nc" id="L623">                gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L624">                gridBagConstraints.weighty = 0.0;</span>
<span class="nc bnc" id="L625" title="All 2 branches missed.">                if (loc == Mech.LOC_LLEG) {</span>
<span class="nc" id="L626">                    gridBagConstraints.weighty = 1.0;</span>
                }
<span class="nc" id="L628">                panSystem.add(</span>
                        new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + 
<span class="nc" id="L630">                                String.format(Messages.getString(&quot;UnitEditorDialog.critString&quot;), </span>
<span class="nc" id="L631">                                        entity.getLocationName(loc), </span>
<span class="nc" id="L632">                                        ((Mech) entity).getSystemName(QuadVee.SYSTEM_CONVERSION_GEAR))</span>
                                + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L634">                CheckCritPanel actuatorCrit = new CheckCritPanel(1,</span>
<span class="nc" id="L635">                        entity.getDamagedCriticals(CriticalSlot.TYPE_SYSTEM, QuadVee.SYSTEM_CONVERSION_GEAR,</span>
                                loc));
<span class="nc" id="L637">                actuatorCrits[loc - Mech.LOC_RARM][Mech.ACTUATOR_FOOT - Mech.ACTUATOR_HIP + 1] = actuatorCrit;</span>
<span class="nc" id="L638">                gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L639">                panSystem.add(actuatorCrit, gridBagConstraints);</span>
            }
        }

<span class="nc" id="L643">    }</span>

    private void setupTankSystemPanel() {
<span class="nc" id="L646">        GridBagConstraints gridBagConstraints = new GridBagConstraints();</span>

<span class="nc" id="L648">        Tank tank = (Tank) entity;</span>

<span class="nc" id="L650">        gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L651">        gridBagConstraints.insets = new Insets(2, 2, 2, 2);</span>
<span class="nc" id="L652">        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L653">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L654">        gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L655">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L656">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.turretLock&quot;)</span>
                + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L658">        int lock = 0;</span>
<span class="nc bnc" id="L659" title="All 2 branches missed.">        if (tank.isTurretLocked(0)) {</span>
<span class="nc" id="L660">            lock = 1;</span>
        }
<span class="nc" id="L662">        turretlockCrit = new CheckCritPanel(1, lock);</span>
<span class="nc" id="L663">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L664">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L665">        panSystem.add(turretlockCrit, gridBagConstraints);</span>

<span class="nc" id="L667">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L668">        gridBagConstraints.gridy = 1;</span>
<span class="nc" id="L669">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L670">        gridBagConstraints.weighty = 0.0;</span>
<span class="nc" id="L671">        gridBagConstraints.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L672">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.engine&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L674">        engineCrit = new CheckCritPanel(1, tank.getEngineHits());</span>
<span class="nc" id="L675">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L676">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L677">        panSystem.add(engineCrit, gridBagConstraints);</span>

<span class="nc" id="L679">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L680">        gridBagConstraints.gridy = 2;</span>
<span class="nc" id="L681">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L682">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.sensor&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L684">        sensorCrit = new CheckCritPanel(4, tank.getSensorHits());</span>
<span class="nc" id="L685">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L686">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L687">        panSystem.add(sensorCrit, gridBagConstraints);</span>

<span class="nc" id="L689">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L690">        gridBagConstraints.gridy = 3;</span>
<span class="nc" id="L691">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L692">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.motiveDamage&quot;)</span>
                + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L694">        int motiveHits = 0;</span>
        // Do not check the crew when determining if we're immobile here
<span class="nc bnc" id="L696" title="All 2 branches missed.">        if (tank.isImmobile(false)) {</span>
<span class="nc" id="L697">            motiveHits = 4;</span>
<span class="nc bnc" id="L698" title="All 2 branches missed.">        } else if (tank.hasHeavyMovementDamage()) {</span>
<span class="nc" id="L699">            motiveHits = 3;</span>
<span class="nc bnc" id="L700" title="All 2 branches missed.">        } else if (tank.hasModerateMovementDamage()) {</span>
<span class="nc" id="L701">            motiveHits = 2;</span>
<span class="nc bnc" id="L702" title="All 2 branches missed.">        } else if (tank.hasMinorMovementDamage()) {</span>
<span class="nc" id="L703">            motiveHits = 1;</span>
        }
<span class="nc" id="L705">        motiveCrit = new CheckCritPanel(4, motiveHits);</span>
<span class="nc" id="L706">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L707">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L708">        panSystem.add(motiveCrit, gridBagConstraints);</span>

<span class="nc" id="L710">        stabilizerCrits = new CheckCritPanel[tank.locations()];</span>
<span class="nc bnc" id="L711" title="All 2 branches missed.">        for (int loc = 0; loc &lt; tank.locations(); loc++) {</span>
<span class="nc bnc" id="L712" title="All 4 branches missed.">            if ((loc == Tank.LOC_BODY) || (loc == tank.getLocTurret())</span>
<span class="nc bnc" id="L713" title="All 2 branches missed.">                    || (loc == tank.getLocTurret2())) {</span>
<span class="nc" id="L714">                continue;</span>
            }
<span class="nc" id="L716">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L717">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L718">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L719">            gridBagConstraints.weighty = 0.0;</span>
<span class="nc bnc" id="L720" title="All 2 branches missed.">            if (loc == (tank.locations() - 1)) {</span>
<span class="nc" id="L721">                gridBagConstraints.weighty = 1.0;</span>
            }
<span class="nc" id="L723">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + </span>
<span class="nc" id="L724">                    String.format(Messages.getString(&quot;UnitEditorDialog.locationStabilizer&quot;), entity.getLocationName(loc)) </span>
                    + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L726">            int hits = 0;</span>
<span class="nc bnc" id="L727" title="All 2 branches missed.">            if (tank.isStabiliserHit(loc)) {</span>
<span class="nc" id="L728">                hits = 1;</span>
            }
<span class="nc" id="L730">            CheckCritPanel stabCrit = new CheckCritPanel(1, hits);</span>
<span class="nc" id="L731">            stabilizerCrits[loc] = stabCrit;</span>
<span class="nc" id="L732">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L733">            panSystem.add(stabCrit, gridBagConstraints);</span>
        }

<span class="nc" id="L736">    }</span>

    private void setupProtoSystemPanel() {
<span class="nc" id="L739">        GridBagConstraints gridBagConstraints = new GridBagConstraints();</span>

<span class="nc" id="L741">        Protomech proto = (Protomech) entity;</span>

<span class="nc" id="L743">        protoCrits = new CheckCritPanel[proto.locations()];</span>
<span class="nc" id="L744">        gridBagConstraints.gridy = 0;</span>

<span class="nc bnc" id="L746" title="All 2 branches missed.">        for (int loc = 0; loc &lt; proto.locations(); loc++) {</span>
<span class="nc bnc" id="L747" title="All 4 branches missed.">            if ((loc == Protomech.LOC_MAINGUN) || (loc == Protomech.LOC_NMISS)) {</span>
<span class="nc" id="L748">                continue;</span>
            }
<span class="nc" id="L750">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L751">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L752">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L753">            gridBagConstraints.weighty = 0.0;</span>
<span class="nc bnc" id="L754" title="All 2 branches missed.">            if (loc == (proto.locations() - 1)) {</span>
<span class="nc" id="L755">                gridBagConstraints.weighty = 1.0;</span>
            }
<span class="nc" id="L757">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + </span>
<span class="nc" id="L758">                    String.format(Messages.getString(&quot;UnitEditorDialog.protoCritString&quot;), entity.getLocationName(loc))  </span>
                    + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L760">            int hits = 0;</span>
<span class="nc bnc" id="L761" title="All 4 branches missed.">            if ((loc == Protomech.LOC_LARM) || (loc == Protomech.LOC_RARM)) {</span>
<span class="nc" id="L762">                hits = entity.getDamagedCriticals(CriticalSlot.TYPE_SYSTEM,</span>
                        Protomech.SYSTEM_ARMCRIT, loc);
            }
<span class="nc bnc" id="L765" title="All 2 branches missed.">            if (loc == Protomech.LOC_LEG) {</span>
<span class="nc" id="L766">                hits = entity.getDamagedCriticals(CriticalSlot.TYPE_SYSTEM,</span>
                        Protomech.SYSTEM_LEGCRIT, loc);
            }
<span class="nc bnc" id="L769" title="All 2 branches missed.">            if (loc == Protomech.LOC_HEAD) {</span>
<span class="nc" id="L770">                hits = entity.getDamagedCriticals(CriticalSlot.TYPE_SYSTEM,</span>
                        Protomech.SYSTEM_HEADCRIT, loc);
            }
<span class="nc bnc" id="L773" title="All 2 branches missed.">            if (loc == Protomech.LOC_TORSO) {</span>
<span class="nc" id="L774">                hits = entity.getDamagedCriticals(CriticalSlot.TYPE_SYSTEM,</span>
                        Protomech.SYSTEM_TORSOCRIT, loc);
            }
<span class="nc" id="L777">            int nCrits = 2;</span>
<span class="nc bnc" id="L778" title="All 2 branches missed.">            if (loc == Protomech.LOC_LEG) {</span>
<span class="nc" id="L779">                nCrits = 3;</span>
            }
<span class="nc" id="L781">            CheckCritPanel protoCrit = new CheckCritPanel(nCrits, hits);</span>
<span class="nc" id="L782">            protoCrits[loc] = protoCrit;</span>
<span class="nc" id="L783">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L784">            panSystem.add(protoCrit, gridBagConstraints);</span>
        }

<span class="nc" id="L787">    }</span>

    private void setupVtolSystemPanel() {
<span class="nc" id="L790">        GridBagConstraints gridBagConstraints = new GridBagConstraints();</span>

<span class="nc" id="L792">        VTOL vtol = (VTOL) entity;</span>

<span class="nc" id="L794">        gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L795">        gridBagConstraints.insets = new Insets(2, 2, 2, 2);</span>
<span class="nc" id="L796">        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L797">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L798">        gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L799">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L800">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.flightStabilizer&quot;)</span>
                + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L802">        int flightStabHit = 0;</span>
<span class="nc bnc" id="L803" title="All 2 branches missed.">        if (vtol.isStabiliserHit(VTOL.LOC_ROTOR)) {</span>
<span class="nc" id="L804">            flightStabHit = 1;</span>
        }
<span class="nc" id="L806">        flightStabilizerCrit = new CheckCritPanel(1, flightStabHit);</span>
<span class="nc" id="L807">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L808">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L809">        panSystem.add(flightStabilizerCrit, gridBagConstraints);</span>

<span class="nc" id="L811">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L812">        gridBagConstraints.gridy = 1;</span>
<span class="nc" id="L813">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L814">        gridBagConstraints.weighty = 0.0;</span>
<span class="nc" id="L815">        gridBagConstraints.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L816">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.engine&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L818">        engineCrit = new CheckCritPanel(1, vtol.getEngineHits());</span>
<span class="nc" id="L819">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L820">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L821">        panSystem.add(engineCrit, gridBagConstraints);</span>

<span class="nc" id="L823">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L824">        gridBagConstraints.gridy = 2;</span>
<span class="nc" id="L825">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L826">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.sensor&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L828">        sensorCrit = new CheckCritPanel(4, vtol.getSensorHits());</span>
<span class="nc" id="L829">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L830">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L831">        panSystem.add(sensorCrit, gridBagConstraints);</span>

<span class="nc" id="L833">        stabilizerCrits = new CheckCritPanel[vtol.locations()];</span>
<span class="nc bnc" id="L834" title="All 2 branches missed.">        for (int loc = 0; loc &lt; vtol.locations(); loc++) {</span>
<span class="nc bnc" id="L835" title="All 4 branches missed.">            if ((loc == Tank.LOC_BODY) || (loc == VTOL.LOC_ROTOR)) {</span>
<span class="nc" id="L836">                continue;</span>
            }
<span class="nc" id="L838">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L839">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L840">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L841">            gridBagConstraints.weighty = 0.0;</span>
<span class="nc bnc" id="L842" title="All 2 branches missed.">            if (loc == (vtol.locations() - 1)) {</span>
<span class="nc" id="L843">                gridBagConstraints.weighty = 1.0;</span>
            }
<span class="nc" id="L845">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + </span>
<span class="nc" id="L846">                    String.format(Messages.getString(&quot;UnitEditorDialog.locationStabilizer&quot;), entity.getLocationName(loc))</span>
                    + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L848">            int hits = 0;</span>
<span class="nc bnc" id="L849" title="All 2 branches missed.">            if (vtol.isStabiliserHit(loc)) {</span>
<span class="nc" id="L850">                hits = 1;</span>
            }
<span class="nc" id="L852">            CheckCritPanel stabCrit = new CheckCritPanel(1, hits);</span>
<span class="nc" id="L853">            stabilizerCrits[loc] = stabCrit;</span>
<span class="nc" id="L854">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L855">            panSystem.add(stabCrit, gridBagConstraints);</span>
        }

<span class="nc" id="L858">    }</span>

    private void setupAeroSystemPanel() {
<span class="nc" id="L861">        GridBagConstraints gridBagConstraints = new GridBagConstraints();</span>

<span class="nc" id="L863">        Aero aero = (Aero) entity;</span>

<span class="nc" id="L865">        gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L866">        gridBagConstraints.insets = new Insets(2, 2, 2, 2);</span>
<span class="nc" id="L867">        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L868">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L869">        gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L870">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L871">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.avionics&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L873">        avionicsCrit = new CheckCritPanel(3, aero.getAvionicsHits());</span>
<span class="nc" id="L874">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L875">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L876">        panSystem.add(avionicsCrit, gridBagConstraints);</span>

<span class="nc bnc" id="L878" title="All 2 branches missed.">        if (aero instanceof Jumpship) {</span>
<span class="nc" id="L879">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L880">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L881">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L882">            gridBagConstraints.weighty = 0.0;</span>
<span class="nc" id="L883">            gridBagConstraints.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L884">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.cic&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                    gridBagConstraints);
<span class="nc" id="L886">            cicCrit = new CheckCritPanel(3, aero.getCICHits());</span>
<span class="nc" id="L887">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L888">            gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L889">            panSystem.add(cicCrit, gridBagConstraints);</span>
        } else {
<span class="nc" id="L891">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L892">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L893">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L894">            gridBagConstraints.weighty = 0.0;</span>
<span class="nc" id="L895">            gridBagConstraints.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L896">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.fcs&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                    gridBagConstraints);
<span class="nc" id="L898">            fcsCrit = new CheckCritPanel(3, aero.getFCSHits());</span>
<span class="nc" id="L899">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L900">            gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L901">            panSystem.add(fcsCrit, gridBagConstraints);</span>
        }

<span class="nc" id="L904">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L905">        gridBagConstraints.gridy++;</span>
<span class="nc" id="L906">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L907">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.sensor&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L909">        sensorCrit = new CheckCritPanel(3, aero.getSensorHits());</span>
<span class="nc" id="L910">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L911">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L912">        panSystem.add(sensorCrit, gridBagConstraints);</span>

<span class="nc" id="L914">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L915">        gridBagConstraints.gridy++;</span>
<span class="nc" id="L916">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L917">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.engine&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L919">        engineCrit = new CheckCritPanel(3, aero.getEngineHits());</span>
<span class="nc bnc" id="L920" title="All 4 branches missed.">        if ((aero instanceof Dropship) || (aero instanceof Jumpship)) {</span>
<span class="nc" id="L921">            engineCrit = new CheckCritPanel(6, aero.getEngineHits());</span>
        }
<span class="nc" id="L923">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L924">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L925">        panSystem.add(engineCrit, gridBagConstraints);</span>
        
<span class="nc bnc" id="L927" title="All 2 branches missed.">    if (!(aero instanceof Jumpship)) {</span>
<span class="nc" id="L928">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L929">        gridBagConstraints.gridy++;</span>
<span class="nc" id="L930">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L931">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.landingGear&quot;)</span>
                + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L933">        int gearHits = 0;</span>
<span class="nc bnc" id="L934" title="All 2 branches missed.">        if (aero.isGearHit()) {</span>
<span class="nc" id="L935">            gearHits = 1;</span>
        }
<span class="nc" id="L937">        gearCrit = new CheckCritPanel(1, gearHits);</span>
<span class="nc" id="L938">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L939">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L940">        panSystem.add(gearCrit, gridBagConstraints);</span>
    }
    
<span class="nc" id="L943">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L944">        gridBagConstraints.gridy++;</span>
<span class="nc" id="L945">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L946">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.lifeSupport&quot;)</span>
                + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L948">        int lifeHits = 0;</span>
<span class="nc bnc" id="L949" title="All 2 branches missed.">        if (!aero.hasLifeSupport()) {</span>
<span class="nc" id="L950">            lifeHits = 1;</span>
        }
<span class="nc" id="L952">        lifeSupportCrit = new CheckCritPanel(1, lifeHits);</span>
<span class="nc" id="L953">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L954">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L955">        panSystem.add(lifeSupportCrit, gridBagConstraints);</span>

<span class="nc bnc" id="L957" title="All 4 branches missed.">        if ((aero instanceof SmallCraft) || (aero instanceof Jumpship)) {</span>
<span class="nc" id="L958">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L959">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L960">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L961">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.leftThruster&quot;)</span>
                    + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L963">            leftThrusterCrit = new CheckCritPanel(4, aero.getLeftThrustHits());</span>
<span class="nc" id="L964">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L965">            gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L966">            panSystem.add(leftThrusterCrit, gridBagConstraints);</span>

<span class="nc" id="L968">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L969">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L970">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L971">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.rightThruster&quot;)</span>
                    + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L973">            rightThrusterCrit = new CheckCritPanel(4, aero.getRightThrustHits());</span>
<span class="nc" id="L974">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L975">            gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L976">            panSystem.add(rightThrusterCrit, gridBagConstraints);</span>
        }
        
<span class="nc bnc" id="L979" title="All 2 branches missed.">        if (aero instanceof Jumpship) {</span>
<span class="nc" id="L980">            Jumpship js = (Jumpship) aero;</span>
            //Grav Decks
<span class="nc" id="L982">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L983">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L984">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L985">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.gravDecks&quot;)</span>
                    + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L987">            gravDeckCrit = new CheckCritPanel(js.getTotalGravDeck(), js.getTotalDamagedGravDeck());</span>
<span class="nc" id="L988">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L989">            gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L990">            panSystem.add(gravDeckCrit, gridBagConstraints);</span>
            
            //Docking Collars
            JSpinner collarCrit;
<span class="nc" id="L994">            Vector&lt;DockingCollar&gt; collars = aero.getDockingCollars();</span>
<span class="nc" id="L995">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L996">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L997">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L998">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.dockingCollars&quot;)</span>
                    + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
            
<span class="nc" id="L1001">            int damagedCollars = 0;</span>
<span class="nc bnc" id="L1002" title="All 2 branches missed.">            for (DockingCollar nextDC : aero.getDockingCollars()) {</span>
<span class="nc bnc" id="L1003" title="All 2 branches missed.">                if (nextDC.isDamaged()) {</span>
<span class="nc" id="L1004">                    damagedCollars ++;</span>
                }
<span class="nc" id="L1006">            }</span>
<span class="nc" id="L1007">            collarCrit = new JSpinner(new SpinnerNumberModel(collars.size() - damagedCollars, 0, collars.size(), 1.0));</span>
<span class="nc" id="L1008">            collarDamage = collarCrit;</span>
<span class="nc" id="L1009">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L1010">            gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L1011">            panSystem.add(collarCrit, gridBagConstraints);</span>
            
            //K-F Drive Integrity
            JSpinner kfDriveCrit;
<span class="nc" id="L1015">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L1016">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L1017">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L1018">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.kfIntegrity&quot;)</span>
                    + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L1020">            kfDriveCrit = new JSpinner(new SpinnerNumberModel(js.getKFIntegrity(), 0, js.getOKFIntegrity(), 1.0));</span>
<span class="nc" id="L1021">            kfDamage = kfDriveCrit;</span>
<span class="nc" id="L1022">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L1023">            gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L1024">            panSystem.add(kfDriveCrit, gridBagConstraints);</span>
            
            //K-F Drive Components (Optional)
            //Drive Coil
<span class="nc bnc" id="L1028" title="All 2 branches missed.">            if (entity.getGame().getOptions().booleanOption(OptionsConstants.ADVAERORULES_EXPANDED_KF_DRIVE_DAMAGE)) {</span>
<span class="nc" id="L1029">                gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L1030">                gridBagConstraints.gridy++;</span>
<span class="nc" id="L1031">                gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L1032">                panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.driveCoil&quot;)</span>
                        + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L1034">                int driveCoilHits = 0;</span>
<span class="nc bnc" id="L1035" title="All 2 branches missed.">                if (js.getKFDriveCoilHit()) {</span>
<span class="nc" id="L1036">                    driveCoilHits = 1;</span>
                }
<span class="nc" id="L1038">                driveCoilCrit = new CheckCritPanel(1, driveCoilHits);</span>
<span class="nc" id="L1039">                gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L1040">                gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L1041">                panSystem.add(driveCoilCrit, gridBagConstraints);</span>
                
                //Charging System
<span class="nc" id="L1044">                gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L1045">                gridBagConstraints.gridy++;</span>
<span class="nc" id="L1046">                gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L1047">                panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.chargingSystem&quot;)</span>
                        + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L1049">                int chargingSystemHits = 0;</span>
<span class="nc bnc" id="L1050" title="All 2 branches missed.">                if (js.getKFChargingSystemHit()) {</span>
<span class="nc" id="L1051">                    chargingSystemHits = 1;</span>
                }
<span class="nc" id="L1053">                chargingSystemCrit = new CheckCritPanel(1, chargingSystemHits);</span>
<span class="nc" id="L1054">                gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L1055">                gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L1056">                panSystem.add(chargingSystemCrit, gridBagConstraints);</span>
                
                //Field Initiator
<span class="nc" id="L1059">                gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L1060">                gridBagConstraints.gridy++;</span>
<span class="nc" id="L1061">                gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L1062">                panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.fieldInitiator&quot;)</span>
                        + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L1064">                int fieldInitiatorHits = 0;</span>
<span class="nc bnc" id="L1065" title="All 2 branches missed.">                if (js.getKFFieldInitiatorHit()) {</span>
<span class="nc" id="L1066">                    fieldInitiatorHits = 1;</span>
                }
<span class="nc" id="L1068">                fieldInitiatorCrit = new CheckCritPanel(1, fieldInitiatorHits);</span>
<span class="nc" id="L1069">                gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L1070">                gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L1071">                panSystem.add(fieldInitiatorCrit, gridBagConstraints);</span>
                
                //Drive Controller
<span class="nc" id="L1074">                gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L1075">                gridBagConstraints.gridy++;</span>
<span class="nc" id="L1076">                gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L1077">                panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.driveController&quot;)</span>
                        + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L1079">                int driveControllerHits = 0;</span>
<span class="nc bnc" id="L1080" title="All 2 branches missed.">                if (js.getKFDriveControllerHit()) {</span>
<span class="nc" id="L1081">                    driveControllerHits = 1;</span>
                }
<span class="nc" id="L1083">                driveControllerCrit = new CheckCritPanel(1, driveControllerHits);</span>
<span class="nc" id="L1084">                gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L1085">                gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L1086">                panSystem.add(driveControllerCrit, gridBagConstraints);</span>
                
                //Helium Tank
<span class="nc" id="L1089">                gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L1090">                gridBagConstraints.gridy++;</span>
<span class="nc" id="L1091">                gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L1092">                panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.heliumTank&quot;)</span>
                        + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L1094">                int heliumTankHits = 0;</span>
<span class="nc bnc" id="L1095" title="All 2 branches missed.">                if (js.getKFHeliumTankHit()) {</span>
<span class="nc" id="L1096">                    heliumTankHits = 1;</span>
                }
<span class="nc" id="L1098">                heliumTankCrit = new CheckCritPanel(1, heliumTankHits);</span>
<span class="nc" id="L1099">                gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L1100">                gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L1101">                panSystem.add(heliumTankCrit, gridBagConstraints);</span>
                
                //LF Battery
<span class="nc bnc" id="L1104" title="All 2 branches missed.">                if (js.hasLF()) {</span>
<span class="nc" id="L1105">                    gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L1106">                    gridBagConstraints.gridy++;</span>
<span class="nc" id="L1107">                    gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L1108">                    panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.lfBattery&quot;)</span>
                            + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L1110">                    int lfBatteryHits = 0;</span>
<span class="nc bnc" id="L1111" title="All 2 branches missed.">                    if (js.getLFBatteryHit()) {</span>
<span class="nc" id="L1112">                        lfBatteryHits = 1;</span>
                    }
<span class="nc" id="L1114">                    lfBatteryCrit = new CheckCritPanel(1, lfBatteryHits);</span>
<span class="nc" id="L1115">                    gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L1116">                    gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L1117">                    panSystem.add(lfBatteryCrit, gridBagConstraints);</span>
                }
            }
            
            //Jump Sail Integrity
            JSpinner sailCrit;
<span class="nc" id="L1123">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L1124">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L1125">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L1126">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.sailIntegrity&quot;)</span>
                    + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L1128">            sailCrit = new JSpinner(new SpinnerNumberModel(js.getSailIntegrity(), 0, js.getOSailIntegrity(), 1.0));</span>
<span class="nc" id="L1129">            sailDamage = sailCrit;</span>
<span class="nc" id="L1130">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L1131">            gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L1132">            panSystem.add(sailCrit, gridBagConstraints);</span>
        }

<span class="nc bnc" id="L1135" title="All 2 branches missed.">        if (aero instanceof Dropship) {</span>
<span class="nc" id="L1136">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L1137">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L1138">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L1139">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.dropshipCollar&quot;)</span>
                    + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L1141">            int collarHits = 0;</span>
<span class="nc bnc" id="L1142" title="All 2 branches missed.">            if (((Dropship) aero).isDockCollarDamaged()) {</span>
<span class="nc" id="L1143">                collarHits = 1;</span>
            }
<span class="nc" id="L1145">            dockCollarCrit = new CheckCritPanel(1, collarHits);</span>
<span class="nc" id="L1146">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L1147">            gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L1148">            panSystem.add(dockCollarCrit, gridBagConstraints);</span>
            
<span class="nc" id="L1150">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L1151">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L1152">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L1153">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.kfBoom&quot;)</span>
                    + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L1155">            int kfboomHits = 0;</span>
<span class="nc bnc" id="L1156" title="All 2 branches missed.">            if (((Dropship) aero).isKFBoomDamaged()) {</span>
<span class="nc" id="L1157">            	kfboomHits = 1;</span>
            }
<span class="nc" id="L1159">            kfboomCrit = new CheckCritPanel(1, kfboomHits);</span>
<span class="nc" id="L1160">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L1161">            gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L1162">            panSystem.add(kfboomCrit, gridBagConstraints);</span>
        }
        
<span class="nc bnc" id="L1165" title="All 4 branches missed.">        if ((aero instanceof SmallCraft) || (aero instanceof Jumpship)) {</span>
<span class="nc" id="L1166">        	int b = 0;</span>
        	JSpinner bayCrit;
<span class="nc" id="L1168">        	Vector&lt;Bay&gt; bays = aero.getTransportBays();</span>
<span class="nc" id="L1169">        	bayDamage = new JSpinner[bays.size()];</span>
<span class="nc" id="L1170">        	bayDoorCrit = new CheckCritPanel [bays.size()];</span>
<span class="nc bnc" id="L1171" title="All 2 branches missed.">        	for (Bay nextbay : bays) {</span>
<span class="nc" id="L1172">        		gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L1173">        		gridBagConstraints.gridy++;</span>
<span class="nc" id="L1174">        		gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L1175">        		panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + </span>
<span class="nc" id="L1176">        		        String.format(Messages.getString(&quot;UnitEditorDialog.bayCrit&quot;), nextbay.getType(), nextbay.getBayNumber())</span>
        		        + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
    		
<span class="nc" id="L1179">        		bayCrit = new JSpinner(new SpinnerNumberModel(nextbay.getCapacity() - nextbay.getBayDamage(),</span>
<span class="nc bnc" id="L1180" title="All 2 branches missed.">                        0, nextbay.getCapacity(), nextbay.isCargo()? 0.5: 1.0));</span>
<span class="nc" id="L1181">        		bayDamage[b] = bayCrit;</span>
<span class="nc" id="L1182">        		gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L1183">        		gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L1184">        		panSystem.add(bayCrit, gridBagConstraints);</span>
    		
<span class="nc" id="L1186">                gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L1187">                gridBagConstraints.gridy++;</span>
<span class="nc" id="L1188">                gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L1189">                panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + </span>
<span class="nc" id="L1190">                        String.format(Messages.getString(&quot;UnitEditorDialog.bayDoorCrit&quot;), nextbay.getBayNumber())</span>
                        + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
    		
<span class="nc" id="L1193">        		CheckCritPanel doorCrit = new CheckCritPanel(nextbay.getDoors(), (nextbay.getDoors() - nextbay.getCurrentDoors()));</span>
<span class="nc" id="L1194">        		bayDoorCrit[b] = doorCrit;</span>
<span class="nc" id="L1195">        		gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L1196">        		gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L1197">        		panSystem.add(doorCrit, gridBagConstraints);</span>
<span class="nc" id="L1198">        		b++;</span>
<span class="nc" id="L1199">    		}</span>
    	}
<span class="nc" id="L1201">    }</span>

    private void btnOkayActionPerformed(java.awt.event.ActionEvent evt) {
<span class="nc bnc" id="L1204" title="All 2 branches missed.">        for (int i = 0; i &lt; entity.locations(); i++) {</span>
<span class="nc bnc" id="L1205" title="All 2 branches missed.">            if (null != spnInternal[i]) {</span>
<span class="nc" id="L1206">                int internal = (Integer) spnInternal[i].getModel().getValue();</span>
<span class="nc bnc" id="L1207" title="All 2 branches missed.">                if (internal &lt;= 0) {</span>
<span class="nc" id="L1208">                    internal = IArmorState.ARMOR_DESTROYED;</span>
                }
<span class="nc bnc" id="L1210" title="All 4 branches missed.">                if ((entity instanceof Aero) &amp;&amp; (i == 0)) {</span>
<span class="nc" id="L1211">                    ((Aero) entity).setSI(internal);</span>
                } else {
<span class="nc" id="L1213">                    entity.setInternal(internal, i);</span>
                }
<span class="nc bnc" id="L1215" title="All 4 branches missed.">                if ((entity instanceof Infantry)</span>
                        &amp;&amp; !(entity instanceof BattleArmor)) {
<span class="nc" id="L1217">                    ((Infantry) entity).applyDamage();</span>
                }
            }
<span class="nc bnc" id="L1220" title="All 2 branches missed.">            if (null != spnArmor[i]) {</span>
<span class="nc" id="L1221">                int armor = (Integer) spnArmor[i].getModel().getValue();</span>
<span class="nc bnc" id="L1222" title="All 2 branches missed.">                if (armor &lt;= 0) {</span>
<span class="nc" id="L1223">                    armor = IArmorState.ARMOR_DESTROYED;</span>
                }
<span class="nc" id="L1225">                entity.setArmor(armor, i);</span>
            }
<span class="nc bnc" id="L1227" title="All 4 branches missed.">            if (entity.hasRearArmor(i) &amp;&amp; (null != spnRear[i])) {</span>
<span class="nc" id="L1228">                int rear = (Integer) spnRear[i].getModel().getValue();</span>
<span class="nc bnc" id="L1229" title="All 2 branches missed.">                if (rear &lt;= 0) {</span>
<span class="nc" id="L1230">                    rear = IArmorState.ARMOR_DESTROYED;</span>
                }
<span class="nc" id="L1232">                entity.setArmor(rear, i, true);</span>
            }
        }
<span class="nc bnc" id="L1235" title="All 2 branches missed.">        for (Mounted m : entity.getEquipment()) {</span>
<span class="nc" id="L1236">            int eqNum = entity.getEquipmentNum(m);</span>
<span class="nc" id="L1237">            CheckCritPanel crit = equipCrits.get(eqNum);</span>
<span class="nc bnc" id="L1238" title="All 2 branches missed.">            if (null != crit) {</span>
<span class="nc" id="L1239">                int hits = crit.getHits();</span>
<span class="nc bnc" id="L1240" title="All 2 branches missed.">                m.setDestroyed(hits &gt; 0);</span>
<span class="nc bnc" id="L1241" title="All 2 branches missed.">                m.setHit(hits &gt; 0);</span>
<span class="nc" id="L1242">                entity.damageSystem(CriticalSlot.TYPE_EQUIPMENT, eqNum, hits);</span>
            }
<span class="nc" id="L1244">        }</span>

        // now systems
<span class="nc bnc" id="L1247" title="All 2 branches missed.">        if (entity instanceof Mech) {</span>
<span class="nc bnc" id="L1248" title="All 2 branches missed.">            if (null != centerEngineCrit) {</span>
<span class="nc" id="L1249">                entity.damageSystem(CriticalSlot.TYPE_SYSTEM,</span>
                        Mech.SYSTEM_ENGINE, Mech.LOC_CT,
<span class="nc" id="L1251">                        centerEngineCrit.getHits());</span>
            }
<span class="nc bnc" id="L1253" title="All 2 branches missed.">            if (null != leftEngineCrit) {</span>
<span class="nc" id="L1254">                entity.damageSystem(CriticalSlot.TYPE_SYSTEM,</span>
                        Mech.SYSTEM_ENGINE, Mech.LOC_LT,
<span class="nc" id="L1256">                        leftEngineCrit.getHits());</span>
            }
<span class="nc bnc" id="L1258" title="All 2 branches missed.">            if (null != rightEngineCrit) {</span>
<span class="nc" id="L1259">                entity.damageSystem(CriticalSlot.TYPE_SYSTEM,</span>
                        Mech.SYSTEM_ENGINE, Mech.LOC_RT,
<span class="nc" id="L1261">                        rightEngineCrit.getHits());</span>
            }
<span class="nc bnc" id="L1263" title="All 2 branches missed.">            if (null != gyroCrit) {</span>
<span class="nc" id="L1264">                entity.damageSystem(CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_GYRO,</span>
<span class="nc" id="L1265">                        gyroCrit.getHits());</span>
            }
<span class="nc bnc" id="L1267" title="All 2 branches missed.">            if (null != sensorCrit) {</span>
<span class="nc" id="L1268">                entity.damageSystem(CriticalSlot.TYPE_SYSTEM,</span>
<span class="nc" id="L1269">                        Mech.SYSTEM_SENSORS, sensorCrit.getHits());</span>
            }
<span class="nc bnc" id="L1271" title="All 2 branches missed.">            if (null != lifeSupportCrit) {</span>
<span class="nc" id="L1272">                entity.damageSystem(CriticalSlot.TYPE_SYSTEM,</span>
<span class="nc" id="L1273">                        Mech.SYSTEM_LIFE_SUPPORT, lifeSupportCrit.getHits());</span>
            }
<span class="nc bnc" id="L1275" title="All 2 branches missed.">            if (null != cockpitCrit) {</span>
<span class="nc" id="L1276">                entity.damageSystem(CriticalSlot.TYPE_SYSTEM,</span>
<span class="nc" id="L1277">                        Mech.SYSTEM_COCKPIT, cockpitCrit.getHits());</span>
            }
<span class="nc bnc" id="L1279" title="All 4 branches missed.">            if (null != lamAvionicsCrit &amp;&amp; !lamAvionicsCrit.isEmpty()) {</span>
<span class="nc bnc" id="L1280" title="All 2 branches missed.">                for (int loc : lamAvionicsCrit.keySet()) {</span>
<span class="nc" id="L1281">                    entity.damageSystem(CriticalSlot.TYPE_SYSTEM, LandAirMech.LAM_AVIONICS,</span>
<span class="nc" id="L1282">                            loc, lamAvionicsCrit.get(loc).getHits());</span>
<span class="nc" id="L1283">                }</span>
            }
<span class="nc bnc" id="L1285" title="All 4 branches missed.">            if (null != lamLandingGearCrit &amp;&amp; !lamLandingGearCrit.isEmpty()) {</span>
<span class="nc bnc" id="L1286" title="All 2 branches missed.">                for (int loc : lamLandingGearCrit.keySet()) {</span>
<span class="nc" id="L1287">                    entity.damageSystem(CriticalSlot.TYPE_SYSTEM, LandAirMech.LAM_LANDING_GEAR,</span>
<span class="nc" id="L1288">                            loc, lamLandingGearCrit.get(loc).getHits());</span>
<span class="nc" id="L1289">                }</span>
            }
<span class="nc bnc" id="L1291" title="All 2 branches missed.">            for (int i = 0; i &lt; 4; i++) {</span>
<span class="nc bnc" id="L1292" title="All 2 branches missed.">                for (int j = 0; j &lt; 4; j++) {</span>
<span class="nc" id="L1293">                    CheckCritPanel actuatorCrit = actuatorCrits[i][j];</span>
<span class="nc bnc" id="L1294" title="All 2 branches missed.">                    if (null == actuatorCrit) {</span>
<span class="nc" id="L1295">                        continue;</span>
                    }
<span class="nc" id="L1297">                    int loc = i + Mech.LOC_RARM;</span>
<span class="nc" id="L1298">                    int actuator = j + Mech.ACTUATOR_SHOULDER;</span>
<span class="nc bnc" id="L1299" title="All 4 branches missed.">                    if ((loc &gt;= Mech.LOC_RLEG) || (entity instanceof QuadMech)) {</span>
<span class="nc" id="L1300">                        actuator = j + Mech.ACTUATOR_HIP;</span>
                    }
<span class="nc" id="L1302">                    entity.damageSystem(CriticalSlot.TYPE_SYSTEM, actuator,</span>
<span class="nc" id="L1303">                            loc, actuatorCrit.getHits());</span>
                }
<span class="nc bnc" id="L1305" title="All 2 branches missed.">                if (entity instanceof QuadVee) {</span>
<span class="nc bnc" id="L1306" title="All 2 branches missed.">                    for (int j = 0; j &lt; 4; j++) {</span>
<span class="nc" id="L1307">                        CheckCritPanel actuatorCrit = actuatorCrits[i][4];</span>
<span class="nc bnc" id="L1308" title="All 2 branches missed.">                        if (null == actuatorCrit) {</span>
<span class="nc" id="L1309">                            continue;</span>
                        }
<span class="nc" id="L1311">                        int loc = i + Mech.LOC_RARM;</span>
<span class="nc" id="L1312">                        int actuator = QuadVee.SYSTEM_CONVERSION_GEAR;</span>
<span class="nc" id="L1313">                        entity.damageSystem(CriticalSlot.TYPE_SYSTEM, actuator,</span>
<span class="nc" id="L1314">                                loc, actuatorCrit.getHits());</span>
                    }
                }
            }
<span class="nc bnc" id="L1318" title="All 2 branches missed.">        } else if (entity instanceof Protomech) {</span>
<span class="nc bnc" id="L1319" title="All 2 branches missed.">            for (int loc = 0; loc &lt; entity.locations(); loc++) {</span>
<span class="nc bnc" id="L1320" title="All 2 branches missed.">                if (null == protoCrits[loc]) {</span>
<span class="nc" id="L1321">                    continue;</span>
                }
<span class="nc bnc" id="L1323" title="All 4 branches missed.">                if ((loc == Protomech.LOC_LARM) || (loc == Protomech.LOC_RARM)) {</span>
<span class="nc" id="L1324">                    entity.damageSystem(CriticalSlot.TYPE_SYSTEM,</span>
                            Protomech.SYSTEM_ARMCRIT, loc,
<span class="nc" id="L1326">                            protoCrits[loc].getHits());</span>
                }
<span class="nc bnc" id="L1328" title="All 2 branches missed.">                if (loc == Protomech.LOC_LEG) {</span>
<span class="nc" id="L1329">                    entity.damageSystem(CriticalSlot.TYPE_SYSTEM,</span>
                            Protomech.SYSTEM_LEGCRIT, loc,
<span class="nc" id="L1331">                            protoCrits[loc].getHits());</span>
                }
<span class="nc bnc" id="L1333" title="All 2 branches missed.">                if (loc == Protomech.LOC_HEAD) {</span>
<span class="nc" id="L1334">                    entity.damageSystem(CriticalSlot.TYPE_SYSTEM,</span>
                            Protomech.SYSTEM_HEADCRIT, loc,
<span class="nc" id="L1336">                            protoCrits[loc].getHits());</span>
                }
<span class="nc bnc" id="L1338" title="All 2 branches missed.">                if (loc == Protomech.LOC_TORSO) {</span>
<span class="nc" id="L1339">                    entity.damageSystem(CriticalSlot.TYPE_SYSTEM,</span>
                            Protomech.SYSTEM_TORSOCRIT, loc,
<span class="nc" id="L1341">                            protoCrits[loc].getHits());</span>
                }
            }
<span class="nc bnc" id="L1344" title="All 2 branches missed.">        } else if (entity instanceof Tank) {</span>
<span class="nc" id="L1345">            Tank tank = (Tank) entity;</span>
<span class="nc bnc" id="L1346" title="All 2 branches missed.">            if (null != engineCrit) {</span>
<span class="nc bnc" id="L1347" title="All 2 branches missed.">                if (engineCrit.getHits() &gt; 0) {</span>
<span class="nc" id="L1348">                    tank.engineHit();</span>
                } else {
<span class="nc" id="L1350">                    tank.engineFix();</span>
                }
            }
<span class="nc bnc" id="L1353" title="All 2 branches missed.">            if (null != turretlockCrit) {</span>
<span class="nc bnc" id="L1354" title="All 2 branches missed.">                if (turretlockCrit.getHits() &gt; 0) {</span>
<span class="nc" id="L1355">                    tank.lockTurret(0);</span>
                } else {
<span class="nc" id="L1357">                    tank.unlockTurret();</span>
                }
            }
<span class="nc bnc" id="L1360" title="All 2 branches missed.">            if (null != sensorCrit) {</span>
<span class="nc" id="L1361">                tank.setSensorHits(sensorCrit.getHits());</span>
            }
<span class="nc bnc" id="L1363" title="All 2 branches missed.">            if (null != motiveCrit) {</span>
<span class="nc" id="L1364">                tank.resetMovementDamage();</span>
<span class="nc" id="L1365">                tank.addMovementDamage(motiveCrit.getHits());</span>

                // Apply movement damage immediately in case we've decided to immobilize the tank
<span class="nc" id="L1368">                tank.applyMovementDamage();</span>
            }
<span class="nc bnc" id="L1370" title="All 4 branches missed.">            if ((tank instanceof VTOL) &amp;&amp; (null != flightStabilizerCrit)) {</span>
<span class="nc bnc" id="L1371" title="All 2 branches missed.">                if (flightStabilizerCrit.getHits() &gt; 0) {</span>
<span class="nc" id="L1372">                    tank.setStabiliserHit(VTOL.LOC_ROTOR);</span>
                } else {
<span class="nc" id="L1374">                    tank.clearStabiliserHit(VTOL.LOC_ROTOR);</span>
                }
            }
<span class="nc bnc" id="L1377" title="All 2 branches missed.">            for (int loc = 0; loc &lt; tank.locations(); loc++) {</span>
<span class="nc" id="L1378">                CheckCritPanel stabCrit = stabilizerCrits[loc];</span>
<span class="nc bnc" id="L1379" title="All 2 branches missed.">                if (null == stabCrit) {</span>
<span class="nc" id="L1380">                    continue;</span>
                }
<span class="nc bnc" id="L1382" title="All 2 branches missed.">                if (stabCrit.getHits() &gt; 0) {</span>
<span class="nc" id="L1383">                    tank.setStabiliserHit(loc);</span>
                } else {
<span class="nc" id="L1385">                    tank.clearStabiliserHit(loc);</span>
                }
            }
<span class="nc bnc" id="L1388" title="All 2 branches missed.">        } else if (entity instanceof Aero) {</span>
<span class="nc" id="L1389">            Aero aero = (Aero) entity;</span>
<span class="nc bnc" id="L1390" title="All 2 branches missed.">            if (null != avionicsCrit) {</span>
<span class="nc" id="L1391">                aero.setAvionicsHits(avionicsCrit.getHits());</span>
            }
<span class="nc bnc" id="L1393" title="All 2 branches missed.">            if (null != fcsCrit) {</span>
<span class="nc" id="L1394">                aero.setFCSHits(fcsCrit.getHits());</span>
            }
<span class="nc bnc" id="L1396" title="All 2 branches missed.">            if (null != cicCrit) {</span>
<span class="nc" id="L1397">                aero.setCICHits(cicCrit.getHits());</span>
            }
<span class="nc bnc" id="L1399" title="All 2 branches missed.">            if (null != engineCrit) {</span>
<span class="nc" id="L1400">                aero.setEngineHits(engineCrit.getHits());</span>
            }
<span class="nc bnc" id="L1402" title="All 2 branches missed.">            if (null != sensorCrit) {</span>
<span class="nc" id="L1403">                aero.setSensorHits(sensorCrit.getHits());</span>
            }
<span class="nc bnc" id="L1405" title="All 2 branches missed.">            if (null != gearCrit) {</span>
<span class="nc bnc" id="L1406" title="All 2 branches missed.">                aero.setGearHit(gearCrit.getHits() &gt; 0);</span>
            }
<span class="nc bnc" id="L1408" title="All 2 branches missed.">            if (null != lifeSupportCrit) {</span>
<span class="nc bnc" id="L1409" title="All 2 branches missed.">                aero.setLifeSupport(lifeSupportCrit.getHits() == 0);</span>
            }
<span class="nc bnc" id="L1411" title="All 2 branches missed.">            if (null != leftThrusterCrit) {</span>
<span class="nc" id="L1412">                aero.setLeftThrustHits(leftThrusterCrit.getHits());</span>
            }
<span class="nc bnc" id="L1414" title="All 2 branches missed.">            if (null != rightThrusterCrit) {</span>
<span class="nc" id="L1415">                aero.setRightThrustHits(rightThrusterCrit.getHits());</span>
            }
<span class="nc bnc" id="L1417" title="All 4 branches missed.">            if ((null != dockCollarCrit) &amp;&amp; (aero instanceof Dropship)) {</span>
<span class="nc" id="L1418">                ((Dropship) aero)</span>
<span class="nc bnc" id="L1419" title="All 2 branches missed.">                        .setDamageDockCollar(dockCollarCrit.getHits() &gt; 0);</span>
            }
<span class="nc bnc" id="L1421" title="All 4 branches missed.">            if ((null != kfboomCrit) &amp;&amp; (aero instanceof Dropship)) {</span>
<span class="nc" id="L1422">            	((Dropship) aero)</span>
<span class="nc bnc" id="L1423" title="All 2 branches missed.">            			.setDamageKFBoom(kfboomCrit.getHits() &gt; 0);</span>
            }
            // cargo bays and bay doors
<span class="nc bnc" id="L1426" title="All 4 branches missed.">            if ((aero instanceof Dropship) || (aero instanceof Jumpship)) {</span>
<span class="nc" id="L1427">            	int b = 0;</span>
<span class="nc bnc" id="L1428" title="All 2 branches missed.">            	for (Bay bay : aero.getTransportBays()) {</span>
<span class="nc" id="L1429">            		JSpinner bayCrit = bayDamage[b];</span>
<span class="nc bnc" id="L1430" title="All 2 branches missed.">            		if (null == bayCrit) {</span>
<span class="nc" id="L1431">            			continue;</span>
            		}
<span class="nc" id="L1433">            		bay.setBayDamage(bay.getCapacity() - (Double) bayCrit.getModel().getValue());</span>
<span class="nc" id="L1434">            		CheckCritPanel doorCrit = bayDoorCrit[b];</span>
<span class="nc bnc" id="L1435" title="All 2 branches missed.">            		if (null == doorCrit) {</span>
<span class="nc" id="L1436">            			continue;</span>
            		}
<span class="nc bnc" id="L1438" title="All 4 branches missed.">            		if ((bay.getCurrentDoors() &gt; 0) &amp;&amp; (doorCrit.getHits() &gt; 0)) {</span>
<span class="nc" id="L1439">            			bay.setCurrentDoors(bay.getDoors() - doorCrit.getHits());</span>

<span class="nc bnc" id="L1441" title="All 2 branches missed.">            		} else if (doorCrit.getHits() == 0) {</span>
<span class="nc" id="L1442">            			bay.setCurrentDoors(bay.getDoors());</span>
            		}
        			// for ASF and SC bays, we have to update recovery slots as doors are changed
<span class="nc bnc" id="L1445" title="All 2 branches missed.">        			if (bay instanceof ASFBay) {</span>
<span class="nc" id="L1446">        				ASFBay a = (ASFBay) bay;</span>
<span class="nc" id="L1447">        				a.initializeRecoverySlots();        				</span>
        			} 
<span class="nc bnc" id="L1449" title="All 2 branches missed.">        			if (bay instanceof SmallCraftBay) {</span>
<span class="nc" id="L1450">    					SmallCraftBay s = (SmallCraftBay) bay;</span>
<span class="nc" id="L1451">    					s.initializeRecoverySlots();    					</span>
        			}
<span class="nc" id="L1453">            	b++;</span>
<span class="nc" id="L1454">            	}</span>
            }
            // Jumpship Docking Collars, KF Drive, Sail and Grav Decks
<span class="nc bnc" id="L1457" title="All 2 branches missed.">            if (aero instanceof Jumpship) {</span>
<span class="nc" id="L1458">                Jumpship js = (Jumpship) aero;</span>
<span class="nc" id="L1459">                JSpinner collarCrit = collarDamage;</span>
<span class="nc" id="L1460">                CheckCritPanel deckCrit = gravDeckCrit;</span>
<span class="nc" id="L1461">                double damagedCollars = 0.0;</span>
<span class="nc" id="L1462">                int damagedDecks = 0;</span>
<span class="nc bnc" id="L1463" title="All 2 branches missed.">                if (null != collarCrit) {</span>
<span class="nc" id="L1464">                    damagedCollars = (aero.getDockingCollars().size() - (double) collarCrit.getModel().getValue());</span>
                }
                //First, reset damaged collars to undamaged. Otherwise you get weirdness when running this dialogue multiple times
<span class="nc bnc" id="L1467" title="All 2 branches missed.">                for (DockingCollar collar : aero.getDockingCollars()) {</span>
<span class="nc" id="L1468">                    collar.setDamaged(false);</span>
<span class="nc" id="L1469">                }</span>
                //Otherwise, run through the list and damage one until the spinner value is satisfied
<span class="nc bnc" id="L1471" title="All 2 branches missed.">                for (DockingCollar collar : aero.getDockingCollars()) {</span>
<span class="nc bnc" id="L1472" title="All 2 branches missed.">                    if (damagedCollars &lt;= 0) {</span>
<span class="nc" id="L1473">                        break;</span>
                    }
<span class="nc" id="L1475">                    collar.setDamaged(true);</span>
<span class="nc" id="L1476">                    damagedCollars --;</span>
<span class="nc" id="L1477">                }</span>
<span class="nc bnc" id="L1478" title="All 2 branches missed.">                if (null != deckCrit) {</span>
<span class="nc" id="L1479">                    damagedDecks = deckCrit.getHits();</span>
                }
                //reset all grav decks to undamaged
<span class="nc bnc" id="L1482" title="All 2 branches missed.">                for (int i = 0; i &lt; js.getTotalGravDeck(); i++) {</span>
<span class="nc" id="L1483">                    js.setGravDeckDamageFlag(i, 0);</span>
                }
<span class="nc bnc" id="L1485" title="All 2 branches missed.">                if (damagedDecks &gt; 0) {</span>
                    //loop through the grav decks from #1 and damage them
<span class="nc bnc" id="L1487" title="All 2 branches missed.">                    for (int i = 0; i &lt; damagedDecks; i++) {</span>
<span class="nc" id="L1488">                        js.setGravDeckDamageFlag(i, 1);</span>
                    }
                }
                //KF Drive and Sail
<span class="nc bnc" id="L1492" title="All 2 branches missed.">                if (null != kfDamage) {</span>
<span class="nc" id="L1493">                    double kfIntegrity = (double) kfDamage.getModel().getValue();</span>
<span class="nc" id="L1494">                    js.setKFIntegrity((int) kfIntegrity);</span>
                }
<span class="nc bnc" id="L1496" title="All 2 branches missed.">                if (null != chargingSystemCrit) {</span>
<span class="nc bnc" id="L1497" title="All 2 branches missed.">                    js.setKFChargingSystemHit(chargingSystemCrit.getHits() &gt; 0);</span>
                }
<span class="nc bnc" id="L1499" title="All 2 branches missed.">                if (null != driveCoilCrit) {</span>
<span class="nc bnc" id="L1500" title="All 2 branches missed.">                    js.setKFDriveCoilHit(driveCoilCrit.getHits() &gt; 0);</span>
                }
<span class="nc bnc" id="L1502" title="All 2 branches missed.">                if (null != driveControllerCrit) {</span>
<span class="nc bnc" id="L1503" title="All 2 branches missed.">                    js.setKFDriveControllerHit(driveControllerCrit.getHits() &gt; 0);</span>
                }
<span class="nc bnc" id="L1505" title="All 2 branches missed.">                if (null != fieldInitiatorCrit) {</span>
<span class="nc bnc" id="L1506" title="All 2 branches missed.">                    js.setKFFieldInitiatorHit(fieldInitiatorCrit.getHits() &gt; 0);</span>
                }
<span class="nc bnc" id="L1508" title="All 2 branches missed.">                if (null != heliumTankCrit) {</span>
<span class="nc bnc" id="L1509" title="All 2 branches missed.">                    js.setKFHeliumTankHit(heliumTankCrit.getHits() &gt; 0);</span>
                }
<span class="nc bnc" id="L1511" title="All 2 branches missed.">                if (null != lfBatteryCrit) {</span>
<span class="nc bnc" id="L1512" title="All 2 branches missed.">                    js.setLFBatteryHit(lfBatteryCrit.getHits() &gt; 0);</span>
                }
<span class="nc bnc" id="L1514" title="All 2 branches missed.">                if (null != sailDamage) {</span>
<span class="nc" id="L1515">                    double sailIntegrity = (double) sailDamage.getModel().getValue();</span>
<span class="nc" id="L1516">                    js.setSailIntegrity((int) sailIntegrity);</span>
                }
            }
        }

<span class="nc" id="L1521">    }</span>

    private class CheckCritPanel extends JPanel {

        /**
         *
         */
        private static final long serialVersionUID = 8662728291188274362L;

<span class="nc" id="L1530">        private ArrayList&lt;JCheckBox&gt; checks = new ArrayList&lt;JCheckBox&gt;();</span>

<span class="nc" id="L1532">        public CheckCritPanel(int crits, int current) {</span>
<span class="nc" id="L1533">            setLayout(new BoxLayout(this, BoxLayout.LINE_AXIS));</span>
<span class="nc bnc" id="L1534" title="All 2 branches missed.">            for (int i = 0; i &lt; crits; i++) {</span>
<span class="nc" id="L1535">                JCheckBox check = new JCheckBox(&quot;&quot;);</span>
<span class="nc" id="L1536">                check.setActionCommand(Integer.toString(i));</span>
<span class="nc" id="L1537">                check.addActionListener(new ActionListener() {</span>
                    public void actionPerformed(ActionEvent evt) {
<span class="nc" id="L1539">                        checkBoxes(evt);</span>
<span class="nc" id="L1540">                    }</span>
                });
<span class="nc" id="L1542">                checks.add(check);</span>
<span class="nc" id="L1543">                add(check);</span>
            }

<span class="nc bnc" id="L1546" title="All 2 branches missed.">            if (current &gt; 0) {</span>
<span class="nc bnc" id="L1547" title="All 2 branches missed.">                for (int i = 0; i &lt; current; i++) {</span>
<span class="nc" id="L1548">                    checks.get(i).setSelected(true);</span>
                }
            }
<span class="nc" id="L1551">        }</span>

        public int getHits() {
<span class="nc" id="L1554">            int hits = 0;</span>
<span class="nc bnc" id="L1555" title="All 2 branches missed.">            for (JCheckBox check : checks) {</span>
<span class="nc bnc" id="L1556" title="All 2 branches missed.">                if (check.isSelected()) {</span>
<span class="nc" id="L1557">                    hits++;</span>
                }
<span class="nc" id="L1559">            }</span>
<span class="nc" id="L1560">            return hits;</span>
        }

        private void checkBoxes(ActionEvent evt) {
<span class="nc" id="L1564">            int hits = Integer.parseInt(evt.getActionCommand());</span>
<span class="nc" id="L1565">            boolean selected = checks.get(hits).isSelected();</span>
<span class="nc bnc" id="L1566" title="All 2 branches missed.">            if (selected) {</span>
                // check all those up to this one
<span class="nc bnc" id="L1568" title="All 2 branches missed.">                for (int i = 0; i &lt; hits; i++) {</span>
<span class="nc" id="L1569">                    checks.get(i).setSelected(true);</span>
                }
<span class="nc bnc" id="L1571" title="All 2 branches missed.">            } else if (hits &lt; checks.size()) {</span>
                // deselect any above this one
<span class="nc bnc" id="L1573" title="All 2 branches missed.">                for (int i = hits; i &lt; checks.size(); i++) {</span>
<span class="nc" id="L1574">                    checks.get(i).setSelected(false);</span>
                }
            }

<span class="nc" id="L1578">        }</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>