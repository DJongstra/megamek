<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="nl"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PlanetaryConditions.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">PlayerTest Coverage Results</a> &gt; <a href="index.source.html" class="el_package">megamek.common</a> &gt; <span class="el_source">PlanetaryConditions.java</span></div><h1>PlanetaryConditions.java</h1><pre class="source lang-java linenums">/*
* MegaMek -
* Copyright (C) 2005 Ben Mazur (bmazur@sev.org)
* Copyright (C) 2018 The MegaMek Team
*
* This program is free software; you can redistribute it and/or modify it under
* the terms of the GNU General Public License as published by the Free Software
* Foundation; either version 2 of the License, or (at your option) any later
* version.
*
* This program is distributed in the hope that it will be useful, but WITHOUT
* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
* FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
* details.
*/

package megamek.common;

import java.io.Serializable;

/**
 * This class will hold all the information on planetary conditions and a variety of helper functions
 * for those conditions
 */
public class PlanetaryConditions implements Serializable {

    private static final long serialVersionUID = 6838624193286089781L;

    //light
    public static final int L_DAY          = 0;
    public static final int L_DUSK         = 1;
    public static final int L_FULL_MOON    = 2;
    public static final int L_MOONLESS     = 3;
    public static final int L_PITCH_BLACK  = 4;
<span class="nc" id="L35">    private static String[] lightNames = { &quot;Daylight&quot;, &quot;Dusk&quot;, &quot;Full Moon Night&quot;, &quot;Moonless Night&quot;,</span>
                                           &quot;Pitch Black&quot;};
<span class="nc" id="L37">    public static final int L_SIZE = lightNames.length;</span>

    //Weather
    public static final int WE_NONE             = 0;
    public static final int WE_LIGHT_RAIN       = 1;
    public static final int WE_MOD_RAIN         = 2;
    public static final int WE_HEAVY_RAIN       = 3;
    public static final int WE_GUSTING_RAIN     = 4;
    public static final int WE_DOWNPOUR         = 5;
    public static final int WE_LIGHT_SNOW       = 6;
    public static final int WE_MOD_SNOW         = 7;
    public static final int WE_SNOW_FLURRIES    = 8;
    public static final int WE_HEAVY_SNOW       = 9;
    public static final int WE_SLEET            = 10;
    public static final int WE_BLIZZARD         = 11;
    public static final int WE_ICE_STORM        = 12;
    public static final int WE_LIGHT_HAIL       = 13;
    public static final int WE_HEAVY_HAIL       = 14;
<span class="nc" id="L55">    private static String[] weatherNames = { &quot;Clear&quot;, &quot;Light Rain&quot;, &quot;Moderate Rain&quot;, &quot;Heavy Rain&quot;, &quot;Gusting Rain&quot;, &quot;Torrential Downpour&quot;,</span>
                                             &quot;Light Snowfall&quot;, &quot;Moderate Snowfall&quot;, &quot;Snow Flurries&quot;, &quot;Heavy Snowfall&quot;, &quot;Sleet&quot;, &quot;Blizzard&quot;,
                                             &quot;Ice Storm&quot;};//, &quot;Light Hail&quot;, &quot;Heavy Hail&quot;};
<span class="nc" id="L58">    public static final int WE_SIZE = weatherNames.length;</span>

    //Wind
    public static final int WI_NONE        = 0;
    public static final int WI_LIGHT_GALE  = 1;
    public static final int WI_MOD_GALE    = 2;
    public static final int WI_STRONG_GALE = 3;
    public static final int WI_STORM       = 4;
    public static final int WI_TORNADO_F13 = 5;
    public static final int WI_TORNADO_F4  = 6;

<span class="nc" id="L69">    private static String[] windNames = { &quot;Calm&quot;, &quot;Light Gale&quot;, &quot;Moderate Gale&quot;, &quot;Strong Gale&quot;, &quot;Storm&quot;, &quot;Tornado F1-F3&quot;, &quot;Tornado F4&quot;};</span>
<span class="nc" id="L70">    public static final int WI_SIZE = windNames.length;</span>

    //wind direction
<span class="nc" id="L73">    private static String[] dirNames = { &quot;North&quot;, &quot;Northeast&quot;, &quot;Southeast&quot;, &quot;South&quot;, &quot;Southwest&quot;, &quot;Northwest&quot;, &quot;RandomWindDirection&quot; };</span>
<span class="nc" id="L74">    public static final int DIR_SIZE = dirNames.length;</span>
    public static final int DIR_RANDOM = 6;
    

    //atmospheric pressure
    public static final int ATMO_VACUUM   = 0;
    public static final int ATMO_TRACE    = 1;
    public static final int ATMO_THIN     = 2;
    public static final int ATMO_STANDARD = 3;
    public static final int ATMO_HIGH     = 4;
    public static final int ATMO_VHIGH    = 5;

<span class="nc" id="L86">    public static String[] atmoNames = {&quot;Vacuum&quot;, &quot;Trace&quot;, &quot;Thin&quot;, &quot;Standard&quot;, &quot;High&quot;, &quot;Very High&quot; };</span>
<span class="nc" id="L87">    public static final int ATMO_SIZE = atmoNames.length;</span>

    //fog
    public static final int FOG_NONE  = 0;
    public static final int FOG_LIGHT = 1;
    public static final int FOG_HEAVY = 2;

<span class="nc" id="L94">    private static String[] fogNames = {&quot;None&quot;, &quot;Light Fog&quot;, &quot;Heavy Fog&quot; };</span>
<span class="nc" id="L95">    public static final int FOG_SIZE = fogNames.length;</span>

    //misc
<span class="nc" id="L98">    private boolean blowingSand = false;</span>
<span class="nc" id="L99">    private boolean sandStorm = false;</span>
<span class="nc" id="L100">    private boolean runOnce = false;</span>

    //set up the specific conditions
<span class="nc" id="L103">    private int lightConditions = L_DAY;</span>
<span class="nc" id="L104">    private int weatherConditions = WE_NONE;</span>
<span class="nc" id="L105">    private int oldWeatherConditions = WE_NONE;</span>
<span class="nc" id="L106">    private int windStrength = WI_NONE;</span>
<span class="nc" id="L107">    private int windDirection = DIR_RANDOM;</span>
<span class="nc" id="L108">    private boolean shiftWindDirection = false;</span>
<span class="nc" id="L109">    private boolean shiftWindStrength = false;</span>
<span class="nc" id="L110">    private boolean isSleeting = false;</span>
<span class="nc" id="L111">    private int atmosphere = ATMO_STANDARD;</span>
<span class="nc" id="L112">    private int fog = FOG_NONE;</span>
<span class="nc" id="L113">    private int temperature = 25;</span>
<span class="nc" id="L114">    private int oldTemperature = 25;</span>
<span class="nc" id="L115">    private float gravity = (float)1.0;</span>
<span class="nc" id="L116">    private boolean emi = false;</span>
<span class="nc" id="L117">    private boolean terrainAffected = true;</span>
<span class="nc" id="L118">    private int maxWindStrength = PlanetaryConditions.WI_TORNADO_F4;</span>
<span class="nc" id="L119">    private int minWindStrength = PlanetaryConditions.WI_NONE;</span>

    /**
     * Constructor
     */
<span class="nc" id="L124">    public PlanetaryConditions() {</span>

<span class="nc" id="L126">    }</span>

    /** Creates new PlanetaryConditions that is a duplicate of another */
<span class="nc" id="L129">    public PlanetaryConditions(PlanetaryConditions other) {</span>
<span class="nc" id="L130">        lightConditions = other.lightConditions;</span>
<span class="nc" id="L131">        weatherConditions = other.weatherConditions;</span>
<span class="nc" id="L132">        windStrength = other.windStrength;</span>
<span class="nc" id="L133">        windDirection = other.windDirection;</span>
<span class="nc" id="L134">        shiftWindDirection = other.shiftWindDirection;</span>
<span class="nc" id="L135">        shiftWindStrength = other.shiftWindStrength;</span>
<span class="nc" id="L136">        minWindStrength = other.minWindStrength;</span>
<span class="nc" id="L137">        maxWindStrength = other.maxWindStrength;</span>
<span class="nc" id="L138">        atmosphere = other.atmosphere;</span>
<span class="nc" id="L139">        temperature = other.temperature;</span>
<span class="nc" id="L140">        gravity = other.gravity;</span>
<span class="nc" id="L141">        emi = other.emi;</span>
<span class="nc" id="L142">        fog = other.fog;</span>
<span class="nc" id="L143">        terrainAffected = other.terrainAffected;</span>
<span class="nc" id="L144">        blowingSand = other.blowingSand;</span>
<span class="nc" id="L145">        runOnce = other.runOnce;</span>
<span class="nc" id="L146">    }</span>

    /** clone! */
    @Override
    public Object clone() {
<span class="nc" id="L151">        return new PlanetaryConditions(this);</span>
    }

    public static String getLightDisplayableName(int type) {
<span class="nc bnc" id="L155" title="All 4 branches missed.">        if ((type &gt;= 0) &amp;&amp; (type &lt; L_SIZE)) {</span>
<span class="nc" id="L156">            return Messages.getString(&quot;PlanetaryConditions.&quot; + lightNames[type]);</span>
        }
<span class="nc" id="L158">        throw new IllegalArgumentException(&quot;Unknown light condition&quot;);</span>
    }

    public static String getWeatherDisplayableName(int type) {
<span class="nc bnc" id="L162" title="All 4 branches missed.">        if ((type &gt;= 0) &amp;&amp; (type &lt; WE_SIZE)) {</span>
<span class="nc" id="L163">            return Messages.getString(&quot;PlanetaryConditions.&quot; + weatherNames[type]);</span>
        }
<span class="nc" id="L165">        throw new IllegalArgumentException(&quot;Unknown weather condition&quot;);</span>
    }

    public static String getWindDirDisplayableName(int type) {
<span class="nc bnc" id="L169" title="All 4 branches missed.">        if ((type &gt;= 0) &amp;&amp; (type &lt; DIR_SIZE)) {</span>
<span class="nc" id="L170">            return Messages.getString(&quot;PlanetaryConditions.&quot; + dirNames[type]);</span>
        }
<span class="nc" id="L172">        throw new IllegalArgumentException(&quot;Unknown wind direction&quot;);</span>
    }

    public static String getWindDisplayableName(int type) {
<span class="nc bnc" id="L176" title="All 4 branches missed.">        if ((type &gt;= 0) &amp;&amp; (type &lt; WI_SIZE)) {</span>
<span class="nc" id="L177">            return Messages.getString(&quot;PlanetaryConditions.&quot; + windNames[type]);</span>
        }
<span class="nc" id="L179">        throw new IllegalArgumentException(&quot;Unknown wind condition&quot;);</span>
    }

    public static String getAtmosphereDisplayableName(int type) {
<span class="nc bnc" id="L183" title="All 4 branches missed.">        if ((type &gt;= 0) &amp;&amp; (type &lt; ATMO_SIZE)) {</span>
<span class="nc" id="L184">            return Messages.getString(&quot;PlanetaryConditions.&quot; + atmoNames[type]);</span>
        }
<span class="nc" id="L186">        throw new IllegalArgumentException(&quot;Unknown atmospheric pressure condition&quot;);</span>
    }

    public static String getFogDisplayableName(int type) {
<span class="nc bnc" id="L190" title="All 4 branches missed.">        if ((type &gt;= 0) &amp;&amp; (type &lt; FOG_SIZE)) {</span>
<span class="nc" id="L191">            return Messages.getString(&quot;PlanetaryConditions.&quot; + fogNames[type]);</span>
        }
<span class="nc" id="L193">        throw new IllegalArgumentException(&quot;Unknown fog condition&quot;);</span>
    }

    public String getWindDirDisplayableName() {
<span class="nc" id="L197">        return getWindDirDisplayableName(windDirection);</span>
    }

    public String getLightDisplayableName() {
<span class="nc" id="L201">        return getLightDisplayableName(lightConditions);</span>
    }

    public String getWeatherDisplayableName() {
<span class="nc" id="L205">        return getWeatherDisplayableName(weatherConditions);</span>
    }

    public String getWindDisplayableName() {
<span class="nc" id="L209">        return getWindDisplayableName(windStrength);</span>
    }

    public String getAtmosphereDisplayableName() {
<span class="nc" id="L213">        return getAtmosphereDisplayableName(atmosphere);</span>
    }

    public String getFogDisplayableName() {
<span class="nc" id="L217">        return getFogDisplayableName(fog);</span>
    }

    /**
     * to-hit penalty for light
     */
    public int getLightHitPenalty(boolean isWeapon) {
<span class="nc" id="L224">        int penalty = 0;</span>
<span class="nc bnc" id="L225" title="All 2 branches missed.">        if(isWeapon) {</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">            if(lightConditions == L_DUSK) {</span>
<span class="nc" id="L227">                penalty = 1;</span>
            }
<span class="nc bnc" id="L229" title="All 2 branches missed.">            else if(lightConditions == L_FULL_MOON) {</span>
<span class="nc" id="L230">                penalty = 2;</span>
            }
<span class="nc bnc" id="L232" title="All 2 branches missed.">            else if(lightConditions == L_MOONLESS) {</span>
<span class="nc" id="L233">                penalty = 3;</span>
            }
<span class="nc bnc" id="L235" title="All 2 branches missed.">            else if(lightConditions == L_PITCH_BLACK) {</span>
<span class="nc" id="L236">                penalty = 4;</span>
            }
        }
        else {
<span class="nc bnc" id="L240" title="All 2 branches missed.">            if(lightConditions == L_MOONLESS) {</span>
<span class="nc" id="L241">                penalty = 1;</span>
            }
<span class="nc bnc" id="L243" title="All 2 branches missed.">            else if(lightConditions == L_PITCH_BLACK) {</span>
<span class="nc" id="L244">                penalty = 2;</span>
            }
        }

<span class="nc" id="L248">        return penalty;</span>
    }

    /**
     * heat bonus to hit for being overheated in darkness
     */
    public int getLightHeatBonus(int heat) {
<span class="nc" id="L255">        double divisor = 10000.0;</span>
<span class="nc bnc" id="L256" title="All 2 branches missed.">        if(lightConditions == L_DUSK) {</span>
<span class="nc" id="L257">            divisor = 25.0;</span>
        }
<span class="nc bnc" id="L259" title="All 2 branches missed.">        else if(lightConditions == L_FULL_MOON) {</span>
<span class="nc" id="L260">            divisor = 20.0;</span>
        }
<span class="nc bnc" id="L262" title="All 2 branches missed.">        else if(lightConditions == L_MOONLESS) {</span>
<span class="nc" id="L263">            divisor = 15.0;</span>
        }
<span class="nc bnc" id="L265" title="All 2 branches missed.">        else if(lightConditions == L_PITCH_BLACK) {</span>
<span class="nc" id="L266">            divisor = 10.0;</span>
        }
<span class="nc" id="L268">        return (-1 * (int)Math.floor(heat / divisor));</span>
    }

    /**
     * piloting penalty for running/flanking/etc for light
     */
    public int getLightPilotPenalty() {
<span class="nc bnc" id="L275" title="All 2 branches missed.">        if(lightConditions == L_MOONLESS) {</span>
<span class="nc" id="L276">            return 1;</span>
        }
<span class="nc bnc" id="L278" title="All 2 branches missed.">        else if(lightConditions == L_PITCH_BLACK) {</span>
<span class="nc" id="L279">            return 2;</span>
        }
<span class="nc" id="L281">        return 0;</span>
    }

    /**
     * to-hit penalty for weather
     */
    public int getWeatherHitPenalty(Entity en) {
<span class="nc bnc" id="L288" title="All 8 branches missed.">        if(((weatherConditions == WE_LIGHT_RAIN) || (weatherConditions == WE_LIGHT_SNOW))</span>
                &amp;&amp; (en instanceof Infantry) &amp;&amp; !(en instanceof BattleArmor)) {
<span class="nc" id="L290">            return 1;</span>
        }
<span class="nc bnc" id="L292" title="All 16 branches missed.">        else if((weatherConditions == WE_MOD_RAIN) || (weatherConditions == WE_HEAVY_RAIN)</span>
                || (weatherConditions == WE_MOD_SNOW) || (weatherConditions == WE_HEAVY_SNOW)
                || (weatherConditions == WE_SLEET) || (weatherConditions == WE_GUSTING_RAIN)
                || (weatherConditions == WE_SNOW_FLURRIES) || (weatherConditions == WE_BLIZZARD)) {
<span class="nc" id="L296">            return 1;</span>
        }
<span class="nc bnc" id="L298" title="All 2 branches missed.">        else if(weatherConditions == WE_DOWNPOUR) {</span>
<span class="nc" id="L299">            return 2;</span>
        }
        else  {
<span class="nc" id="L302">            return 0;</span>
        }
    }

    /**
     * piloting penalty for weather
     */
    public int getWeatherPilotPenalty() {
<span class="nc bnc" id="L310" title="All 8 branches missed.">        if((weatherConditions == WE_HEAVY_RAIN) || (weatherConditions == WE_HEAVY_SNOW)</span>
                || (weatherConditions == WE_GUSTING_RAIN) || (weatherConditions == WE_BLIZZARD)) {
<span class="nc" id="L312">            return 1;</span>
        }
<span class="nc bnc" id="L314" title="All 2 branches missed.">        else if(weatherConditions == WE_DOWNPOUR) {</span>
<span class="nc" id="L315">            return 2;</span>
        }
        else  {
<span class="nc" id="L318">            return 0;</span>
        }
    }


    /**
     * gravity penalties to PSRs
     * According to email from TPTB, you apply a penalty for every 0.5 gravities above or below 1 (rounding up)
     */
    public int getGravityPilotPenalty() {
<span class="nc" id="L328">        return (int)Math.floor(Math.abs(gravity - 1.0) / 0.5);</span>
    }

    /**
     * piloting penalty for wind
     */
    public int getWindPilotPenalty(Entity en) {
<span class="nc" id="L335">        int penalty = 0;</span>

<span class="nc bnc" id="L337" title="All 6 branches missed.">        switch(windStrength) {</span>
        case (WI_MOD_GALE):
<span class="nc bnc" id="L339" title="All 4 branches missed.">            if((en instanceof VTOL) || (en.getMovementMode() == EntityMovementMode.WIGE)) {</span>
<span class="nc" id="L340">                penalty = 1;</span>
            }
            break;
        case (WI_STRONG_GALE):
<span class="nc bnc" id="L344" title="All 4 branches missed.">            if((en instanceof VTOL) || (en.getMovementMode() == EntityMovementMode.WIGE)</span>
<span class="nc bnc" id="L345" title="All 2 branches missed.">                    || (en.getMovementMode() == EntityMovementMode.HOVER)) {</span>
<span class="nc" id="L346">                penalty = 2;</span>
            }
<span class="nc bnc" id="L348" title="All 4 branches missed.">            else if((en instanceof Mech) || (en.isAirborne())) {</span>
<span class="nc" id="L349">                penalty = 1;</span>
            }
            break;
        case (WI_STORM):
<span class="nc bnc" id="L353" title="All 6 branches missed.">            if((en instanceof VTOL) || (en instanceof Mech) || (en.getMovementMode() == EntityMovementMode.WIGE)</span>
<span class="nc bnc" id="L354" title="All 2 branches missed.">                    || (en.getMovementMode() == EntityMovementMode.HOVER)) {</span>
<span class="nc" id="L355">                penalty = 3;</span>
            }
<span class="nc bnc" id="L357" title="All 2 branches missed.">            else if(en.isAirborne()) {</span>
<span class="nc" id="L358">                penalty = 2;</span>
            }
            break;
        case (WI_TORNADO_F13):
<span class="nc" id="L362">            penalty = 3;</span>
<span class="nc" id="L363">            break;</span>
        case (WI_TORNADO_F4):
<span class="nc" id="L365">            penalty = 5;</span>
<span class="nc" id="L366">            break;</span>
        default:
<span class="nc" id="L368">            penalty = 0;</span>
        }
<span class="nc" id="L370">        return penalty;</span>
    }

    public void determineWind() {
<span class="nc bnc" id="L374" title="All 2 branches missed.">        if (windDirection == DIR_RANDOM) {</span>
            // Initial wind direction. If using level 2 rules, this
            // will be the wind direction for the whole battle.
<span class="nc" id="L377">            windDirection = Compute.d6(1) - 1;</span>
<span class="nc bnc" id="L378" title="All 2 branches missed.">        } else if (shiftWindDirection) {</span>
            // Wind direction changes on a roll of 1 or 6
<span class="nc bnc" id="L380" title="All 3 branches missed.">            switch (Compute.d6()) {</span>
                case 1: // rotate clockwise
<span class="nc" id="L382">                    windDirection = (windDirection + 1) % 6;</span>
<span class="nc" id="L383">                    break;</span>
                case 6: // rotate counter-clockwise
<span class="nc" id="L385">                    windDirection = (windDirection + 5) % 6;</span>
            }
        }
<span class="nc bnc" id="L388" title="All 2 branches missed.">        if (shiftWindStrength) {</span>
            // Wind strength changes on a roll of 1 or 6
<span class="nc bnc" id="L390" title="All 3 branches missed.">            switch (Compute.d6()) {</span>
            case 1: // weaker
<span class="nc" id="L392">                windStrength = Math.max(minWindStrength, --windStrength);</span>
<span class="nc" id="L393">                doSleetCheck();</span>
<span class="nc" id="L394">                doSandStormCheck();</span>
<span class="nc" id="L395">                break;</span>
            case 6: // stronger
<span class="nc" id="L397">                windStrength = Math.min(maxWindStrength, ++windStrength);</span>
<span class="nc" id="L398">                doSleetCheck();</span>
<span class="nc" id="L399">                doSandStormCheck();</span>
                break;
            }
        }

        //atmospheric pressure may limit wind strength
<span class="nc bnc" id="L405" title="All 4 branches missed.">        if((atmosphere == ATMO_TRACE) &amp;&amp; (windStrength &gt; WI_STORM)) {</span>
<span class="nc" id="L406">            windStrength = WI_STORM;</span>
        }

<span class="nc bnc" id="L409" title="All 4 branches missed.">        if((atmosphere ==ATMO_THIN) &amp;&amp; (windStrength &gt; WI_TORNADO_F13)) {</span>
<span class="nc" id="L410">            windStrength = WI_TORNADO_F13;</span>
        }
<span class="nc" id="L412">    }</span>

    /**
     * modifiers for fire ignition
     */
    public int getIgniteModifiers() {
<span class="nc" id="L418">        int mod = 0;</span>

<span class="nc bnc" id="L420" title="All 4 branches missed.">        if((weatherConditions == WE_LIGHT_RAIN) || (weatherConditions == WE_MOD_RAIN)) {</span>
<span class="nc" id="L421">            mod += 1;</span>
        }
<span class="nc bnc" id="L423" title="All 12 branches missed.">        if((weatherConditions == WE_HEAVY_RAIN) || (weatherConditions == WE_DOWNPOUR)</span>
                || (weatherConditions == WE_LIGHT_SNOW) || (weatherConditions == WE_MOD_SNOW)
                || (weatherConditions == WE_GUSTING_RAIN) || (weatherConditions == WE_SNOW_FLURRIES)) {
<span class="nc" id="L426">            mod += 2;</span>
        }
<span class="nc bnc" id="L428" title="All 8 branches missed.">        if((weatherConditions == WE_HEAVY_SNOW) || (weatherConditions == WE_BLIZZARD)</span>
                || (weatherConditions == WE_LIGHT_HAIL) || (weatherConditions == WE_HEAVY_HAIL)) {
<span class="nc" id="L430">            mod += 3;</span>
        }
<span class="nc bnc" id="L432" title="All 4 branches missed.">        if((windStrength == WI_LIGHT_GALE) || (windStrength == WI_MOD_GALE)) {</span>
<span class="nc" id="L433">            mod += 2;</span>
        }
<span class="nc bnc" id="L435" title="All 6 branches missed.">        if((windStrength == WI_STRONG_GALE) || (windStrength == WI_STORM) || (weatherConditions == WE_ICE_STORM)) {</span>
<span class="nc" id="L436">            mod += 4;</span>
        }
<span class="nc bnc" id="L438" title="All 2 branches missed.">        if (getTemperature() &gt; 30) {</span>
<span class="nc" id="L439">            mod -= getTemperatureDifference(30,-30);</span>
<span class="nc bnc" id="L440" title="All 2 branches missed.">        } else if (getTemperature() &lt; 30) {</span>
<span class="nc" id="L441">            mod += getTemperatureDifference(30, -30);</span>
        }

<span class="nc" id="L444">        return mod;</span>
    }

    /**
     * Do a roll for these weather conditions putting out fire
     * return boolean
     */
    public boolean putOutFire() {
<span class="nc" id="L452">        int roll = Compute.d6(2);</span>
<span class="nc bnc" id="L453" title="All 5 branches missed.">        switch(weatherConditions) {</span>
        case (WE_LIGHT_HAIL):
        case (WE_LIGHT_RAIN):
        case (WE_LIGHT_SNOW):
<span class="nc" id="L457">            roll = roll + 1;</span>
<span class="nc" id="L458">            break;</span>
        case (WE_HEAVY_HAIL):
        case (WE_MOD_RAIN):
        case (WE_MOD_SNOW):
        case WE_SNOW_FLURRIES:
<span class="nc" id="L463">            roll = roll + 2;</span>
<span class="nc" id="L464">            break;</span>
        case (WE_HEAVY_RAIN):
        case (WE_GUSTING_RAIN):
        case (WE_HEAVY_SNOW):
        case WE_BLIZZARD:
<span class="nc" id="L469">            roll = roll + 3;</span>
<span class="nc" id="L470">            break;</span>
        case (WE_DOWNPOUR):
<span class="nc" id="L472">            roll = roll + 4;</span>
<span class="nc" id="L473">            break;</span>
        default:
<span class="nc" id="L475">            roll = -1;</span>
        }

<span class="nc bnc" id="L478" title="All 2 branches missed.">        if(roll &gt; 10) {</span>
<span class="nc" id="L479">            return true;</span>
        }

<span class="nc" id="L482">          return false;</span>
    }

    /**
     * Returns how much higher or lower than a given range, divided by
     * ten, rounded up, the temperature is
     */

    public int getTemperatureDifference(int high, int low) {
<span class="nc" id="L491">        int i = 0;</span>
        //if the low is more than the high, reverse
<span class="nc bnc" id="L493" title="All 2 branches missed.">        if(low &gt; high) {</span>
<span class="nc" id="L494">            int tempLow = low;</span>
<span class="nc" id="L495">            low = high;</span>
<span class="nc" id="L496">            high = tempLow;</span>

        }
<span class="nc bnc" id="L499" title="All 2 branches missed.">        if ((getTemperature() &gt;= low)</span>
<span class="nc bnc" id="L500" title="All 2 branches missed.">                &amp;&amp; (getTemperature() &lt;= high)) {</span>
<span class="nc" id="L501">            return i;</span>
<span class="nc bnc" id="L502" title="All 2 branches missed.">        } else if (getTemperature() &lt; low) {</span>
            do {
<span class="nc" id="L504">                i++;</span>
<span class="nc bnc" id="L505" title="All 2 branches missed.">            } while ((getTemperature() + (i * 10)) &lt; low);</span>
<span class="nc" id="L506">            return i;</span>
        } else {
            do {
<span class="nc" id="L509">                i++;</span>
<span class="nc bnc" id="L510" title="All 2 branches missed.">            } while ((getTemperature() - (i * 10)) &gt; high);</span>
        }
<span class="nc" id="L512">        return i;</span>
    }

    /**
     *
     * @return a &lt;code&gt;String&lt;/code&gt; with the reason why you cannot start a fire here
     */
    public String cannotStartFire() {
<span class="nc bnc" id="L520" title="All 2 branches missed.">        if(atmosphere &lt; ATMO_THIN) {</span>
<span class="nc" id="L521">            return &quot;atmosphere this thin&quot;;</span>
        }
<span class="nc bnc" id="L523" title="All 2 branches missed.">        if(windStrength &gt; WI_STORM) {</span>
<span class="nc" id="L524">            return &quot;a tornado&quot;;</span>
        }

<span class="nc" id="L527">        return null;</span>
    }

    /**
     * Planetary conditions on movement, except for gravity
     * @param en - the entity in question
     * @return an &lt;code&gt;int&lt;/code&gt; with the modifier to movement
     */
    public int getMovementMods(Entity en) {
<span class="nc" id="L536">        int mod = 0;</span>

        // weather mods are calculated based on conditional effects ie extreme temperatures, wind

        // wind mods
<span class="nc bnc" id="L541" title="All 5 branches missed.">        switch(windStrength) {</span>
        case(WI_LIGHT_GALE):
<span class="nc bnc" id="L543" title="All 2 branches missed.">            if(!(en instanceof BattleArmor)</span>
<span class="nc bnc" id="L544" title="All 2 branches missed.">                    &amp;&amp; ((en.getMovementMode() == EntityMovementMode.INF_LEG)</span>
<span class="nc bnc" id="L545" title="All 2 branches missed.">                            || (en.getMovementMode() == EntityMovementMode.INF_JUMP))) {</span>
<span class="nc" id="L546">                mod -= 1;</span>
            }
            break;
        case (WI_MOD_GALE):
<span class="nc bnc" id="L550" title="All 4 branches missed.">            if((en instanceof Infantry) &amp;&amp; !(en instanceof BattleArmor)) {</span>
<span class="nc" id="L551">                mod -= 1;</span>
            }
            break;
        case (WI_STRONG_GALE):
        case (WI_STORM):
<span class="nc bnc" id="L556" title="All 2 branches missed.">            if(en instanceof BattleArmor) {</span>
<span class="nc" id="L557">                mod -= 1;</span>
            }
<span class="nc bnc" id="L559" title="All 2 branches missed.">            else if(en instanceof Infantry) {</span>
<span class="nc" id="L560">                mod -= 2;</span>
            }
            break;
        case (WI_TORNADO_F13):
<span class="nc bnc" id="L564" title="All 2 branches missed.">            if(en.isAirborne()) {</span>
<span class="nc" id="L565">                mod -= 1;</span>
            }
            else {
<span class="nc" id="L568">                mod -= 2;</span>
            }
            break;
        }

        // atmospheric pressure mods
<span class="nc bnc" id="L574" title="All 3 branches missed.">        switch(atmosphere) {</span>
        case(ATMO_THIN):
<span class="nc bnc" id="L576" title="All 2 branches missed.">            if((en.getMovementMode() == EntityMovementMode.HOVER)</span>
<span class="nc bnc" id="L577" title="All 2 branches missed.">                    || (en.getMovementMode() == EntityMovementMode.WIGE)</span>
<span class="nc bnc" id="L578" title="All 2 branches missed.">                    || (en.getMovementMode() == EntityMovementMode.VTOL)) {</span>
<span class="nc" id="L579">                mod -= 2;</span>
            }
            break;
        case(ATMO_HIGH):
        case(ATMO_VHIGH):
<span class="nc bnc" id="L584" title="All 2 branches missed.">            if((en.getMovementMode() == EntityMovementMode.HOVER)</span>
<span class="nc bnc" id="L585" title="All 2 branches missed.">                    || (en.getMovementMode() == EntityMovementMode.WIGE)</span>
<span class="nc bnc" id="L586" title="All 2 branches missed.">                    || (en.getMovementMode() == EntityMovementMode.VTOL)) {</span>
<span class="nc" id="L587">                mod += 1;</span>
            }
            break;
        }

        // temperature difference
<span class="nc bnc" id="L593" title="All 8 branches missed.">        if((en instanceof Tank) || ((en instanceof Infantry) &amp;&amp; !((Infantry)en).isXCT()) || (en instanceof Protomech)) {</span>
<span class="nc" id="L594">            mod -= Math.abs(getTemperatureDifference(50,-30));</span>
        }

<span class="nc" id="L597">        return mod;</span>
    }

    /**
     * is the given entity type doomed in these conditions?
     * @return a string given the reason for being doomed, null if not doomed
     */
    public String whyDoomed(Entity en, IGame game) {
<span class="nc bnc" id="L605" title="All 4 branches missed.">        if ((atmosphere &lt; ATMO_THIN) &amp;&amp; en.doomedInVacuum()) {</span>
<span class="nc" id="L606">            return &quot;vacuum&quot;;</span>
        }
<span class="nc bnc" id="L608" title="All 4 branches missed.">        if ((windStrength == WI_TORNADO_F4) &amp;&amp; !(en instanceof Mech)) {</span>
<span class="nc" id="L609">            return &quot;tornado&quot;;</span>
        }
<span class="nc bnc" id="L611" title="All 6 branches missed.">        if ((windStrength == WI_TORNADO_F13)</span>
                &amp;&amp; (((en instanceof Infantry) &amp;&amp; !(en instanceof BattleArmor))
<span class="nc bnc" id="L613" title="All 2 branches missed.">                        || ((en.getMovementMode() == EntityMovementMode.HOVER)</span>
<span class="nc bnc" id="L614" title="All 2 branches missed.">                    || (en.getMovementMode() == EntityMovementMode.WIGE)</span>
<span class="nc bnc" id="L615" title="All 2 branches missed.">                    || (en.getMovementMode() == EntityMovementMode.VTOL)))) {</span>
<span class="nc" id="L616">            return &quot;tornado&quot;;</span>
        }
<span class="nc bnc" id="L618" title="All 6 branches missed.">        if((windStrength == WI_STORM) &amp;&amp; ((en instanceof Infantry) &amp;&amp; !(en instanceof BattleArmor))) {</span>
<span class="nc" id="L619">            return &quot;storm&quot;;</span>
        }
<span class="nc bnc" id="L621" title="All 6 branches missed.">        if ((temperature &gt; 50 || temperature &lt; -30) &amp;&amp; en.doomedInExtremeTemp()) {</span>
<span class="nc bnc" id="L622" title="All 2 branches missed.">            if (Compute.isInBuilding(game, en)) {</span>
<span class="nc" id="L623">                return null;</span>
            }
<span class="nc" id="L625">            return &quot;extreme temperature&quot;;</span>
        }
<span class="nc" id="L627">        return null;</span>
    }

    /**
     * visual range based on conditions
     *
     */
    public int getVisualRange(Entity en, boolean targetIlluminated) {

<span class="nc" id="L636">        boolean Spotlight = false;</span>

<span class="nc" id="L638">        boolean isMechVee = false;</span>
<span class="nc" id="L639">        boolean isLargeCraft = false;</span>
<span class="nc" id="L640">        boolean isAero = false;</span>

        //Needed for MekWars for Maximum Visual Range.
<span class="nc bnc" id="L643" title="All 2 branches missed.">        if ( en == null ) {</span>
<span class="nc" id="L644">            isMechVee = true;</span>
<span class="nc" id="L645">            Spotlight = targetIlluminated;</span>
        }else {
<span class="nc" id="L647">            Spotlight = en.isUsingSpotlight();</span>
<span class="nc bnc" id="L648" title="All 6 branches missed.">            isMechVee = (en instanceof Mech &amp;&amp; !en.isAero()) || (en instanceof Tank);</span>
<span class="nc bnc" id="L649" title="All 4 branches missed.">            isLargeCraft = (en instanceof Dropship) || (en instanceof Jumpship);</span>
<span class="nc bnc" id="L650" title="All 4 branches missed.">            isAero = (en.isAero()) &amp;&amp; !isLargeCraft;</span>
        }
        //anything else is infantry
        
        //Beyond altitude 9, Aeros can't see. No need to repeat this test.
<span class="nc bnc" id="L655" title="All 4 branches missed.">        if (isAero &amp;&amp; (en.getAltitude() &gt; 9)) {</span>
<span class="nc" id="L656">            return 0;</span>
        }
        
        //New rulings per v3.02 errata. Spotlights are easier, yay!
        //Illuminated?  Flat 45 hex distance
<span class="nc bnc" id="L661" title="All 4 branches missed.">        if (targetIlluminated &amp;&amp; (lightConditions &gt; L_DAY)) {</span>
<span class="nc" id="L662">            return 45;</span>
<span class="nc bnc" id="L663" title="All 4 branches missed.">        } else if (Spotlight &amp;&amp; (lightConditions &gt; L_DAY)) {</span>
            //Using a searchlight?  Flat 30 hex range
<span class="nc bnc" id="L665" title="All 6 branches missed.">            if (isMechVee || isAero || isLargeCraft) {</span>
<span class="nc" id="L666">                return 30;</span>
            }
            //Except infantry/handheld, 10 hexes
<span class="nc" id="L669">            return 10;</span>
<span class="nc bnc" id="L670" title="All 2 branches missed.">        } else if (lightConditions == L_PITCH_BLACK) {</span>
<span class="nc bnc" id="L671" title="All 6 branches missed.">            if (isMechVee || (isAero &amp;&amp; (en.getAltitude() &lt; 2))) {</span>
<span class="nc" id="L672">                return 3;</span>
            }
<span class="nc bnc" id="L674" title="All 2 branches missed.">            if (isAero) {</span>
<span class="nc" id="L675">                return 5;</span>
            }
<span class="nc bnc" id="L677" title="All 2 branches missed.">            if (isLargeCraft) {</span>
<span class="nc" id="L678">                return 4;</span>
            }
<span class="nc" id="L680">            return 1;</span>
<span class="nc bnc" id="L681" title="All 4 branches missed.">        } else if ((lightConditions == L_MOONLESS)</span>
                || (fog == FOG_HEAVY)) {
<span class="nc bnc" id="L683" title="All 6 branches missed.">            if(isMechVee || (isAero &amp;&amp; (en.getAltitude() &lt; 2))) {</span>
<span class="nc" id="L684">                return 5;</span>
            }
<span class="nc bnc" id="L686" title="All 2 branches missed.">            if (isAero) {</span>
<span class="nc" id="L687">                return 10;</span>
            }
<span class="nc bnc" id="L689" title="All 2 branches missed.">            if (isLargeCraft) {</span>
<span class="nc" id="L690">                return 8;</span>
            }
<span class="nc" id="L692">            return 2;</span>
<span class="nc bnc" id="L693" title="All 20 branches missed.">        } else if ((weatherConditions == WE_HEAVY_HAIL)</span>
                || (weatherConditions == WE_SLEET)
                || (weatherConditions == WE_HEAVY_SNOW)
                || (blowingSand &amp;&amp; (windStrength &gt;= WI_MOD_GALE))
                || (lightConditions == L_FULL_MOON)
                || (weatherConditions == WE_GUSTING_RAIN)
                || (weatherConditions == WE_BLIZZARD)
                || (weatherConditions == WE_ICE_STORM)
                || (weatherConditions == WE_DOWNPOUR)) {
<span class="nc bnc" id="L702" title="All 6 branches missed.">            if (isMechVee || (isAero &amp;&amp; (en.getAltitude() &lt; 2))) {</span>
<span class="nc" id="L703">                return 10;</span>
            }
<span class="nc bnc" id="L705" title="All 2 branches missed.">            if (isAero) {</span>
<span class="nc" id="L706">                return 20;</span>
            }
<span class="nc bnc" id="L708" title="All 2 branches missed.">            if (isLargeCraft) {</span>
<span class="nc" id="L709">                return 15;</span>
            }
<span class="nc" id="L711">            return 5;</span>
<span class="nc bnc" id="L712" title="All 10 branches missed.">        } else if ((lightConditions == L_DUSK)</span>
                || (weatherConditions == WE_HEAVY_RAIN)
                || (weatherConditions == WE_SNOW_FLURRIES)
                || (weatherConditions == WE_MOD_SNOW) &amp;&amp; (windStrength &gt;= WI_MOD_GALE)) {
<span class="nc bnc" id="L716" title="All 6 branches missed.">            if (isMechVee || (isAero &amp;&amp; (en.getAltitude() &lt; 2))) {</span>
<span class="nc" id="L717">                return 15;</span>
            }
<span class="nc bnc" id="L719" title="All 2 branches missed.">            if (isAero) {</span>
<span class="nc" id="L720">                return 30;</span>
            }
<span class="nc bnc" id="L722" title="All 2 branches missed.">            if (isLargeCraft) {</span>
<span class="nc" id="L723">                return 20;</span>
            }
<span class="nc" id="L725">            return 8;</span>
<span class="nc bnc" id="L726" title="All 4 branches missed.">        } else if ((weatherConditions == WE_MOD_SNOW)</span>
                || (weatherConditions == WE_MOD_RAIN)) {
<span class="nc bnc" id="L728" title="All 6 branches missed.">            if (isMechVee || (isAero &amp;&amp; (en.getAltitude() &lt; 2))) {</span>
<span class="nc" id="L729">                return 20;</span>
            }
<span class="nc bnc" id="L731" title="All 2 branches missed.">            if (isAero) {</span>
<span class="nc" id="L732">                return 50;</span>
            }
<span class="nc bnc" id="L734" title="All 2 branches missed.">            if (isLargeCraft) {</span>
<span class="nc" id="L735">                return 25;</span>
            }
<span class="nc" id="L737">            return 10;</span>
<span class="nc bnc" id="L738" title="All 10 branches missed.">        } else if ((lightConditions &gt; L_DAY)</span>
                || (weatherConditions == WE_LIGHT_SNOW)
                || (weatherConditions == WE_LIGHT_RAIN)
                || (weatherConditions == WE_LIGHT_HAIL) 
                || (fog == FOG_LIGHT)) {
<span class="nc bnc" id="L743" title="All 6 branches missed.">            if (isMechVee || (isAero &amp;&amp; (en.getAltitude() &lt; 2))) {</span>
<span class="nc" id="L744">                return 30;</span>
            }
<span class="nc bnc" id="L746" title="All 2 branches missed.">            if (isAero) {</span>
<span class="nc" id="L747">                return 60;</span>
            }
<span class="nc bnc" id="L749" title="All 2 branches missed.">            if (isLargeCraft) {</span>
<span class="nc" id="L750">                return 35;</span>
            }
<span class="nc" id="L752">            return 15;</span>
        } else {
<span class="nc bnc" id="L754" title="All 6 branches missed.">            if (isMechVee || (isAero &amp;&amp; (en.getAltitude() &lt; 2))) {</span>
<span class="nc" id="L755">                return 60;</span>
            }
<span class="nc bnc" id="L757" title="All 2 branches missed.">            if (isAero) {</span>
<span class="nc" id="L758">                return 120;</span>
            }
<span class="nc bnc" id="L760" title="All 2 branches missed.">            if (isLargeCraft) {</span>
<span class="nc" id="L761">                return 70;</span>
            }
<span class="nc" id="L763">            return 30;</span>
        }
    }

    public int getDropRate() {

        //atmospheric pressure mods
<span class="nc bnc" id="L770" title="All 5 branches missed.">        switch(atmosphere) {</span>
        case(ATMO_TRACE):
<span class="nc" id="L772">            return 8;</span>
        case(ATMO_THIN):
<span class="nc" id="L774">            return 5;</span>
        case(ATMO_HIGH):
<span class="nc" id="L776">            return 2;</span>
        case(ATMO_VHIGH):
<span class="nc" id="L778">            return 1;</span>
        default:
<span class="nc" id="L780">            return 3;</span>
        }
    }

    public void setLight(int type) {
<span class="nc" id="L785">        lightConditions = type;</span>
<span class="nc" id="L786">    }</span>


    /** @return The time of day lighting conditions (one of PlanetaryConditions.L_*). */
    public int getLight() {
<span class="nc" id="L791">        return lightConditions;</span>
    }

    public void setWeather(int type) {
<span class="nc" id="L795">        weatherConditions = type;</span>
<span class="nc" id="L796">    }</span>

    public int getWeather() {
<span class="nc" id="L799">        return weatherConditions;</span>
    }

    public void setWindStrength(int type) {
<span class="nc" id="L803">        windStrength = type;</span>
<span class="nc" id="L804">    }</span>

    public int getWindStrength() {
<span class="nc" id="L807">        return windStrength;</span>
    }

    public void setWindDirection(int type) {
<span class="nc" id="L811">        windDirection = type;</span>
<span class="nc" id="L812">    }</span>

    public int getWindDirection() {
<span class="nc" id="L815">        return windDirection;</span>
    }

    public void setShiftingWindDirection(boolean b) {
<span class="nc" id="L819">        shiftWindDirection = b;</span>
<span class="nc" id="L820">    }</span>

    public boolean shiftingWindDirection() {
<span class="nc" id="L823">        return shiftWindDirection;</span>
    }

    public void setShiftingWindStrength(boolean b) {
<span class="nc" id="L827">        shiftWindStrength = b;</span>
<span class="nc" id="L828">    }</span>

    public boolean shiftingWindStrength() {
<span class="nc" id="L831">        return shiftWindStrength;</span>
    }

    public void setAtmosphere(int a) {
<span class="nc" id="L835">        atmosphere = a;</span>
<span class="nc" id="L836">    }</span>

    public int getAtmosphere() {
<span class="nc" id="L839">        return atmosphere;</span>
    }

    public void setTemperature(int tem) {
<span class="nc" id="L843">        temperature = tem;</span>
<span class="nc" id="L844">    }</span>

    public int getTemperature() {
<span class="nc" id="L847">        return temperature;</span>
    }

    public boolean isVacuum() {
<span class="nc bnc" id="L851" title="All 4 branches missed.">        return (atmosphere == ATMO_VACUUM) || (atmosphere == ATMO_TRACE);</span>
    }

    public void setGravity(float f) {
<span class="nc" id="L855">        gravity = f;</span>
<span class="nc" id="L856">    }</span>

    public float getGravity() {
<span class="nc" id="L859">        return gravity;</span>
    }

    public void setEMI(boolean b) {
<span class="nc" id="L863">        emi = b;</span>
<span class="nc" id="L864">    }</span>

    public boolean hasEMI() {
<span class="nc" id="L867">        return emi;</span>
    }

    public int getFog() {
<span class="nc" id="L871">        return fog;</span>
    }

    public void setFog(int fog) {
<span class="nc" id="L875">        this.fog = fog;</span>
<span class="nc" id="L876">    }</span>

    public void setTerrainAffected(boolean b) {
<span class="nc" id="L879">        terrainAffected = b;</span>
<span class="nc" id="L880">    }</span>

    //can weather alter the terrain (add snow, mud, etc.)
    public boolean isTerrainAffected() {
<span class="nc" id="L884">        return terrainAffected;</span>
    }

    public boolean isRecklessConditions() {
<span class="nc bnc" id="L888" title="All 4 branches missed.">        return (fog &gt; FOG_NONE) || (lightConditions &gt; L_DUSK);</span>
    }

    public int getMaxWindStrength(){
<span class="nc" id="L892">        return maxWindStrength;</span>
    }

    public void setMaxWindStrength(int strength){
<span class="nc" id="L896">        maxWindStrength = strength;</span>
<span class="nc" id="L897">    }</span>

    public int getMinWindStrength(){
<span class="nc" id="L900">        return minWindStrength;</span>
    }

    public void setMinWindStrength(int strength){
<span class="nc" id="L904">        minWindStrength = strength;</span>
<span class="nc" id="L905">    }</span>

    public boolean isSandBlowing() {
<span class="nc" id="L908">        return blowingSand;</span>
    }

    public void setBlowingSand(boolean b) {
<span class="nc" id="L912">        blowingSand = b;</span>
<span class="nc" id="L913">    }</span>

    public void alterConditions(PlanetaryConditions conditions) {
<span class="nc" id="L916">        lightConditions = conditions.lightConditions;</span>
<span class="nc" id="L917">        weatherConditions = conditions.weatherConditions;</span>
<span class="nc" id="L918">        windStrength = conditions.windStrength;</span>
<span class="nc" id="L919">        windDirection = conditions.windDirection;</span>
<span class="nc" id="L920">        shiftWindDirection = conditions.shiftWindDirection;</span>
<span class="nc" id="L921">        shiftWindStrength = conditions.shiftWindStrength;</span>
<span class="nc" id="L922">        minWindStrength = conditions.minWindStrength;</span>
<span class="nc" id="L923">        maxWindStrength = conditions.maxWindStrength;</span>
<span class="nc" id="L924">        atmosphere = conditions.atmosphere;</span>
<span class="nc" id="L925">        temperature = conditions.temperature;</span>
<span class="nc" id="L926">        gravity = conditions.gravity;</span>
<span class="nc" id="L927">        emi = conditions.emi;</span>
<span class="nc" id="L928">        fog = conditions.fog;</span>
<span class="nc" id="L929">        terrainAffected = conditions.terrainAffected;</span>
<span class="nc" id="L930">        blowingSand = conditions.blowingSand;</span>
<span class="nc" id="L931">        runOnce = conditions.runOnce;</span>

<span class="nc bnc" id="L933" title="All 2 branches missed.">        if (!runOnce) {</span>
<span class="nc" id="L934">            setTempFromWeather();</span>
<span class="nc" id="L935">            setWindFromWeather();</span>
<span class="nc" id="L936">            setSandStorm();</span>
<span class="nc" id="L937">            runOnce = true;</span>
        }

<span class="nc" id="L940">    }</span>

    private void setTempFromWeather() {
<span class="nc bnc" id="L943" title="All 4 branches missed.">        switch (weatherConditions) {</span>
            case WE_SLEET:
            case WE_LIGHT_SNOW:
<span class="nc" id="L946">                temperature = -40;</span>
<span class="nc" id="L947">                break;</span>
            case WE_MOD_SNOW:
            case WE_SNOW_FLURRIES:
            case WE_HEAVY_SNOW:
            case WE_BLIZZARD:
<span class="nc" id="L952">                temperature = -50;</span>
<span class="nc" id="L953">                break;</span>
            case WE_ICE_STORM:
<span class="nc" id="L955">                temperature = -60;</span>
                break;
        }
<span class="nc" id="L958">    }</span>

    private void setWindFromWeather() {
<span class="nc bnc" id="L961" title="All 4 branches missed.">        switch (weatherConditions) {</span>
            case WE_SLEET:
<span class="nc" id="L963">                setSleet(true);</span>
<span class="nc" id="L964">                break;</span>
            case WE_ICE_STORM:
            case WE_SNOW_FLURRIES:
<span class="nc" id="L967">                windStrength = WI_MOD_GALE;</span>
<span class="nc" id="L968">                shiftWindStrength = false;</span>
<span class="nc" id="L969">                break;</span>
            case WE_GUSTING_RAIN:
            case WE_BLIZZARD:
<span class="nc" id="L972">                windStrength = WI_STRONG_GALE;</span>
<span class="nc" id="L973">                shiftWindStrength = false;</span>
                break;
        }
<span class="nc" id="L976">    }</span>

    public boolean isSleeting() {
<span class="nc" id="L979">        return isSleeting;</span>
    }

    public void setSleet(boolean sleet) {
<span class="nc" id="L983">        isSleeting = sleet;</span>
<span class="nc" id="L984">    }</span>

    private void doSleetCheck() {
<span class="nc bnc" id="L987" title="All 4 branches missed.">        if (isSleeting &amp;&amp; windStrength &lt; WI_MOD_GALE) {</span>
<span class="nc" id="L988">            setSleet(false);</span>
<span class="nc" id="L989">            weatherConditions = WE_NONE;</span>
<span class="nc" id="L990">            oldWeatherConditions = WE_SLEET;</span>
<span class="nc" id="L991">            oldTemperature = temperature;</span>
<span class="nc" id="L992">            temperature = 25;</span>
        }
<span class="nc bnc" id="L994" title="All 4 branches missed.">        if (isSleeting() &amp;&amp; windStrength &gt; WI_MOD_GALE) {</span>
<span class="nc" id="L995">            shiftWindStrength = false;</span>
<span class="nc" id="L996">            windStrength = WI_MOD_GALE;</span>
        }
<span class="nc bnc" id="L998" title="All 4 branches missed.">        if ((oldWeatherConditions == WE_SLEET)</span>
                &amp;&amp; (windStrength == WI_MOD_GALE)
<span class="nc bnc" id="L1000" title="All 2 branches missed.">                &amp;&amp; !isSleeting() ) {</span>
<span class="nc" id="L1001">            setSleet(true);</span>
<span class="nc" id="L1002">            temperature = oldTemperature;</span>
<span class="nc" id="L1003">            oldWeatherConditions = WE_NONE;</span>
<span class="nc" id="L1004">            oldTemperature = 25;</span>
<span class="nc" id="L1005">            weatherConditions = WE_SLEET;</span>
        }
<span class="nc" id="L1007">    }</span>

    private void setSandStorm() {
<span class="nc bnc" id="L1010" title="All 4 branches missed.">        if (blowingSand &amp;&amp; windStrength &lt; WI_MOD_GALE) {</span>
<span class="nc" id="L1011">            windStrength = WI_MOD_GALE;</span>
<span class="nc" id="L1012">            sandStorm = true;</span>
        }
<span class="nc" id="L1014">    }</span>

    private void doSandStormCheck() {
<span class="nc bnc" id="L1017" title="All 4 branches missed.">        if (blowingSand &amp;&amp; windStrength &lt; WI_MOD_GALE) {</span>
<span class="nc" id="L1018">            sandStorm = blowingSand;</span>
<span class="nc" id="L1019">            blowingSand = false;</span>
        }
<span class="nc bnc" id="L1021" title="All 4 branches missed.">        if (sandStorm &amp;&amp; windStrength &gt; WI_LIGHT_GALE) {</span>
<span class="nc" id="L1022">            sandStorm = blowingSand;</span>
<span class="nc" id="L1023">            blowingSand = true;</span>
        }
<span class="nc" id="L1025">    }</span>

    public void setRunOnce(boolean run) {
<span class="nc" id="L1028">        runOnce = run;</span>
<span class="nc" id="L1029">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>