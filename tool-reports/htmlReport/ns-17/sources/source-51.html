


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > Infantry</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">megamek.common</a>
</div>

<h1>Coverage Summary for Class: Infantry (megamek.common)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">Infantry</td>
<td class="coverageStat">
  <span class="percent">
    0,6%
  </span>
  <span class="absValue">
    (1/163)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    1,4%
  </span>
  <span class="absValue">
    (18/1275)
  </span>
</td>
</tr>
  <tr>
    <td class="name">Infantry$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0,6%
  </span>
  <span class="absValue">
    (1/164)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    1,4%
  </span>
  <span class="absValue">
    (18/1277)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp;* MegaMek -
&nbsp;* Copyright (C) 2000-2002 Ben Mazur (bmazur@sev.org)
&nbsp;* Copyright (C) 2018 The MegaMek Team
&nbsp;*
&nbsp;* This program is free software; you can redistribute it and/or modify it under
&nbsp;* the terms of the GNU General Public License as published by the Free Software
&nbsp;* Foundation; either version 2 of the License, or (at your option) any later
&nbsp;* version.
&nbsp;*
&nbsp;* This program is distributed in the hope that it will be useful, but WITHOUT
&nbsp;* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
&nbsp;* FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
&nbsp;* details.
&nbsp;*/
&nbsp;
&nbsp;package megamek.common;
&nbsp;
&nbsp;import java.text.DecimalFormat;
&nbsp;import java.text.NumberFormat;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Enumeration;
&nbsp;import java.util.List;
&nbsp;import java.util.Map;
&nbsp;import java.util.Optional;
&nbsp;import java.util.Vector;
&nbsp;import java.util.stream.Collectors;
&nbsp;
&nbsp;import megamek.MegaMek;
&nbsp;import megamek.common.options.OptionsConstants;
&nbsp;import megamek.common.preference.PreferenceManager;
&nbsp;import megamek.common.weapons.infantry.InfantryWeapon;
&nbsp;
&nbsp;/**
&nbsp; * This class represents the lowest of the low, the ground pounders, the city
&nbsp; * rats, the PBI (Poor Bloody Infantry). &lt;p/&gt; PLEASE NOTE!!! This class just
&nbsp; * represents unarmored infantry platoons as described by CitiTech (c) 1986.
&nbsp; * I&#39;ve never seen the rules for powered armor, &quot;anti-mech&quot; troops, or
&nbsp; * Immortals.
&nbsp; *
&nbsp; * @author Suvarov454@sourceforge.net (James A. Damour )
&nbsp; * @version $revision:$
&nbsp; */
&nbsp;/*
&nbsp; * PLEASE NOTE!!! My programming style is to put constants first in tests so the
&nbsp; * compiler catches my &quot;= for ==&quot; errors.
&nbsp; */
&nbsp;public class Infantry extends Entity {
&nbsp;    // Private attributes and helper functions.
&nbsp;
&nbsp;    /**
&nbsp;     *
&nbsp;     */
&nbsp;    private static final long serialVersionUID = -8706716079307721282L;
&nbsp;
&nbsp;    /**
&nbsp;     * Infantry Specializations
&nbsp;     */
<b class="fc">&nbsp;    public static int BRIDGE_ENGINEERS  = 1 &lt;&lt; 0;</b>
<b class="fc">&nbsp;    public static int DEMO_ENGINEERS    = 1 &lt;&lt; 1;</b>
<b class="fc">&nbsp;    public static int FIRE_ENGINEERS    = 1 &lt;&lt; 2;</b>
<b class="fc">&nbsp;    public static int MINE_ENGINEERS    = 1 &lt;&lt; 3;</b>
<b class="fc">&nbsp;    public static int SENSOR_ENGINEERS  = 1 &lt;&lt; 4;</b>
<b class="fc">&nbsp;    public static int TRENCH_ENGINEERS  = 1 &lt;&lt; 5;</b>
<b class="fc">&nbsp;    public static int MARINES           = 1 &lt;&lt; 6;</b>
<b class="fc">&nbsp;    public static int MOUNTAIN_TROOPS   = 1 &lt;&lt; 7;</b>
<b class="fc">&nbsp;    public static int PARAMEDICS        = 1 &lt;&lt; 8;</b>
<b class="fc">&nbsp;    public static int PARATROOPS        = 1 &lt;&lt; 9;</b>
<b class="fc">&nbsp;    public static int TAG_TROOPS        = 1 &lt;&lt; 10;</b>
<b class="fc">&nbsp;    public static int XCT               = 1 &lt;&lt; 11;</b>
<b class="fc">&nbsp;    public static int SCUBA             = 1 &lt;&lt; 12;</b>
<b class="fc">&nbsp;    public static int NUM_SPECIALIZATIONS = 13;</b>
<b class="fc">&nbsp;    public static int COMBAT_ENGINEERS = BRIDGE_ENGINEERS | DEMO_ENGINEERS</b>
&nbsp;            | FIRE_ENGINEERS | MINE_ENGINEERS | SENSOR_ENGINEERS
&nbsp;            | TRENCH_ENGINEERS;
&nbsp;
&nbsp;    /**
&nbsp;     * squad size and number
&nbsp;     */
<b class="nc">&nbsp;    protected int squadn = 1;</b>
<b class="nc">&nbsp;    private int squadsize = 1;</b>
&nbsp;
&nbsp;    /**
&nbsp;     * The number of men originally in this platoon.
&nbsp;     */
<b class="nc">&nbsp;    protected int menStarting = 0;</b>
&nbsp;
&nbsp;    /**
&nbsp;     * The number of men alive in this platoon at the beginning of the phase,
&nbsp;     * before it begins to take damage.
&nbsp;     */
<b class="nc">&nbsp;    private int menShooting = 0;</b>
&nbsp;
&nbsp;    /**
&nbsp;     * The number of men left alive in this platoon.
&nbsp;     */
<b class="nc">&nbsp;    private int men = 0;</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Information on primary and secondary weapons
&nbsp;     * This must be kept separate from the equipment array
&nbsp;     * because they are not fired as separate weapons
&nbsp;     */
&nbsp;    private transient InfantryWeapon primaryW;
&nbsp;    private String primaryName;
&nbsp;    private transient InfantryWeapon secondW;
&nbsp;    private String secondName;
<b class="nc">&nbsp;    private int secondn = 0;</b>
&nbsp;
&nbsp;
&nbsp;    /**
&nbsp;     * Infantry armor
&nbsp;     */
&nbsp;
<b class="nc">&nbsp;    private double damageDivisor = 1.0;</b>
<b class="nc">&nbsp;    private boolean encumbering = false;</b>
<b class="nc">&nbsp;    private boolean spaceSuit = false;</b>
<b class="nc">&nbsp;    private boolean dest = false;</b>
<b class="nc">&nbsp;    private boolean sneak_camo = false;</b>
<b class="nc">&nbsp;    private boolean sneak_ir = false;</b>
<b class="nc">&nbsp;    private boolean sneak_ecm = false;</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Stores which infantry specializations are active.
&nbsp;     */
<b class="nc">&nbsp;    private int infSpecs = 0;</b>
&nbsp;
&nbsp;    /**
&nbsp;     * For mechanized VTOL infantry, stores whether the platoon are microlite troops,
&nbsp;     * which need to enter a hex every turn to remain in flight.
&nbsp;     */
&nbsp;
<b class="nc">&nbsp;    private boolean microlite = false;</b>
&nbsp;
&nbsp;    /**
&nbsp;     * The location for infantry equipment.
&nbsp;     */
&nbsp;    public static final int LOC_INFANTRY = 0;
&nbsp;    public static final int LOC_FIELD_GUNS = 1;
&nbsp;
&nbsp;    /**
&nbsp;     * Infantry only have critical slots for field gun ammo
&nbsp;     */
<b class="fc">&nbsp;    private static final int[] NUM_OF_SLOTS = { 20, 20 };</b>
<b class="fc">&nbsp;    private static final String[] LOCATION_ABBRS = { &quot;MEN&quot;, &quot;FGUN&quot; };</b>
<b class="fc">&nbsp;    private static final String[] LOCATION_NAMES = { &quot;Men&quot; , &quot;Field Guns&quot;};</b>
&nbsp;
<b class="nc">&nbsp;    public int turnsLayingExplosives = -1;</b>
&nbsp;
&nbsp;    public static final int DUG_IN_NONE = 0;
&nbsp;    public static final int DUG_IN_WORKING = 1; // no protection, can&#39;t attack
&nbsp;    public static final int DUG_IN_COMPLETE = 2; // protected, restricted arc
&nbsp;    public static final int DUG_IN_FORTIFYING1 = 3; // no protection, can&#39;t
&nbsp;    // attack
&nbsp;    public static final int DUG_IN_FORTIFYING2 = 4; // no protection, can&#39;t
&nbsp;    // attack
<b class="nc">&nbsp;    private int dugIn = DUG_IN_NONE;</b>
&nbsp;
<b class="nc">&nbsp;    private boolean isTakingCover = false;</b>
<b class="nc">&nbsp;    private boolean canCallSupport = true;</b>
<b class="nc">&nbsp;    private boolean isCallingSupport = false;</b>
&nbsp;
&nbsp;    // Public and Protected constants, constructors, and methods.
&nbsp;
&nbsp;    /**
&nbsp;     * The maximum number of men in an infantry platoon.
&nbsp;     */
&nbsp;    public static final int INF_PLT_MAX_MEN = 30;
&nbsp;
&nbsp;    /**
&nbsp;     * The internal names of the anti-Mek attacks.
&nbsp;     */
&nbsp;    public static final String LEG_ATTACK = &quot;LegAttack&quot;;
&nbsp;    public static final String SWARM_MEK = &quot;SwarmMek&quot;;
&nbsp;    public static final String SWARM_WEAPON_MEK = &quot;SwarmWeaponMek&quot;;
&nbsp;    public static final String STOP_SWARM = &quot;StopSwarm&quot;;
&nbsp;
&nbsp;    public static final int ANTI_MECH_SKILL_UNTRAINED = 8;
&nbsp;    public static final int ANTI_MECH_SKILL_FOOT = 5;
&nbsp;    public static final int ANTI_MECH_SKILL_JUMP = 6;
&nbsp;
&nbsp;    @Override
&nbsp;    public String[] getLocationAbbrs() {
<b class="nc">&nbsp;        return LOCATION_ABBRS;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String[] getLocationNames() {
<b class="nc">&nbsp;        return LOCATION_NAMES;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns the number of locations in this platoon
&nbsp;     */
&nbsp;    @Override
&nbsp;    public int locations() {
<b class="nc">&nbsp;        return 2;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Generate a new, blank, infantry platoon. Hopefully, we&#39;ll be loaded from
&nbsp;     * somewhere.
&nbsp;     */
&nbsp;    public Infantry() {
&nbsp;        // Instantiate the superclass.
<b class="nc">&nbsp;        super();</b>
&nbsp;        // Create a &quot;dead&quot; leg rifle platoon.
<b class="nc">&nbsp;        menStarting = 0;</b>
<b class="nc">&nbsp;        menShooting = 0;</b>
<b class="nc">&nbsp;        men = 0;</b>
<b class="nc">&nbsp;        setMovementMode(EntityMovementMode.INF_LEG);</b>
&nbsp;        // Determine the number of MPs.
<b class="nc">&nbsp;        setOriginalWalkMP(1);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public int getUnitType() {
<b class="nc">&nbsp;        return UnitType.INFANTRY;</b>
&nbsp;    }
&nbsp;
&nbsp;    public CrewType defaultCrewType() {
<b class="nc">&nbsp;        return CrewType.CREW;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static TechAdvancement getMotiveTechAdvancement(EntityMovementMode movementMode) {
<b class="nc">&nbsp;        TechAdvancement techAdvancement = new TechAdvancement(TECH_BASE_ALL)</b>
<b class="nc">&nbsp;                .setAdvancement(DATE_PS, DATE_PS, DATE_PS)</b>
<b class="nc">&nbsp;                .setStaticTechLevel(SimpleTechLevel.STANDARD);</b>
<b class="nc">&nbsp;        switch(movementMode) {</b>
&nbsp;            case INF_MOTORIZED:
<b class="nc">&nbsp;                techAdvancement.setTechRating(RATING_B)</b>
<b class="nc">&nbsp;                    .setAvailability(RATING_A, RATING_A, RATING_A, RATING_A)</b>
<b class="nc">&nbsp;                    .setStaticTechLevel(SimpleTechLevel.STANDARD);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case INF_JUMP:
<b class="nc">&nbsp;                techAdvancement.setAdvancement(DATE_ES, DATE_ES, DATE_ES)</b>
<b class="nc">&nbsp;                    .setTechRating(RATING_D).setAvailability(RATING_B, RATING_B, RATING_B, RATING_B)</b>
<b class="nc">&nbsp;                    .setStaticTechLevel(SimpleTechLevel.STANDARD);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case INF_UMU:
<b class="nc">&nbsp;                techAdvancement.setAdvancement(DATE_PS, DATE_PS).setTechRating(RATING_B)</b>
<b class="nc">&nbsp;                    .setAvailability(RATING_D, RATING_D, RATING_D, RATING_D)</b>
<b class="nc">&nbsp;                    .setStaticTechLevel(SimpleTechLevel.ADVANCED);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case WHEELED:
<b class="nc">&nbsp;                techAdvancement.setTechRating(RATING_A)</b>
<b class="nc">&nbsp;                    .setAvailability(RATING_A, RATING_B, RATING_A, RATING_A)</b>
<b class="nc">&nbsp;                    .setStaticTechLevel(SimpleTechLevel.STANDARD);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case TRACKED:
<b class="nc">&nbsp;                techAdvancement.setTechRating(RATING_B)</b>
<b class="nc">&nbsp;                    .setAvailability(RATING_B, RATING_C, RATING_B, RATING_B)</b>
<b class="nc">&nbsp;                    .setStaticTechLevel(SimpleTechLevel.STANDARD);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case HOVER:
<b class="nc">&nbsp;                techAdvancement.setTechRating(RATING_C)</b>
<b class="nc">&nbsp;                    .setAvailability(RATING_A, RATING_B, RATING_A, RATING_B)</b>
<b class="nc">&nbsp;                    .setStaticTechLevel(SimpleTechLevel.STANDARD);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case VTOL:
<b class="nc">&nbsp;                techAdvancement.setAdvancement(DATE_ES, DATE_ES).setTechRating(RATING_C)</b>
<b class="nc">&nbsp;                    .setAvailability(RATING_C, RATING_D, RATING_D, RATING_C)</b>
<b class="nc">&nbsp;                    .setStaticTechLevel(SimpleTechLevel.ADVANCED);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case SUBMARINE:
<b class="nc">&nbsp;                techAdvancement.setAdvancement(DATE_PS, DATE_PS).setTechRating(RATING_C)</b>
<b class="nc">&nbsp;                    .setAvailability(RATING_D, RATING_D, RATING_D, RATING_D)</b>
<b class="nc">&nbsp;                    .setStaticTechLevel(SimpleTechLevel.ADVANCED);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case INF_LEG:
&nbsp;            default:
<b class="nc">&nbsp;                techAdvancement.setTechRating(RATING_A)</b>
<b class="nc">&nbsp;                    .setAvailability(RATING_A, RATING_A, RATING_A, RATING_A)</b>
<b class="nc">&nbsp;                    .setStaticTechLevel(SimpleTechLevel.STANDARD);</b>
&nbsp;                break;
&nbsp;            }
<b class="nc">&nbsp;        return techAdvancement;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public TechAdvancement getConstructionTechAdvancement() {
<b class="nc">&nbsp;        return new TechAdvancement(TECH_BASE_ALL)</b>
<b class="nc">&nbsp;                .setAdvancement(DATE_PS, DATE_PS, DATE_PS)</b>
<b class="nc">&nbsp;                .setStaticTechLevel(SimpleTechLevel.STANDARD);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static TechAdvancement getCombatEngineerTA() {
<b class="nc">&nbsp;        return new TechAdvancement(TECH_BASE_ALL)</b>
<b class="nc">&nbsp;                .setAdvancement(DATE_PS, DATE_PS, DATE_PS).setTechRating(RATING_C)</b>
<b class="nc">&nbsp;                .setAvailability(RATING_A, RATING_B, RATING_A, RATING_A)</b>
<b class="nc">&nbsp;                .setStaticTechLevel(SimpleTechLevel.ADVANCED);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static TechAdvancement getMarineTA() {
<b class="nc">&nbsp;        return new TechAdvancement(TECH_BASE_ALL)</b>
<b class="nc">&nbsp;                .setAdvancement(DATE_PS, DATE_PS, DATE_PS).setTechRating(RATING_C)</b>
<b class="nc">&nbsp;                .setAvailability(RATING_A, RATING_A, RATING_A, RATING_A)</b>
<b class="nc">&nbsp;                .setStaticTechLevel(SimpleTechLevel.ADVANCED);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static TechAdvancement getMountainTA() {
<b class="nc">&nbsp;        return new TechAdvancement(TECH_BASE_ALL)</b>
<b class="nc">&nbsp;                .setAdvancement(DATE_PS, DATE_PS, DATE_PS).setTechRating(RATING_B)</b>
<b class="nc">&nbsp;                .setAvailability(RATING_A, RATING_A, RATING_A, RATING_A)</b>
<b class="nc">&nbsp;                .setStaticTechLevel(SimpleTechLevel.ADVANCED);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static TechAdvancement getParatrooperTA() {
<b class="nc">&nbsp;        return new TechAdvancement(TECH_BASE_ALL)</b>
<b class="nc">&nbsp;                .setAdvancement(DATE_PS, DATE_PS, DATE_PS).setTechRating(RATING_B)</b>
<b class="nc">&nbsp;                .setAvailability(RATING_A, RATING_A, RATING_A, RATING_A)</b>
<b class="nc">&nbsp;                .setStaticTechLevel(SimpleTechLevel.ADVANCED);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static TechAdvancement getParamedicTA() {
<b class="nc">&nbsp;        return new TechAdvancement(TECH_BASE_ALL)</b>
<b class="nc">&nbsp;                .setAdvancement(DATE_PS, DATE_PS, DATE_PS).setTechRating(RATING_B)</b>
<b class="nc">&nbsp;                .setAvailability(RATING_C, RATING_C, RATING_C, RATING_C)</b>
<b class="nc">&nbsp;                .setStaticTechLevel(SimpleTechLevel.ADVANCED);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static TechAdvancement getTAGTroopsTA() {
<b class="nc">&nbsp;        return new TechAdvancement(TECH_BASE_ALL)</b>
<b class="nc">&nbsp;                .setISAdvancement(2585, 2600, DATE_NONE, 2535, 3037)</b>
<b class="nc">&nbsp;                .setClanAdvancement(2585, 2600)</b>
<b class="nc">&nbsp;                .setApproximate(true, false, false, false, false).setTechRating(RATING_E)</b>
<b class="nc">&nbsp;                .setPrototypeFactions(F_TH).setProductionFactions(F_TH).setReintroductionFactions(F_FS)</b>
<b class="nc">&nbsp;                .setAvailability(RATING_F, RATING_X, RATING_E, RATING_E)</b>
<b class="nc">&nbsp;                .setStaticTechLevel(SimpleTechLevel.ADVANCED);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static TechAdvancement getAntiMekTA() {
<b class="nc">&nbsp;        return new TechAdvancement(TECH_BASE_ALL)</b>
<b class="nc">&nbsp;                .setAdvancement(2456, 2460, 2500).setApproximate(true, false, false)</b>
<b class="nc">&nbsp;                .setPrototypeFactions(F_LC).setProductionFactions(F_LC)</b>
<b class="nc">&nbsp;                .setTechRating(RATING_D)</b>
<b class="nc">&nbsp;                .setAvailability(RATING_D, RATING_D, RATING_D, RATING_D)</b>
<b class="nc">&nbsp;                .setStaticTechLevel(SimpleTechLevel.STANDARD);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    protected void addSystemTechAdvancement(CompositeTechLevel ctl) {
<b class="nc">&nbsp;        super.addSystemTechAdvancement(ctl);</b>
<b class="nc">&nbsp;        ctl.addComponent(Infantry.getMotiveTechAdvancement(movementMode));</b>
<b class="nc">&nbsp;        if (hasSpecialization(COMBAT_ENGINEERS)) {</b>
<b class="nc">&nbsp;            ctl.addComponent(Infantry.getCombatEngineerTA());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hasSpecialization(MARINES)) {</b>
<b class="nc">&nbsp;            ctl.addComponent(Infantry.getMarineTA());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hasSpecialization(MOUNTAIN_TROOPS)) {</b>
<b class="nc">&nbsp;            ctl.addComponent(Infantry.getMountainTA());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hasSpecialization(PARATROOPS)) {</b>
<b class="nc">&nbsp;            ctl.addComponent(Infantry.getParatrooperTA());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hasSpecialization(PARAMEDICS)) {</b>
<b class="nc">&nbsp;            ctl.addComponent(Infantry.getParamedicTA());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hasSpecialization(TAG_TROOPS)) {</b>
<b class="nc">&nbsp;            ctl.addComponent(Infantry.getTAGTroopsTA());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isAntiMekTrained()) {</b>
<b class="nc">&nbsp;            ctl.addComponent(Infantry.getAntiMekTA());</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Infantry can face freely (except when dug in)
&nbsp;     */
&nbsp;    @Override
&nbsp;    public boolean canChangeSecondaryFacing() {
<b class="nc">&nbsp;        return !hasActiveFieldArtillery();</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Infantry can face freely
&nbsp;     */
&nbsp;    @Override
&nbsp;    public boolean isValidSecondaryFacing(int dir) {
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Infantry can face freely
&nbsp;     */
&nbsp;    @Override
&nbsp;    public int clipSecondaryFacing(int dir) {
<b class="nc">&nbsp;        return dir;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Create local platoon for Urban Guerrilla
&nbsp;     */
&nbsp;    public void createLocalSupport() {
<b class="nc">&nbsp;        if (Compute.isInUrbanEnvironment(game, getPosition())) {</b>
<b class="nc">&nbsp;            setIsCallingSupport(true);</b>
<b class="nc">&nbsp;            canCallSupport = false;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public void setIsCallingSupport(boolean b) {
<b class="nc">&nbsp;        isCallingSupport = b;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean getIsCallingSupport() {
<b class="nc">&nbsp;        return isCallingSupport;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * return this infantry&#39;s walk mp, adjusted for planetary conditions
&nbsp;     */
&nbsp;    @Override
&nbsp;    public int getWalkMP(boolean gravity, boolean ignoreheat, boolean ignoremodulararmor) {
<b class="nc">&nbsp;        int mp = getOriginalWalkMP();</b>
&nbsp;        //encumbering armor reduces MP by 1 to a minimum of one (TacOps, pg. 318)
<b class="nc">&nbsp;        if(encumbering) {</b>
<b class="nc">&nbsp;            mp = Math.max(mp - 1, 1);</b>
&nbsp;        }
<b class="nc">&nbsp;        if((getSecondaryN() &gt; 1)</b>
<b class="nc">&nbsp;                &amp;&amp; !hasAbility(OptionsConstants.MD_TSM_IMPLANT)</b>
<b class="nc">&nbsp;                &amp;&amp; !hasAbility(OptionsConstants.MD_DERMAL_ARMOR)</b>
<b class="nc">&nbsp;                &amp;&amp; (null != secondW) &amp;&amp; secondW.hasFlag(WeaponType.F_INF_SUPPORT)</b>
<b class="nc">&nbsp;                &amp;&amp; (getMovementMode() != EntityMovementMode.TRACKED)</b>
<b class="nc">&nbsp;                &amp;&amp; (getMovementMode() != EntityMovementMode.INF_JUMP)) {</b>
<b class="nc">&nbsp;            mp = Math.max(mp - 1, 0);</b>
&nbsp;        }
<b class="nc">&nbsp;        if((null != getCrew())</b>
<b class="nc">&nbsp;                &amp;&amp; hasAbility(OptionsConstants.MD_PL_MASC)</b>
<b class="nc">&nbsp;                &amp;&amp; ((getMovementMode() == EntityMovementMode.INF_LEG)</b>
<b class="nc">&nbsp;                    || (getMovementMode() == EntityMovementMode.INF_JUMP))) {</b>
<b class="nc">&nbsp;            mp += 1;</b>
&nbsp;        }
<b class="nc">&nbsp;        if ((null != getCrew()) &amp;&amp; hasAbility(OptionsConstants.INFANTRY_FOOT_CAV)</b>
<b class="nc">&nbsp;                &amp;&amp; ((getMovementMode() == EntityMovementMode.INF_LEG)</b>
<b class="nc">&nbsp;                        || (getMovementMode() == EntityMovementMode.INF_JUMP))) {</b>
<b class="nc">&nbsp;            mp += 1;</b>
&nbsp;        }
<b class="nc">&nbsp;        if(hasActiveFieldArtillery()) {</b>
&nbsp;            //mp of 1 at the most
<b class="nc">&nbsp;            mp = Math.min(mp, 1);</b>
&nbsp;        }
<b class="nc">&nbsp;        if(null != game) {</b>
<b class="nc">&nbsp;            int weatherMod = game.getPlanetaryConditions().getMovementMods(this);</b>
<b class="nc">&nbsp;            if(weatherMod != 0) {</b>
<b class="nc">&nbsp;                mp = Math.max(mp + weatherMod, 0);</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if (gravity) {</b>
<b class="nc">&nbsp;            mp = applyGravityEffectsOnMP(mp);</b>
&nbsp;        }
<b class="nc">&nbsp;        return mp;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Return this Infantry&#39;s run MP, which is identical to its walk MP
&nbsp;     */
&nbsp;    @Override
&nbsp;    public int getRunMP(boolean gravity, boolean ignoreheat, boolean ignoremodulararmor) {
<b class="nc">&nbsp;        if( (game != null)</b>
<b class="nc">&nbsp;                &amp;&amp; game.getOptions().booleanOption(OptionsConstants.ADVGRNDMOV_TACOPS_FAST_INFANTRY_MOVE) ) {</b>
<b class="nc">&nbsp;            if(getWalkMP(gravity, ignoreheat, ignoremodulararmor) &gt; 0) {</b>
<b class="nc">&nbsp;                return getWalkMP(gravity, ignoreheat, ignoremodulararmor) + 1;</b>
&nbsp;            }
<b class="nc">&nbsp;            return getWalkMP(gravity, ignoreheat, ignoremodulararmor) + 2;</b>
&nbsp;        }
<b class="nc">&nbsp;        return getWalkMP(gravity, ignoreheat, ignoremodulararmor);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Infantry don&#39;t have MASC
&nbsp;     */
&nbsp;    @Override
&nbsp;    public int getRunMPwithoutMASC(boolean gravity, boolean ignoreheat, boolean ignoremodulararmor) {
<b class="nc">&nbsp;        return getRunMP(gravity, ignoreheat, ignoremodulararmor);</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    /*
&nbsp;     * (non-Javadoc)
&nbsp;     * @see megamek.common.Entity#getJumpMP(boolean)
&nbsp;     */
&nbsp;    @Override
&nbsp;    public int getJumpMP(boolean gravity) {
<b class="nc">&nbsp;        int mp = 0;</b>
<b class="nc">&nbsp;        if (getMovementMode() != EntityMovementMode.INF_UMU</b>
<b class="nc">&nbsp;        		&amp;&amp; getMovementMode() != EntityMovementMode.SUBMARINE) {</b>
<b class="nc">&nbsp;            mp = getOriginalJumpMP();</b>
&nbsp;        }
<b class="nc">&nbsp;        if ((getSecondaryN() &gt; 1)</b>
<b class="nc">&nbsp;                &amp;&amp; !hasAbility(OptionsConstants.MD_TSM_IMPLANT)</b>
<b class="nc">&nbsp;                &amp;&amp; !hasAbility(OptionsConstants.MD_DERMAL_ARMOR)</b>
<b class="nc">&nbsp;                &amp;&amp; (getMovementMode() != EntityMovementMode.SUBMARINE)</b>
<b class="nc">&nbsp;                &amp;&amp; (null != secondW) &amp;&amp; secondW.hasFlag(WeaponType.F_INF_SUPPORT)) {</b>
<b class="nc">&nbsp;            mp = Math.max(mp - 1, 0);</b>
<b class="nc">&nbsp;        } else if (movementMode.equals(EntityMovementMode.VTOL) &amp;&amp; getSecondaryN() &gt; 0) {</b>
<b class="nc">&nbsp;            mp = Math.max(mp - 1, 0);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (gravity) {</b>
<b class="nc">&nbsp;            mp = applyGravityEffectsOnMP(mp);</b>
&nbsp;        }
<b class="nc">&nbsp;        int windP = 0;</b>
<b class="nc">&nbsp;        if(null != game) {</b>
<b class="nc">&nbsp;            int windCond = game.getPlanetaryConditions().getWindStrength();</b>
<b class="nc">&nbsp;            if(windCond == PlanetaryConditions.WI_MOD_GALE) {</b>
<b class="nc">&nbsp;                windP++;</b>
&nbsp;            }
<b class="nc">&nbsp;            if(windCond &gt;= PlanetaryConditions.WI_STRONG_GALE) {</b>
<b class="nc">&nbsp;                return 0;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        mp = Math.max(mp - windP, 0);</b>
<b class="nc">&nbsp;        return mp;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean hasUMU() {
<b class="nc">&nbsp;        return getMovementMode().equals(EntityMovementMode.INF_UMU)</b>
<b class="nc">&nbsp;                || getMovementMode().equals(EntityMovementMode.SUBMARINE);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public int getActiveUMUCount() {
<b class="nc">&nbsp;        return getAllUMUCount();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public int getAllUMUCount() {
<b class="nc">&nbsp;        if (hasUMU()) {</b>
<b class="nc">&nbsp;            return jumpMP;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Infantry can not enter water unless they have UMU mp or hover.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public boolean isLocationProhibited(Coords c, int currElevation) {
&nbsp;        // Coords off the board aren&#39;t legal
<b class="nc">&nbsp;        if (!game.getBoard().contains(c)) {</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
<b class="nc">&nbsp;        IHex hex = game.getBoard().getHex(c);</b>
&nbsp;        // Taharqa: waiting to hear back from Welshie but I am going to assume
&nbsp;        // that units pulling artillery
&nbsp;        // should be treated as wheeled rather than motorized because otherwise
&nbsp;        // mechanized units face fewer
&nbsp;        // terrain restrictions when pulling field artillery
&nbsp;
<b class="nc">&nbsp;        if (hex.containsTerrain(Terrains.IMPASSABLE)) {</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hex.containsTerrain(Terrains.MAGMA)) {</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
<b class="nc">&nbsp;        if(hex.containsTerrain(Terrains.SPACE) &amp;&amp; doomedInSpace()) {</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
&nbsp;        // Additional restrictions for hidden units
<b class="nc">&nbsp;        if (isHidden()) {</b>
&nbsp;            // Can&#39;t deploy in paved hexes
<b class="nc">&nbsp;            if ((hex.containsTerrain(Terrains.PAVEMENT)</b>
<b class="nc">&nbsp;                    || hex.containsTerrain(Terrains.ROAD))</b>
<b class="nc">&nbsp;                    &amp;&amp; (!hex.containsTerrain(Terrains.BUILDING)</b>
<b class="nc">&nbsp;                            &amp;&amp; !hex.containsTerrain(Terrains.RUBBLE))){</b>
<b class="nc">&nbsp;                return true;</b>
&nbsp;            }
&nbsp;            // Can&#39;t deploy on a bridge
<b class="nc">&nbsp;            if ((hex.terrainLevel(Terrains.BRIDGE_ELEV) == currElevation)</b>
<b class="nc">&nbsp;                    &amp;&amp; hex.containsTerrain(Terrains.BRIDGE)) {</b>
<b class="nc">&nbsp;                return true;</b>
&nbsp;            }
&nbsp;            // Can&#39;t deploy on the surface of water
<b class="nc">&nbsp;            if (hex.containsTerrain(Terrains.WATER) &amp;&amp; (currElevation == 0)) {</b>
<b class="nc">&nbsp;                return true;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (hex.containsTerrain(Terrains.MAGMA)) {</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (getMovementMode() == EntityMovementMode.WHEELED) {</b>
<b class="nc">&nbsp;            if (hex.containsTerrain(Terrains.WOODS)</b>
<b class="nc">&nbsp;                    || hex.containsTerrain(Terrains.ROUGH)</b>
<b class="nc">&nbsp;                    || hex.containsTerrain(Terrains.RUBBLE)</b>
<b class="nc">&nbsp;                    || hex.containsTerrain(Terrains.JUNGLE)</b>
<b class="nc">&nbsp;                    || (hex.terrainLevel(Terrains.SNOW) &gt; 1)</b>
<b class="nc">&nbsp;                    || (hex.terrainLevel(Terrains.GEYSER) == 2)) {</b>
<b class="nc">&nbsp;                return true;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (getMovementMode() == EntityMovementMode.TRACKED) {</b>
<b class="nc">&nbsp;            if ((hex.terrainLevel(Terrains.WOODS) &gt; 1)</b>
<b class="nc">&nbsp;                    || hex.containsTerrain(Terrains.JUNGLE)</b>
<b class="nc">&nbsp;                    || (hex.terrainLevel(Terrains.ROUGH) &gt; 1)</b>
<b class="nc">&nbsp;                    || (hex.terrainLevel(Terrains.RUBBLE) &gt; 5)) {</b>
<b class="nc">&nbsp;                return true;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (getMovementMode() == EntityMovementMode.HOVER) {</b>
<b class="nc">&nbsp;            if (hex.containsTerrain(Terrains.WOODS)</b>
<b class="nc">&nbsp;                    || hex.containsTerrain(Terrains.JUNGLE)</b>
<b class="nc">&nbsp;                    || (hex.terrainLevel(Terrains.ROUGH) &gt; 1)</b>
<b class="nc">&nbsp;                    || (hex.terrainLevel(Terrains.RUBBLE) &gt; 5)) {</b>
<b class="nc">&nbsp;                return true;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (hex.terrainLevel(Terrains.WATER) &lt;= 0</b>
<b class="nc">&nbsp;        		&amp;&amp; getMovementMode() == EntityMovementMode.SUBMARINE) {</b>
<b class="nc">&nbsp;        	return true;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if ((hex.terrainLevel(Terrains.WATER) &gt; 0)</b>
<b class="nc">&nbsp;                &amp;&amp; !hex.containsTerrain(Terrains.ICE)) {</b>
<b class="nc">&nbsp;            if ((getMovementMode() == EntityMovementMode.HOVER)</b>
<b class="nc">&nbsp;                    || (getMovementMode() == EntityMovementMode.INF_UMU)</b>
<b class="nc">&nbsp;                    || (getMovementMode() == EntityMovementMode.SUBMARINE)</b>
<b class="nc">&nbsp;                    || (getMovementMode() == EntityMovementMode.VTOL)) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns the name of the type of movement used. This is Infantry-specific.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public String getMovementString(EntityMovementType mtype) {
<b class="nc">&nbsp;        switch (mtype) {</b>
&nbsp;            case MOVE_NONE:
<b class="nc">&nbsp;                return &quot;None&quot;;</b>
&nbsp;            case MOVE_WALK:
&nbsp;            case MOVE_RUN:
<b class="nc">&nbsp;                switch (getMovementMode()) {</b>
&nbsp;                    case INF_LEG:
<b class="nc">&nbsp;                        return &quot;Walked&quot;;</b>
&nbsp;                    case INF_MOTORIZED:
<b class="nc">&nbsp;                        return &quot;Biked&quot;;</b>
&nbsp;                    case HOVER:
&nbsp;                    case TRACKED:
&nbsp;                    case WHEELED:
<b class="nc">&nbsp;                        return &quot;Drove&quot;;</b>
&nbsp;                    case INF_JUMP:
&nbsp;                    default:
<b class="nc">&nbsp;                        return &quot;Unknown!&quot;;</b>
&nbsp;                }
&nbsp;            case MOVE_VTOL_WALK:
&nbsp;            case MOVE_VTOL_RUN:
<b class="nc">&nbsp;                return &quot;Flew&quot;;</b>
&nbsp;            case MOVE_JUMP:
<b class="nc">&nbsp;                return &quot;Jumped&quot;;</b>
&nbsp;            default:
<b class="nc">&nbsp;                return &quot;Unknown!&quot;;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns the abbreviation of the type of movement used. This is
&nbsp;     * Infantry-specific.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public String getMovementAbbr(EntityMovementType mtype) {
<b class="nc">&nbsp;        switch (mtype) {</b>
&nbsp;            case MOVE_NONE:
<b class="nc">&nbsp;                return &quot;N&quot;;</b>
&nbsp;            case MOVE_WALK:
<b class="nc">&nbsp;                return &quot;W&quot;;</b>
&nbsp;            case MOVE_RUN:
<b class="nc">&nbsp;                switch (getMovementMode()) {</b>
&nbsp;                    case INF_LEG:
<b class="nc">&nbsp;                        return &quot;R&quot;;</b>
&nbsp;                    case INF_MOTORIZED:
<b class="nc">&nbsp;                        return &quot;B&quot;;</b>
&nbsp;                    case HOVER:
&nbsp;                    case TRACKED:
&nbsp;                    case WHEELED:
<b class="nc">&nbsp;                        return &quot;D&quot;;</b>
&nbsp;                    default:
<b class="nc">&nbsp;                        return &quot;?&quot;;</b>
&nbsp;                }
&nbsp;            case MOVE_JUMP:
<b class="nc">&nbsp;                return &quot;J&quot;;</b>
&nbsp;            default:
<b class="nc">&nbsp;                return &quot;?&quot;;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Infantry only have one hit location.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public HitData rollHitLocation(int table, int side, int aimedLocation,
&nbsp;            int aimingMode, int cover) {
<b class="nc">&nbsp;        return rollHitLocation(table, side);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public HitData rollHitLocation(int table, int side) {
<b class="nc">&nbsp;        return new HitData(LOC_INFANTRY);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Infantry only have one hit location.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public HitData getTransferLocation(HitData hit) {
<b class="nc">&nbsp;        return new HitData(Entity.LOC_DESTROYED);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Gets the location that is destroyed recursively.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public int getDependentLocation(int loc) {
<b class="nc">&nbsp;        return Entity.LOC_NONE;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Infantry have no rear armor.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public boolean hasRearArmor(int loc) {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Infantry platoons do wierd and wacky things with armor and internals, but
&nbsp;     * not all Infantry objects are platoons.
&nbsp;     *
&nbsp;     * @see megamek.common.BattleArmor#isPlatoon()
&nbsp;     */
&nbsp;    protected boolean isPlatoon() {
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns the number of men left in the platoon, or
&nbsp;     * IArmorState.ARMOR_DESTROYED.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public int getInternal(int loc) {
<b class="nc">&nbsp;        if (!isPlatoon()) {</b>
<b class="nc">&nbsp;            return super.getInternal(loc);</b>
&nbsp;        }
<b class="nc">&nbsp;        if(loc != LOC_INFANTRY) {</b>
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
<b class="nc">&nbsp;        return (men &gt; 0 ? men : IArmorState.ARMOR_DESTROYED);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns the number of men originally the platoon.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public int getOInternal(int loc) {
<b class="nc">&nbsp;        if (!isPlatoon()) {</b>
<b class="nc">&nbsp;            return super.getOInternal(loc);</b>
&nbsp;        }
<b class="nc">&nbsp;        return menStarting;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Sets the amount of men remaining in the platoon.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public void setInternal(int val, int loc) {
<b class="nc">&nbsp;        super.setInternal(val, loc);</b>
<b class="nc">&nbsp;        if(loc == LOC_INFANTRY) {</b>
<b class="nc">&nbsp;            men = val;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns the percent of the men remaining in the platoon.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public double getInternalRemainingPercent() {
<b class="nc">&nbsp;        if (!isPlatoon()) {</b>
<b class="nc">&nbsp;            return super.getInternalRemainingPercent();</b>
&nbsp;        }
<b class="nc">&nbsp;        int menTotal = men &gt; 0 ? men : 0; // Handle &quot;DESTROYED&quot;</b>
<b class="nc">&nbsp;        return ((double) menTotal / menStarting);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Initializes the number of men in the platoon. Sets the original and
&nbsp;     * starting point of the platoon to the same number.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public void initializeInternal(int val, int loc) {
<b class="nc">&nbsp;        menStarting = val;</b>
<b class="nc">&nbsp;        menShooting = val;</b>
<b class="nc">&nbsp;        super.initializeInternal(val, loc);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Set the men in the platoon based on squad size and number
&nbsp;     */
&nbsp;    @Override
&nbsp;    public void autoSetInternal() {
&nbsp;        //TODO: put checks here on size
<b class="nc">&nbsp;        initializeInternal(squadsize*squadn, LOC_INFANTRY);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Infantry can fire all around themselves. But field guns are set up to a
&nbsp;     * vehicular turret facing
&nbsp;     */
&nbsp;    @Override
&nbsp;    public int getWeaponArc(int wn) {
<b class="nc">&nbsp;        Mounted mounted = getEquipment(wn);</b>
<b class="nc">&nbsp;        if(mounted.getLocation() == LOC_FIELD_GUNS) {</b>
<b class="nc">&nbsp;            if (game.getOptions().booleanOption(OptionsConstants.ADVCOMBAT_TACOPS_VEHICLE_ARCS)) {</b>
<b class="nc">&nbsp;                return Compute.ARC_TURRET;</b>
&nbsp;            }
<b class="nc">&nbsp;            return Compute.ARC_FORWARD;</b>
&nbsp;        }
&nbsp;        //This is interesting, according to TacOps rules, Dug in units no longer
&nbsp;        //have to declare a facing
<b class="nc">&nbsp;        return Compute.ARC_360;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Infantry can fire all around themselves. But field guns act like turret
&nbsp;     * mounted on a tank
&nbsp;     */
&nbsp;    @Override
&nbsp;    public boolean isSecondaryArcWeapon(int wn) {
<b class="nc">&nbsp;        if ((getEquipment(wn).getLocation() == LOC_FIELD_GUNS) &amp;&amp; !hasActiveFieldArtillery()) {</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Infantry build no heat.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public int getHeatCapacity(boolean radicalHeatSinks) {
<b class="nc">&nbsp;        return DOES_NOT_TRACK_HEAT;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Infantry build no heat.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public int getHeatCapacityWithWater() {
<b class="nc">&nbsp;        return getHeatCapacity();</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Infantry build no heat.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public int getEngineCritHeat() {
<b class="nc">&nbsp;        return 0;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Infantry have no critical slots.
&nbsp;     */
&nbsp;    @Override
&nbsp;    protected int[] getNoOfSlots() {
<b class="nc">&nbsp;        return NUM_OF_SLOTS;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Infantry criticals can&#39;t be hit.
&nbsp;     */
&nbsp;    public boolean hasHittableCriticals(int loc) {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    /*
&nbsp;     * (non-Javadoc)
&nbsp;     * @see megamek.common.Entity#calculateBattleValue()
&nbsp;     */
&nbsp;    @Override
&nbsp;    public int calculateBattleValue() {
<b class="nc">&nbsp;        return calculateBattleValue(false, false);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Calculates the battle value of this platoon.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public int calculateBattleValue(boolean ignoreC3, boolean ignorePilot) {
<b class="nc">&nbsp;    	DecimalFormat df = new DecimalFormat(&quot;0.##&quot;);</b>
<b class="nc">&nbsp;        bvText = new StringBuffer(</b>
&nbsp;                &quot;&lt;HTML&gt;&lt;BODY&gt;&lt;CENTER&gt;&lt;b&gt;Battle Value Calculations For &quot;);
&nbsp;
<b class="nc">&nbsp;        bvText.append(getChassis());</b>
<b class="nc">&nbsp;        bvText.append(&quot; &quot;);</b>
<b class="nc">&nbsp;        bvText.append(getModel());</b>
<b class="nc">&nbsp;        bvText.append(&quot;&lt;/b&gt;&lt;/CENTER&gt;&quot;);</b>
<b class="nc">&nbsp;        bvText.append(nl);</b>
&nbsp;
<b class="nc">&nbsp;        bvText.append(&quot;&lt;b&gt;Defensive Battle Rating Calculation:&lt;/b&gt;&quot;);</b>
<b class="nc">&nbsp;        bvText.append(nl);</b>
&nbsp;
<b class="nc">&nbsp;        double dbr = 0; //defensive battle rating</b>
&nbsp;
<b class="nc">&nbsp;        dbr = men * 1.5 * calcDamageDivisor();</b>
<b class="nc">&nbsp;        int tmmRan = Compute.getTargetMovementModifier(getRunMP(false, true, true), false, false, game)</b>
<b class="nc">&nbsp;                .getValue();</b>
&nbsp;
<b class="nc">&nbsp;        final int jumpMP = getJumpMP(false);</b>
<b class="nc">&nbsp;        final int tmmJumped = (jumpMP &gt; 0) ? Compute.</b>
<b class="nc">&nbsp;                getTargetMovementModifier(jumpMP, true, false, game).getValue()</b>
<b class="nc">&nbsp;                : 0;</b>
&nbsp;
<b class="nc">&nbsp;        final int umuMP = getActiveUMUCount();</b>
<b class="nc">&nbsp;        final int tmmUMU = (umuMP &gt; 0) ? Compute.</b>
<b class="nc">&nbsp;                getTargetMovementModifier(umuMP, false, false, game).getValue()</b>
<b class="nc">&nbsp;                : 0;</b>
&nbsp;
<b class="nc">&nbsp;        double targetMovementModifier = Math.max(tmmRan, Math.max(tmmJumped,</b>
&nbsp;                tmmUMU));
&nbsp;
<b class="nc">&nbsp;        double tmmFactor = 1 + (targetMovementModifier / 10);</b>
&nbsp;
<b class="nc">&nbsp;        bvText.append(startRow);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(&quot;Base Target Movement Modifier:&quot;);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(tmmFactor);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(endRow);</b>
&nbsp;
<b class="nc">&nbsp;        if(hasDEST()) {</b>
<b class="nc">&nbsp;            tmmFactor += 0.2;</b>
<b class="nc">&nbsp;            bvText.append(startRow);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(&quot;DEST:&quot;);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(&quot;+0.2&quot;);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(endRow);</b>
&nbsp;        }
<b class="nc">&nbsp;        if(hasSneakCamo()) {</b>
<b class="nc">&nbsp;            tmmFactor += 0.2;</b>
<b class="nc">&nbsp;            bvText.append(startRow);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(&quot;Camo (Sneak):&quot;);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(&quot;+0.2&quot;);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(endRow);</b>
&nbsp;        }
<b class="nc">&nbsp;        if(hasSneakIR()) {</b>
<b class="nc">&nbsp;            tmmFactor += 0.2;</b>
<b class="nc">&nbsp;            bvText.append(startRow);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(&quot;Camo (IR):&quot;);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(&quot;+0.2&quot;);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(endRow);</b>
&nbsp;        }
<b class="nc">&nbsp;        if(hasSneakECM()) {</b>
<b class="nc">&nbsp;            tmmFactor += 0.1;</b>
<b class="nc">&nbsp;            bvText.append(startRow);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(&quot;Camo (ECM):&quot;);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(&quot;+0.1&quot;);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(endRow);</b>
&nbsp;        }
<b class="nc">&nbsp;        dbr *= tmmFactor;</b>
&nbsp;
<b class="nc">&nbsp;        bvText.append(startRow);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(&quot;-------------&quot;);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(endRow);</b>
&nbsp;
<b class="nc">&nbsp;        bvText.append(startRow);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(&quot;Target Movement Modifier:&quot;);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(df.format(tmmFactor));</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(endRow);</b>
&nbsp;
<b class="nc">&nbsp;        bvText.append(startRow);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(&quot;Damage Divisor:&quot;);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(df.format(calcDamageDivisor()));</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(endRow);</b>
&nbsp;
<b class="nc">&nbsp;        bvText.append(startRow);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(&quot;Number of Troopers x 1.5 x TMM x DD&quot;);</b>
<b class="nc">&nbsp;        bvText.append(endColumn + startColumn);</b>
<b class="nc">&nbsp;        bvText.append(men);</b>
<b class="nc">&nbsp;        bvText.append(&quot; x 1.5 x &quot;);</b>
<b class="nc">&nbsp;        bvText.append(tmmFactor);</b>
<b class="nc">&nbsp;        bvText.append(&quot; x &quot;);</b>
<b class="nc">&nbsp;        bvText.append(calcDamageDivisor());</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
&nbsp;
<b class="nc">&nbsp;        bvText.append(&quot;= &quot;);</b>
<b class="nc">&nbsp;        bvText.append(df.format(dbr));</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(endRow);</b>
&nbsp;
&nbsp;        // double weaponbv;
&nbsp;        double obr; //offensive battle rating
&nbsp;
<b class="nc">&nbsp;        int speedFactorTableLookup = Math.max(getRunMP(false, true, true), Math.max(jumpMP, umuMP));</b>
<b class="nc">&nbsp;        double speedFactor = Math.pow(1 + ((speedFactorTableLookup - 5) / 10.0), 1.2);</b>
<b class="nc">&nbsp;        speedFactor = Math.round(speedFactor * 100) / 100.0;</b>
<b class="nc">&nbsp;        double wbv = 0;</b>
<b class="nc">&nbsp;        if(null != primaryW) {</b>
<b class="nc">&nbsp;            wbv += primaryW.getBV(this) * (squadsize - secondn);</b>
&nbsp;        }
<b class="nc">&nbsp;        if(null != secondW) {</b>
<b class="nc">&nbsp;            wbv += secondW.getBV(this) * (secondn);</b>
&nbsp;        }
<b class="nc">&nbsp;        wbv = wbv * (men/squadsize);</b>
&nbsp;        //if anti-mek then double this
&nbsp;        //TODO: need to factor archaic weapons out of this
<b class="nc">&nbsp;        double ambv = 0;</b>
<b class="nc">&nbsp;        if(canMakeAntiMekAttacks()) {</b>
<b class="nc">&nbsp;        	if (primaryW != null &amp;&amp; !primaryW.hasFlag(InfantryWeapon.F_INF_ARCHAIC)) {</b>
<b class="nc">&nbsp;        		ambv += primaryW.getBV(this) * (squadsize - secondn);</b>
&nbsp;        	}
<b class="nc">&nbsp;        	if (secondW != null &amp;&amp; !secondW.hasFlag(InfantryWeapon.F_INF_ARCHAIC)) {</b>
<b class="nc">&nbsp;        		ambv += secondW.getBV(this) * (secondn);</b>
&nbsp;        	}
<b class="nc">&nbsp;            ambv *= men/squadsize;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        bvText.append(startRow);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(&quot;&lt;b&gt;Offensive Battle Rating Calculation:&lt;/b&gt;&quot;);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(endRow);</b>
&nbsp;
<b class="nc">&nbsp;        bvText.append(startRow);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(&quot;Weapon BV:&quot;);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(endRow);</b>
&nbsp;
<b class="nc">&nbsp;        if (null != primaryW) {</b>
<b class="nc">&nbsp;	        bvText.append(startRow);</b>
<b class="nc">&nbsp;	        bvText.append(startColumn);</b>
<b class="nc">&nbsp;	        bvText.append(primaryW.getName());</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;	        bvText.append((squadsize - secondn) * squadn);</b>
<b class="nc">&nbsp;	        bvText.append(&quot; x &quot; );</b>
<b class="nc">&nbsp;	        bvText.append(df.format(primaryW.getBV(this)));</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(df.format(primaryW.getBV(this) * (squadsize - secondn) * squadn));</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(endRow);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (null != secondW) {</b>
<b class="nc">&nbsp;	        bvText.append(startRow);</b>
<b class="nc">&nbsp;	        bvText.append(startColumn);</b>
<b class="nc">&nbsp;	        bvText.append(secondW.getName());</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;	        bvText.append(secondn * squadn);</b>
<b class="nc">&nbsp;	        bvText.append(&quot; x &quot; );</b>
<b class="nc">&nbsp;	        bvText.append(df.format(secondW.getBV(this)));</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(df.format(secondW.getBV(this) * secondn * squadn));</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(endRow);</b>
&nbsp;        }
&nbsp;
&nbsp;        //add in field gun BV
<b class="nc">&nbsp;        for (Mounted mounted : getEquipment()) {</b>
<b class="nc">&nbsp;            if(mounted.getLocation() == LOC_FIELD_GUNS) {</b>
<b class="nc">&nbsp;                wbv += mounted.getType().getBV(this);</b>
<b class="nc">&nbsp;    	        bvText.append(startRow);</b>
<b class="nc">&nbsp;    	        bvText.append(startColumn);</b>
<b class="nc">&nbsp;    	        bvText.append(mounted.getType().getName());</b>
<b class="nc">&nbsp;                bvText.append(endColumn);</b>
<b class="nc">&nbsp;                bvText.append(startColumn);</b>
<b class="nc">&nbsp;                bvText.append(endColumn);</b>
<b class="nc">&nbsp;                bvText.append(startColumn);</b>
<b class="nc">&nbsp;                bvText.append(mounted.getType().getBV(this));</b>
<b class="nc">&nbsp;                bvText.append(endColumn);</b>
<b class="nc">&nbsp;                bvText.append(endRow);</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        obr = (wbv + ambv) * speedFactor;</b>
&nbsp;
<b class="nc">&nbsp;        bvText.append(startRow);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(&quot;-------------&quot;);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(endRow);</b>
&nbsp;
<b class="nc">&nbsp;        bvText.append(startRow);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(&quot;Weapon BV:&quot;);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(df.format(wbv));</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(endRow);</b>
&nbsp;
<b class="nc">&nbsp;        bvText.append(startRow);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(&quot;Anti-Mek BV:&quot;);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(df.format(ambv));</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(endRow);</b>
&nbsp;
<b class="nc">&nbsp;        bvText.append(startRow);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(&quot;Speed Factor:&quot;);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(df.format(speedFactor));</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(endRow);</b>
&nbsp;
<b class="nc">&nbsp;        bvText.append(startRow);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(&quot;Weapons BV x Speed Factor:&quot;);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(df.format(wbv + ambv));</b>
<b class="nc">&nbsp;        bvText.append(&quot; x &quot;);</b>
<b class="nc">&nbsp;        bvText.append(df.format(speedFactor));</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(df.format(obr));</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(endRow);</b>
&nbsp;
<b class="nc">&nbsp;        bvText.append(startRow);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
&nbsp;
&nbsp;        double bv;
<b class="nc">&nbsp;        if (useGeometricMeanBV()) {</b>
<b class="nc">&nbsp;            bv = 2 * Math.sqrt(obr * dbr);</b>
<b class="nc">&nbsp;            if (bv == 0) {</b>
<b class="nc">&nbsp;                bv = dbr + obr;</b>
&nbsp;            }
<b class="nc">&nbsp;            bvText.append(&quot;SQRT(Defensive BR * Offensive BR) x 2:&quot;);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            bv = obr + dbr;</b>
<b class="nc">&nbsp;            bvText.append(&quot;Defensive BR + Offensive BR:&quot;);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(df.format(dbr));</b>
<b class="nc">&nbsp;            bvText.append(&quot; + &quot;);</b>
<b class="nc">&nbsp;            bvText.append(df.format(obr));</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(df.format(bv));</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(endRow);</b>
&nbsp;
&nbsp;        double utm; //unit type modifier
<b class="nc">&nbsp;        switch (getMovementMode()) {</b>
&nbsp;        case INF_MOTORIZED:
&nbsp;        case WHEELED:
<b class="nc">&nbsp;        	utm = 0.8;</b>
<b class="nc">&nbsp;        	break;</b>
&nbsp;        case TRACKED:
<b class="nc">&nbsp;        	utm = 0.9;</b>
<b class="nc">&nbsp;        	break;</b>
&nbsp;        case HOVER:
&nbsp;        case VTOL:
<b class="nc">&nbsp;        	utm = 0.7;</b>
<b class="nc">&nbsp;        	break;</b>
&nbsp;        case SUBMARINE:
<b class="nc">&nbsp;        	utm = 0.6;</b>
<b class="nc">&nbsp;        	break;</b>
&nbsp;        default:
<b class="nc">&nbsp;        	utm = 1.0;</b>
&nbsp;        	break;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        bvText.append(startRow);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(&quot;Base Unit Type Modifier:&quot;);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(df.format(utm));</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(endRow);</b>
&nbsp;
<b class="nc">&nbsp;        if (hasSpecialization(COMBAT_ENGINEERS)) {</b>
<b class="nc">&nbsp;        	utm += 0.1;</b>
<b class="nc">&nbsp;            bvText.append(startRow);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(&quot;Combat Engineers:&quot;);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(&quot;0.1&quot;);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(endRow);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hasSpecialization(MARINES)) {</b>
<b class="nc">&nbsp;        	utm += 0.3;</b>
<b class="nc">&nbsp;            bvText.append(startRow);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(&quot;Marines:&quot;);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(&quot;0.3&quot;);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(endRow);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hasSpecialization(MOUNTAIN_TROOPS)) {</b>
<b class="nc">&nbsp;        	utm += 0.2;</b>
<b class="nc">&nbsp;            bvText.append(startRow);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(&quot;Mountain Troops:&quot;);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(&quot;0.2&quot;);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(endRow);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hasSpecialization(PARATROOPS)) {</b>
<b class="nc">&nbsp;        	utm += 0.1;</b>
<b class="nc">&nbsp;            bvText.append(startRow);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(&quot;Paratroops:&quot;);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(&quot;0.1&quot;);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(endRow);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hasSpecialization(SCUBA)) {</b>
<b class="nc">&nbsp;        	utm += 0.1;</b>
<b class="nc">&nbsp;            bvText.append(startRow);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(&quot;SCUBA:&quot;);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(&quot;0.1&quot;);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(endRow);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (hasSpecialization(XCT)) {</b>
<b class="nc">&nbsp;            utm += 0.1;</b>
<b class="nc">&nbsp;            bvText.append(startRow);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(&quot;XCT:&quot;);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(startColumn);</b>
<b class="nc">&nbsp;            bvText.append(&quot;0.1&quot;);</b>
<b class="nc">&nbsp;            bvText.append(endColumn);</b>
<b class="nc">&nbsp;            bvText.append(endRow);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        bvText.append(startRow);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(&quot;-------------&quot;);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(endRow);</b>
&nbsp;
<b class="nc">&nbsp;        bvText.append(startRow);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(&quot;Total Unit Type Modifier&quot;);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(df.format(utm));</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(endRow);</b>
&nbsp;
<b class="nc">&nbsp;        bvText.append(startRow);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(&quot;Final BV:&quot;);</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append(df.format(bv));</b>
<b class="nc">&nbsp;        bvText.append(&quot; x &quot;);</b>
<b class="nc">&nbsp;        bvText.append(df.format(utm));</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
&nbsp;
<b class="nc">&nbsp;        bv *= utm;</b>
<b class="nc">&nbsp;        bvText.append(startColumn);</b>
<b class="nc">&nbsp;        bvText.append((int)Math.round(bv));</b>
<b class="nc">&nbsp;        bvText.append(endColumn);</b>
<b class="nc">&nbsp;        bvText.append(endRow);</b>
&nbsp;
<b class="nc">&nbsp;        bvText.append(endTable);</b>
<b class="nc">&nbsp;        bvText.append(&quot;&lt;/BODY&gt;&lt;/HTML&gt;&quot;);</b>
&nbsp;
&nbsp;        // and then factor in pilot
<b class="nc">&nbsp;        double pilotFactor = 1;</b>
<b class="nc">&nbsp;        if (!ignorePilot) {</b>
<b class="nc">&nbsp;            pilotFactor = getCrew().getBVSkillMultiplier(isAntiMekTrained(), game);</b>
&nbsp;        }
<b class="nc">&nbsp;        return (int) Math.round((bv) * pilotFactor);</b>
&nbsp;
&nbsp;    } // End public int calculateBattleValue()
&nbsp;
&nbsp;    @Override
&nbsp;    public Vector&lt;Report&gt; victoryReport() {
<b class="nc">&nbsp;        Vector&lt;Report&gt; vDesc = new Vector&lt;Report&gt;();</b>
&nbsp;
<b class="nc">&nbsp;        Report r = new Report(7025);</b>
<b class="nc">&nbsp;        r.type = Report.PUBLIC;</b>
<b class="nc">&nbsp;        r.addDesc(this);</b>
<b class="nc">&nbsp;        vDesc.addElement(r);</b>
&nbsp;
<b class="nc">&nbsp;        r = new Report(7041);</b>
<b class="nc">&nbsp;        r.type = Report.PUBLIC;</b>
<b class="nc">&nbsp;        r.add(getCrew().getGunnery());</b>
<b class="nc">&nbsp;        r.newlines = 0;</b>
<b class="nc">&nbsp;        vDesc.addElement(r);</b>
&nbsp;
<b class="nc">&nbsp;        r = new Report(7070, Report.PUBLIC);</b>
<b class="nc">&nbsp;        r.add(getKillNumber());</b>
<b class="nc">&nbsp;        vDesc.addElement(r);</b>
&nbsp;
<b class="nc">&nbsp;        if (isDestroyed()) {</b>
<b class="nc">&nbsp;            Entity killer = game.getEntity(killerId);</b>
<b class="nc">&nbsp;            if (killer == null) {</b>
<b class="nc">&nbsp;                killer = game.getOutOfGameEntity(killerId);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (killer != null) {</b>
<b class="nc">&nbsp;                r = new Report(7072, Report.PUBLIC);</b>
<b class="nc">&nbsp;                r.addDesc(killer);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                r = new Report(7073, Report.PUBLIC);</b>
&nbsp;            }
<b class="nc">&nbsp;            vDesc.addElement(r);</b>
&nbsp;        }
<b class="nc">&nbsp;        r.newlines = 2;</b>
&nbsp;
<b class="nc">&nbsp;        return vDesc;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Infantry don&#39;t need piloting rolls.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public PilotingRollData addEntityBonuses(PilotingRollData prd) {
<b class="nc">&nbsp;        return prd;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Infantry can only change 1 elevation level at a time unless Mountain Inf
&nbsp;     * which is 3.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public int getMaxElevationChange() {
<b class="nc">&nbsp;        if (hasSpecialization(MOUNTAIN_TROOPS)) {</b>
<b class="nc">&nbsp;            return 3;</b>
&nbsp;        }
<b class="nc">&nbsp;        return 1;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Update the platoon to reflect damages taken in this phase.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public void applyDamage() {
<b class="nc">&nbsp;        super.applyDamage();</b>
<b class="nc">&nbsp;        menShooting = men;</b>
&nbsp;    }
&nbsp;
&nbsp;    // The methods below aren&#39;t in the Entity interface.
&nbsp;
&nbsp;    /**
&nbsp;     * Get the number of men in the platoon (before damage is applied).
&nbsp;     */
&nbsp;    public int getShootingStrength() {
<b class="nc">&nbsp;        return menShooting;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean canCharge() {
&nbsp;        // Infantry can&#39;t Charge
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean canDFA() {
&nbsp;        // Infantry can&#39;t DFA
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Checks if the entity is moving into a swamp. If so, returns the target
&nbsp;     * roll for the piloting skill check. now includes the level 3 terains which
&nbsp;     * can bog down
&nbsp;     */
&nbsp;    public PilotingRollData checkBogDown(MoveStep step,
&nbsp;            EntityMovementType moveType, IHex curHex, Coords lastPos,
&nbsp;            Coords curPos, int lastElev, boolean isPavementStep) {
<b class="nc">&nbsp;        return checkBogDown(step, curHex, lastPos, curPos, isPavementStep);</b>
&nbsp;    }
&nbsp;
&nbsp;    public PilotingRollData checkBogDown(MoveStep step, IHex curHex,
&nbsp;            Coords lastPos, Coords curPos, boolean isPavementStep) {
<b class="nc">&nbsp;        PilotingRollData roll = new PilotingRollData(getId(), 4,</b>
&nbsp;                &quot;entering boggy terrain&quot;);
<b class="nc">&nbsp;        int bgMod = curHex.getBogDownModifier(getMovementMode(), false);</b>
<b class="nc">&nbsp;        final boolean onBridge = (curHex.terrainLevel(Terrains.BRIDGE) &gt; 0)</b>
<b class="nc">&nbsp;                &amp;&amp; (getElevation() == curHex.terrainLevel(Terrains.BRIDGE_ELEV));</b>
<b class="nc">&nbsp;        if (!lastPos.equals(curPos) &amp;&amp; (bgMod != TargetRoll.AUTOMATIC_SUCCESS)</b>
<b class="nc">&nbsp;                &amp;&amp; (step.getMovementType(false) != EntityMovementType.MOVE_JUMP)</b>
<b class="nc">&nbsp;                &amp;&amp; (getMovementMode() != EntityMovementMode.HOVER)</b>
<b class="nc">&nbsp;                &amp;&amp; (getMovementMode() != EntityMovementMode.VTOL)</b>
<b class="nc">&nbsp;                &amp;&amp; (getMovementMode() != EntityMovementMode.WIGE)</b>
<b class="nc">&nbsp;                &amp;&amp; (step.getElevation() == 0) &amp;&amp; !isPavementStep &amp;&amp; !onBridge) {</b>
<b class="nc">&nbsp;            roll.append(new PilotingRollData(getId(), bgMod,</b>
&nbsp;                    &quot;avoid bogging down&quot;));
&nbsp;        } else {
<b class="nc">&nbsp;            roll.addModifier(TargetRoll.CHECK_FALSE,</b>
&nbsp;                    &quot;Check false: Not entering bog-down terrain, &quot;
&nbsp;                            + &quot;or jumping/hovering over such terrain&quot;);
&nbsp;        }
<b class="nc">&nbsp;        return roll;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean getCanCallSupport() {
<b class="nc">&nbsp;        return canCallSupport;</b>
&nbsp;    }
&nbsp;
&nbsp;  /**
&nbsp;  * This combines the old getCost and getAlternativeCost methods into a revised getCost Method.
&nbsp;    *this better considers AntiMek training and Weapons and armor costs.
&nbsp;  */
&nbsp;    @Override
&nbsp;    public double getCost(boolean ignoreAmmo) {
<b class="nc">&nbsp;        double pweaponCost = 0;  //Primary Weapon Cost</b>
<b class="nc">&nbsp;        double sweaponCost = 0; // Secondary Weapon Cost</b>
<b class="nc">&nbsp;        double armorcost = 0; //Armor Cost</b>
<b class="nc">&nbsp;        double cost = 0; //Total Final Cost of Platoon or Squad.</b>
<b class="nc">&nbsp;        double primarySquad = 0; //Number of Troopers with Primary Weapon Only</b>
<b class="nc">&nbsp;        double secondSquad = 0; //Number oif Troopers with Secondary Weapon Only.</b>
&nbsp;
&nbsp;        //Weapon Cost Calculation
<b class="nc">&nbsp;        if(null != primaryW) {</b>
<b class="nc">&nbsp;            pweaponCost += Math.sqrt(primaryW.getCost(this, false, -1)) * 2000;</b>
&nbsp;        }
<b class="nc">&nbsp;        if(null != secondW) {</b>
<b class="nc">&nbsp;            sweaponCost += Math.sqrt(secondW.getCost(this, false, -1)) * 2000;</b>
&nbsp;        }
&nbsp;
&nbsp;        //Determining Break down of who would have primary and secondary weapons.
<b class="nc">&nbsp;        primarySquad = (squadsize - secondn) * squadn;</b>
<b class="nc">&nbsp;        secondSquad = menStarting - primarySquad;</b>
&nbsp;
&nbsp;        //Squad Cost with just the weapons.
<b class="nc">&nbsp;        cost = (primarySquad * pweaponCost) + (secondSquad * sweaponCost);</b>
&nbsp;
&nbsp;        /* Check whether the unit has an armor kit. If not, calculate value for custom
&nbsp;         * armor settings.
&nbsp;         */
<b class="nc">&nbsp;        EquipmentType armor = getArmorKit();</b>
<b class="nc">&nbsp;        if (armor != null) {</b>
<b class="nc">&nbsp;        	armorcost = armor.getCost(this, false, LOC_INFANTRY);</b>
&nbsp;        } else {
&nbsp;	        //add in infantry armor cost
<b class="nc">&nbsp;	        if(damageDivisor &gt; 1) {</b>
<b class="nc">&nbsp;	            if(isArmorEncumbering()) {</b>
<b class="nc">&nbsp;	                armorcost += 1600;</b>
&nbsp;	            } else {
<b class="nc">&nbsp;	                armorcost += 4300;</b>
&nbsp;	            }
&nbsp;	        }
<b class="nc">&nbsp;	        int nSneak = 0;</b>
<b class="nc">&nbsp;	        if(hasSneakCamo()) {</b>
<b class="nc">&nbsp;	            nSneak++;</b>
&nbsp;	        }
<b class="nc">&nbsp;	        if(hasSneakECM()) {</b>
<b class="nc">&nbsp;	            nSneak++;</b>
&nbsp;	        }
<b class="nc">&nbsp;	        if(hasSneakIR()) {</b>
<b class="nc">&nbsp;	            nSneak++;</b>
&nbsp;	        }
&nbsp;
<b class="nc">&nbsp;	        if(hasDEST()) {</b>
<b class="nc">&nbsp;	            armorcost += 50000;</b>
&nbsp;	        }
<b class="nc">&nbsp;	        else if(nSneak == 1) {</b>
<b class="nc">&nbsp;	            armorcost += 7000;</b>
&nbsp;	        }
<b class="nc">&nbsp;	        else if(nSneak == 2) {</b>
<b class="nc">&nbsp;	            armorcost += 21000;</b>
&nbsp;	        }
<b class="nc">&nbsp;	        else if(nSneak == 3) {</b>
<b class="nc">&nbsp;	            armorcost += 28000;</b>
&nbsp;	        }
&nbsp;
<b class="nc">&nbsp;	        if(hasSpaceSuit()) {</b>
<b class="nc">&nbsp;	            armorcost += 5000;</b>
&nbsp;	        }
&nbsp;        }
&nbsp;
&nbsp;        //Cost of armor on a per man basis added
<b class="nc">&nbsp;        cost += (armorcost * menStarting);</b>
&nbsp;
&nbsp;        // Price multiplier includes anti-mech training, motive type, and specializations
<b class="nc">&nbsp;        cost = cost * getPriceMultiplier();</b>
&nbsp;
&nbsp;        //add in field gun costs
<b class="nc">&nbsp;        for (Mounted mounted : getEquipment()) {</b>
<b class="nc">&nbsp;            if(mounted.getLocation() == LOC_FIELD_GUNS) {</b>
<b class="nc">&nbsp;                cost += Math.floor(mounted.getType().getCost(this, false, mounted.getLocation()));</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        return cost;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getPriceMultiplier() {
<b class="nc">&nbsp;        double priceMultiplier = 1.0;</b>
&nbsp;
&nbsp;        //Anti-Mek Trained Multiplier
<b class="nc">&nbsp;        if (isAntiMekTrained()) {</b>
<b class="nc">&nbsp;            priceMultiplier *= 5.0;</b>
&nbsp;        }
&nbsp;
&nbsp;        // Motive type costs
<b class="nc">&nbsp;        switch (getMovementMode()){</b>
&nbsp;            case INF_UMU:
<b class="nc">&nbsp;                priceMultiplier *= getAllUMUCount() &gt; 1? 2.5 : 2;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case INF_LEG:
<b class="nc">&nbsp;                priceMultiplier *= 1.0;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case INF_MOTORIZED:
<b class="nc">&nbsp;                priceMultiplier *= 1.6;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case INF_JUMP:
<b class="nc">&nbsp;                priceMultiplier *= 2.6;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case HOVER:
<b class="nc">&nbsp;                priceMultiplier *= 3.2;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case WHEELED:
<b class="nc">&nbsp;                priceMultiplier *= 3.2;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case TRACKED:
<b class="nc">&nbsp;                priceMultiplier *= 3.2;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case VTOL:
<b class="nc">&nbsp;                priceMultiplier *= hasMicrolite()? 4 : 4.5;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case SUBMARINE:
&nbsp;                /* No cost given in TacOps, using basic mechanized cost for now */
<b class="nc">&nbsp;                priceMultiplier *= 3.2;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            default:
&nbsp;                break;
&nbsp;        }
&nbsp;
&nbsp;        // Specialization costs
<b class="nc">&nbsp;        if (hasSpecialization(COMBAT_ENGINEERS)) {</b>
<b class="nc">&nbsp;            priceMultiplier *= 5;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hasSpecialization(MARINES)) {</b>
<b class="nc">&nbsp;            priceMultiplier *= 3;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hasSpecialization(MOUNTAIN_TROOPS)) {</b>
<b class="nc">&nbsp;            priceMultiplier *= 2;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hasSpecialization(PARATROOPS)) {</b>
<b class="nc">&nbsp;            priceMultiplier *= 3;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hasSpecialization(XCT)) {</b>
<b class="nc">&nbsp;            priceMultiplier *= 5;</b>
&nbsp;        }
&nbsp;        // TODO: paramedics cost an addition x0.375 per paramedic
<b class="nc">&nbsp;        return priceMultiplier;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * The alternate cost here is used by MekHQ to create costs that reflect just the cost of
&nbsp;     * equipment. The motive costs here are based on the costs associated with an auto-rifle
&nbsp;     * platoon.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public double getAlternateCost() {
<b class="nc">&nbsp;        double cost = 0;</b>
<b class="nc">&nbsp;        if(null != primaryW) {</b>
<b class="nc">&nbsp;            cost += primaryW.getCost(this, false, -1) * (squadsize - secondn);</b>
&nbsp;        }
<b class="nc">&nbsp;        if(null != secondW) {</b>
<b class="nc">&nbsp;            cost += secondW.getCost(this, false, -1) * secondn;</b>
&nbsp;        }
<b class="nc">&nbsp;        cost = cost / squadsize;</b>
&nbsp;
<b class="nc">&nbsp;        EquipmentType armor = getArmorKit();</b>
<b class="nc">&nbsp;        if (armor != null) {</b>
<b class="nc">&nbsp;        	cost += armor.getCost(this, false, LOC_INFANTRY);</b>
&nbsp;        }
&nbsp;
&nbsp;        //Add in motive type costs
<b class="nc">&nbsp;        switch (getMovementMode()){</b>
&nbsp;            case INF_UMU:
<b class="nc">&nbsp;                cost += 17888;</b>
<b class="nc">&nbsp;                if (getAllUMUCount() &gt; 1) {</b>
<b class="nc">&nbsp;                	cost += 17888 * 0.5;</b>
&nbsp;                }
&nbsp;                break;
&nbsp;            case INF_LEG:
<b class="nc">&nbsp;                break;</b>
&nbsp;            case INF_MOTORIZED:
<b class="nc">&nbsp;                cost += 17888 * 0.6;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case INF_JUMP:
<b class="nc">&nbsp;                cost += 17888 * 1.6;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case HOVER:
&nbsp;            case WHEELED:
&nbsp;            case TRACKED:
&nbsp;            case SUBMARINE: //FIXME: there is no cost shown for mech. scuba in tac ops
<b class="nc">&nbsp;                cost += 17888 * 2.2;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case VTOL:
<b class="nc">&nbsp;            	cost += 17888 * (hasMicrolite()? 3 : 3.5);</b>
<b class="nc">&nbsp;            	break;</b>
&nbsp;            default:
&nbsp;                break;
&nbsp;        }
<b class="nc">&nbsp;        cost *= menStarting;</b>
&nbsp;        //add in field gun costs
<b class="nc">&nbsp;        for (Mounted mounted : getEquipment()) {</b>
<b class="nc">&nbsp;            if(mounted.getLocation() == LOC_FIELD_GUNS) {</b>
<b class="nc">&nbsp;                cost += mounted.getType().getCost(this, false, -1);</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        return cost;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean doomedInExtremeTemp() {
<b class="nc">&nbsp;        if (getArmorKit() != null) {</b>
<b class="nc">&nbsp;            if (getArmorKit().hasSubType(MiscType.S_XCT_VACUUM)) {</b>
<b class="nc">&nbsp;                return false;</b>
<b class="nc">&nbsp;            } else if (getArmorKit().hasSubType(MiscType.S_COLD_WEATHER) &amp;&amp; (game.getPlanetaryConditions().getTemperature() &lt; -30)) {</b>
<b class="nc">&nbsp;                return false;</b>
<b class="nc">&nbsp;            } else if (getArmorKit().hasSubType(MiscType.S_HOT_WEATHER) &amp;&amp; (game.getPlanetaryConditions().getTemperature() &gt; 50)) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            } else {
<b class="nc">&nbsp;                return true;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if (hasSpaceSuit() || isMechanized()) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean doomedInVacuum() {
<b class="nc">&nbsp;        if (getMovementMode() == EntityMovementMode.VTOL) {</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return !hasSpaceSuit();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean doomedOnGround() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean doomedInAtmosphere() {
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean doomedInSpace() {
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean canAssaultDrop() {
<b class="nc">&nbsp;        return game.getOptions().booleanOption(OptionsConstants.ADVANCED_PARATROOPERS);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isEligibleFor(IGame.Phase phase) {
<b class="nc">&nbsp;        if ((turnsLayingExplosives &gt; 0) &amp;&amp; (phase != IGame.Phase.PHASE_PHYSICAL)) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if ((dugIn != DUG_IN_COMPLETE) &amp;&amp; (dugIn != DUG_IN_NONE)) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
<b class="nc">&nbsp;        return super.isEligibleFor(phase);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isEligibleForFiring() {
<b class="nc">&nbsp;        if(game.getOptions().booleanOption(OptionsConstants.ADVGRNDMOV_TACOPS_FAST_INFANTRY_MOVE)) {</b>
<b class="nc">&nbsp;            if(moved == EntityMovementType.MOVE_RUN) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return super.isEligibleForFiring();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void newRound(int roundNumber) {
<b class="nc">&nbsp;        if (turnsLayingExplosives &gt;= 0) {</b>
<b class="nc">&nbsp;            turnsLayingExplosives++;</b>
<b class="nc">&nbsp;            if (!(Compute.isInBuilding(game, this))) {</b>
<b class="nc">&nbsp;                turnsLayingExplosives = -1; // give up if no longer in a</b>
&nbsp;                // building
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if ((dugIn != DUG_IN_COMPLETE) &amp;&amp; (dugIn != DUG_IN_NONE)) {</b>
<b class="nc">&nbsp;            dugIn++;</b>
<b class="nc">&nbsp;            if (dugIn &gt; DUG_IN_FORTIFYING2) {</b>
<b class="nc">&nbsp;                dugIn = DUG_IN_NONE;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        setTakingCover(false);</b>
<b class="nc">&nbsp;        super.newRound(roundNumber);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setDugIn(int i) {
<b class="nc">&nbsp;        dugIn = i;</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getDugIn() {
<b class="nc">&nbsp;        return dugIn;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isNuclearHardened() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * This function is called when loading a unit into a transport. This is
&nbsp;     * overridden to ensure infantry are no longer considered dug in when they
&nbsp;     * are being transported.
&nbsp;     *
&nbsp;     * @param transportID
&nbsp;     */
&nbsp;    public void setTransportID(int transportID) {
<b class="nc">&nbsp;        super.setTransportId(transportID);</b>
&nbsp;
<b class="nc">&nbsp;        setDugIn(DUG_IN_NONE);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Convenience method for setting the anti-mek skill of the unit based on
&nbsp;     * whether or not they have anti-mek training.  If the input is false, the
&nbsp;     * anti-mek skill is set to the default untrained value, otherwise it&#39;s
&nbsp;     * set to the default value based on motive type.
&nbsp;     *
&nbsp;     * @param amTraining
&nbsp;     */
&nbsp;    public void setAntiMekSkill(boolean amTraining) {
<b class="nc">&nbsp;        if (getCrew() == null) {</b>
&nbsp;            return;
&nbsp;        }
<b class="nc">&nbsp;        if (amTraining) {</b>
<b class="nc">&nbsp;            if ((getMovementMode() == EntityMovementMode.INF_MOTORIZED)</b>
<b class="nc">&nbsp;                    || getMovementMode() == EntityMovementMode.INF_JUMP) {</b>
<b class="nc">&nbsp;                getCrew().setPiloting(ANTI_MECH_SKILL_JUMP, 0);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                getCrew().setPiloting(ANTI_MECH_SKILL_FOOT, 0);</b>
&nbsp;            }
&nbsp;        } else {
<b class="nc">&nbsp;            getCrew().setPiloting(ANTI_MECH_SKILL_UNTRAINED, 0);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Set the anti-mek skill for this unit.  Since Infantry don&#39;t have piloting
&nbsp;     * the crew&#39;s piloting skill is treated as the anti-mek skill.  This is
&nbsp;     * largely just a convenience method for setting the Crew&#39;s piloting skill.
&nbsp;     * @param amSkill
&nbsp;     */
&nbsp;    public void setAntiMekSkill(int amSkill) {
<b class="nc">&nbsp;        if (getCrew() == null) {</b>
&nbsp;            return;
&nbsp;        }
<b class="nc">&nbsp;        getCrew().setPiloting(amSkill, 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns the anti-mek skill for this unit.  Since Infantry don&#39;t have
&nbsp;     * piloting the crew&#39;s piloting skill is treated as the anti-mek skill.
&nbsp;     * This is largely just a convenience method for setting the Crew&#39;s piloting
&nbsp;     * skill.
&nbsp;     * @return
&nbsp;     */
&nbsp;    public int getAntiMekSkill() {
<b class="nc">&nbsp;        if (getCrew() == null) {</b>
<b class="nc">&nbsp;            return ANTI_MECH_SKILL_UNTRAINED;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return getCrew().getPiloting();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns true if this unit has anti-mek training.  According to TM pg 155,
&nbsp;     * any unit that has less than 8 anti-mek skill is assumed to have anti-mek
&nbsp;     * training.  This implies that the unit carries the requisite equipment for
&nbsp;     * properly performing anti-mek attacks (and the weight and cost that goes
&nbsp;     * along with that).
&nbsp;     * @return
&nbsp;     */
&nbsp;    public boolean isAntiMekTrained() {
&nbsp;        // Anything below the antimech skill default is considered to be AM
&nbsp;        // trained.  See TM pg 155
<b class="nc">&nbsp;        return getAntiMekSkill() &lt; ANTI_MECH_SKILL_UNTRAINED;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean isMechanized() {
<b class="nc">&nbsp;        return (getMovementMode() == EntityMovementMode.WHEELED) ||</b>
<b class="nc">&nbsp;                (getMovementMode() == EntityMovementMode.HOVER) ||</b>
<b class="nc">&nbsp;                (getMovementMode() == EntityMovementMode.TRACKED) ||</b>
<b class="nc">&nbsp;                (getMovementMode() == EntityMovementMode.SUBMARINE) ||</b>
<b class="nc">&nbsp;                (getMovementMode() == EntityMovementMode.VTOL);</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean isXCT() {
<b class="nc">&nbsp;        return hasSpecialization(XCT);</b>
&nbsp;    }
&nbsp;
&nbsp;    /*
&nbsp;     * (non-Javadoc)
&nbsp;     * @see megamek.common.Entity#getTotalCommGearTons()
&nbsp;     */
&nbsp;    @Override
&nbsp;    public int getTotalCommGearTons() {
<b class="nc">&nbsp;        return 0;</b>
&nbsp;    }
&nbsp;
&nbsp;    public EquipmentType getArmorKit() {
<b class="nc">&nbsp;    	Optional&lt;Mounted&gt; kit = getEquipment().stream()</b>
<b class="nc">&nbsp;    			.filter(m -&gt; m.getType().hasFlag(MiscType.F_ARMOR_KIT))</b>
<b class="nc">&nbsp;    			.findFirst();</b>
<b class="nc">&nbsp;    	if (kit.isPresent()) {</b>
<b class="nc">&nbsp;    		return kit.get().getType();</b>
&nbsp;    	} else {
<b class="nc">&nbsp;    		return null;</b>
&nbsp;    	}
&nbsp;    }
&nbsp;
&nbsp;    public void setArmorKit(EquipmentType armorKit) {
<b class="nc">&nbsp;    	List&lt;Mounted&gt; toRemove = getEquipment().stream()</b>
<b class="nc">&nbsp;    			.filter(m -&gt; m.getType().hasFlag(MiscType.F_ARMOR_KIT))</b>
<b class="nc">&nbsp;    			.collect(Collectors.toList());</b>
<b class="nc">&nbsp;    	getEquipment().removeAll(toRemove);</b>
<b class="nc">&nbsp;    	getMisc().removeAll(toRemove);</b>
<b class="nc">&nbsp;    	if (armorKit != null &amp;&amp; armorKit.hasFlag(MiscType.F_ARMOR_KIT)) {</b>
&nbsp;    		try {
<b class="nc">&nbsp;    			addEquipment(armorKit, LOC_INFANTRY);</b>
<b class="nc">&nbsp;    		} catch (LocationFullException ex) {</b>
<b class="nc">&nbsp;    			ex.printStackTrace();</b>
<b class="nc">&nbsp;    		}</b>
<b class="nc">&nbsp;    		damageDivisor = ((MiscType)armorKit).getDamageDivisor();</b>
<b class="nc">&nbsp;    		encumbering = (armorKit.getSubType() &amp; MiscType.S_ENCUMBERING) != 0;</b>
<b class="nc">&nbsp;    		spaceSuit = (armorKit.getSubType() &amp; MiscType.S_SPACE_SUIT) != 0;</b>
<b class="nc">&nbsp;    		dest = (armorKit.getSubType() &amp; MiscType.S_DEST) != 0;</b>
<b class="nc">&nbsp;    		sneak_camo = (armorKit.getSubType() &amp; MiscType.S_SNEAK_CAMO) != 0;</b>
<b class="nc">&nbsp;    		sneak_ir = (armorKit.getSubType() &amp; MiscType.S_SNEAK_IR) != 0;</b>
<b class="nc">&nbsp;    		sneak_ecm = (armorKit.getSubType() &amp; MiscType.S_SNEAK_ECM) != 0;</b>
&nbsp;    	}
&nbsp;    }
&nbsp;
&nbsp;    public double calcDamageDivisor() {
<b class="nc">&nbsp;        double divisor = damageDivisor;</b>
&nbsp;        // TSM implant reduces divisor to 0.5 if no other armor is worn
<b class="nc">&nbsp;        if ((divisor == 1.0) &amp;&amp; hasAbility(OptionsConstants.MD_TSM_IMPLANT)) {</b>
<b class="nc">&nbsp;            divisor = 0.5;</b>
&nbsp;        }
&nbsp;        // Dermal armor adds one to the divisor, cumulative with armor kit and TSM implant
<b class="nc">&nbsp;        if (hasAbility(OptionsConstants.MD_DERMAL_ARMOR)) {</b>
<b class="nc">&nbsp;            divisor += 1.0;</b>
&nbsp;        }
<b class="nc">&nbsp;        return divisor;</b>
&nbsp;    }
&nbsp;
&nbsp;    public double getArmorDamageDivisor() {
<b class="nc">&nbsp;    	return damageDivisor;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setArmorDamageDivisor(double d) {
<b class="nc">&nbsp;        damageDivisor = d;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean isArmorEncumbering() {
<b class="nc">&nbsp;        return encumbering;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setArmorEncumbering(boolean b) {
<b class="nc">&nbsp;        encumbering = b;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setCanCallSupport(boolean b) {
<b class="nc">&nbsp;        canCallSupport =b;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean hasSpaceSuit() {
<b class="nc">&nbsp;        return spaceSuit;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setSpaceSuit(boolean b) {
<b class="nc">&nbsp;        spaceSuit = b;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean hasDEST() {
<b class="nc">&nbsp;        return dest;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setDEST(boolean b) {
<b class="nc">&nbsp;        dest = b;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean hasSpecialization() {
<b class="nc">&nbsp;        return infSpecs != 0;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean hasSpecialization(int spec) {
<b class="nc">&nbsp;        return (infSpecs &amp; spec) &gt; 0;</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getSpecializations() {
<b class="nc">&nbsp;        return infSpecs;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setSpecializations(int spec) {
&nbsp;        // Equipment for Trench/Fieldworks Engineers
<b class="nc">&nbsp;        if ((spec &amp; TRENCH_ENGINEERS) &gt; 0 &amp;&amp; (infSpecs &amp; TRENCH_ENGINEERS) == 0) {</b>
&nbsp;            // Need to add vibro shovels
&nbsp;            try {
<b class="nc">&nbsp;                EquipmentType shovels = EquipmentType.get(EquipmentTypeLookup.VIBRO_SHOVEL);</b>
<b class="nc">&nbsp;                addEquipment(shovels, Infantry.LOC_INFANTRY);</b>
<b class="nc">&nbsp;            } catch (LocationFullException e) {</b>
<b class="nc">&nbsp;                e.printStackTrace();</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;        } else if ((spec &amp; TRENCH_ENGINEERS) == 0</b>
&nbsp;                &amp;&amp; (infSpecs &amp; TRENCH_ENGINEERS) &gt; 0) {
&nbsp;            // Need to remove vibro shovels
<b class="nc">&nbsp;            List&lt;Mounted&gt; eqToRemove = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;            for (Mounted eq : getEquipment()) {</b>
<b class="nc">&nbsp;                if (eq.getType().hasFlag(MiscType.F_TOOLS)</b>
<b class="nc">&nbsp;                        &amp;&amp; eq.getType().hasSubType(MiscType.S_VIBROSHOVEL)) {</b>
<b class="nc">&nbsp;                    eqToRemove.add(eq);</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            getEquipment().removeAll(eqToRemove);</b>
<b class="nc">&nbsp;            getMisc().removeAll(eqToRemove);</b>
&nbsp;        }
&nbsp;        // Equipment for Demolition Engineers
<b class="nc">&nbsp;        if ((spec &amp; DEMO_ENGINEERS) &gt; 0 &amp;&amp; (infSpecs &amp; DEMO_ENGINEERS) == 0) {</b>
&nbsp;            // Need to add vibro shovels
&nbsp;            try {
<b class="nc">&nbsp;                EquipmentType shovels = EquipmentType.get(EquipmentTypeLookup.DEMOLITION_CHARGE);</b>
<b class="nc">&nbsp;                addEquipment(shovels, Infantry.LOC_INFANTRY);</b>
<b class="nc">&nbsp;            } catch (LocationFullException e) {</b>
<b class="nc">&nbsp;                e.printStackTrace();</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;        } else if ((spec &amp; DEMO_ENGINEERS) == 0</b>
&nbsp;                &amp;&amp; (infSpecs &amp; DEMO_ENGINEERS) &gt; 0) {
&nbsp;            // Need to remove vibro shovels
<b class="nc">&nbsp;            List&lt;Mounted&gt; eqToRemove = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;            for (Mounted eq : getEquipment()) {</b>
<b class="nc">&nbsp;                if (eq.getType().hasFlag(MiscType.F_TOOLS)</b>
<b class="nc">&nbsp;                        &amp;&amp; eq.getType()</b>
<b class="nc">&nbsp;                                .hasSubType(MiscType.S_DEMOLITION_CHARGE)) {</b>
<b class="nc">&nbsp;                    eqToRemove.add(eq);</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            getEquipment().removeAll(eqToRemove);</b>
<b class="nc">&nbsp;            getMisc().removeAll(eqToRemove);</b>
&nbsp;        }
<b class="nc">&nbsp;        infSpecs = spec;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static String getSpecializationName(int spec) {
<b class="nc">&nbsp;        StringBuilder name = new StringBuilder();</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; NUM_SPECIALIZATIONS; i++) {</b>
<b class="nc">&nbsp;            int currSpec = 1 &lt;&lt; i;</b>
<b class="nc">&nbsp;            if ((spec &amp; currSpec) &lt; 1) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (name.length() &gt; 0) {</b>
<b class="nc">&nbsp;                name.append(&quot; &quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            name.append(Messages.getString(&quot;Infantry.specialization&quot; + i));</b>
&nbsp;        }
<b class="nc">&nbsp;        return name.toString();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static String getSpecializationTooltip(int spec) {
<b class="nc">&nbsp;        StringBuilder name = new StringBuilder();</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; NUM_SPECIALIZATIONS; i++) {</b>
<b class="nc">&nbsp;            int currSpec = 1 &lt;&lt; i;</b>
<b class="nc">&nbsp;            if ((spec &amp; currSpec) &lt; 1) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (name.length() &gt; 0) {</b>
<b class="nc">&nbsp;                name.append(&quot; &quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            name.append(Messages.getString(&quot;Infantry.specializationTip&quot; + i));</b>
&nbsp;        }
<b class="nc">&nbsp;        return name.toString();</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean hasSneakCamo() {
<b class="nc">&nbsp;        return sneak_camo;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setSneakCamo(boolean b) {
<b class="nc">&nbsp;        sneak_camo = b;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean hasSneakIR() {
<b class="nc">&nbsp;        return sneak_ir;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setSneakIR(boolean b) {
<b class="nc">&nbsp;        sneak_ir = b;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean hasSneakECM() {
<b class="nc">&nbsp;        return sneak_ecm;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setSneakECM(boolean b) {
<b class="nc">&nbsp;        sneak_ecm = b;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Determine the stealth modifier for firing at this unit from the given
&nbsp;     * range. If the value supplied for &lt;code&gt;range&lt;/code&gt; is not one of the
&nbsp;     * &lt;code&gt;Entity&lt;/code&gt; class range constants, an
&nbsp;     * &lt;code&gt;IllegalArgumentException&lt;/code&gt; will be thrown. &lt;p/&gt; Sub-classes
&nbsp;     * are encouraged to override this method.
&nbsp;     *
&nbsp;     * @param range - an &lt;code&gt;int&lt;/code&gt; value that must match one of the
&nbsp;     *            &lt;code&gt;Compute&lt;/code&gt; class range constants.
&nbsp;     * @param ae - the entity making the attack.
&nbsp;     * @return a &lt;code&gt;TargetRoll&lt;/code&gt; value that contains the stealth
&nbsp;     *         modifier for the given range.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public TargetRoll getStealthModifier(int range, Entity ae) {
<b class="nc">&nbsp;        TargetRoll result = null;</b>
&nbsp;
&nbsp;        // Note: infantry are immune to stealth, but not camoflage
&nbsp;        // or mimetic armor
&nbsp;
<b class="nc">&nbsp;        if ((sneak_ir || dest)</b>
&nbsp;                &amp;&amp; !(ae instanceof Infantry)) {
<b class="nc">&nbsp;            switch (range) {</b>
&nbsp;                case RangeType.RANGE_MINIMUM:
&nbsp;                case RangeType.RANGE_SHORT:
&nbsp;                case RangeType.RANGE_MEDIUM:
<b class="nc">&nbsp;                    result = new TargetRoll(+1, &quot;Sneak, IR/DEST suit&quot;);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case RangeType.RANGE_LONG:
&nbsp;                case RangeType.RANGE_EXTREME:
&nbsp;                case RangeType.RANGE_LOS:
<b class="nc">&nbsp;                    result = new TargetRoll(+2, &quot;Sneak, IR/DEST suit&quot;);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case RangeType.RANGE_OUT:
<b class="nc">&nbsp;                    break;</b>
&nbsp;                default:
<b class="nc">&nbsp;                    throw new IllegalArgumentException(</b>
&nbsp;                            &quot;Unknown range constant: &quot; + range);
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        // Simple camo modifier is on top of the movement modifier
&nbsp;        // This can also be in addition to IR/DEST stealth mods!
<b class="nc">&nbsp;        if (sneak_camo &amp;&amp; (delta_distance &lt; 3)) {</b>
<b class="nc">&nbsp;            int mod = Math.max(3 - delta_distance, 0);</b>
<b class="nc">&nbsp;            if (result == null) {</b>
<b class="nc">&nbsp;                result = new TargetRoll(mod, &quot;Sneak, Camo&quot;);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                result.append(new TargetRoll(mod, &quot;Sneak, Camo&quot;));</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (dest &amp;&amp; (delta_distance == 0)) {</b>
<b class="nc">&nbsp;            if (result == null) {</b>
<b class="nc">&nbsp;                result = new TargetRoll(1, &quot;DEST suit&quot;);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                result.append(new TargetRoll(1, &quot;DEST Suit&quot;));</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;
<b class="nc">&nbsp;        if (result == null) {</b>
<b class="nc">&nbsp;            result = new TargetRoll(0, &quot;no sneak mods&quot;);</b>
&nbsp;        }
&nbsp;
&nbsp;        // Return the result.
<b class="nc">&nbsp;        return result;</b>
&nbsp;    } // End public TargetRoll getStealthModifier( char )
&nbsp;
&nbsp;    /**
&nbsp;     * Determines if the infantry has any type of stealth system.
&nbsp;     *
&nbsp;     * @return
&nbsp;     */
&nbsp;    public boolean isStealthy() {
<b class="nc">&nbsp;       return  dest || sneak_camo || sneak_ir || sneak_ecm;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean hasMicrolite() {
<b class="nc">&nbsp;    	return microlite;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setMicrolite(boolean microlite) {
<b class="nc">&nbsp;    	this.microlite = microlite;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Used to check for standard or motorized SCUBA infantry, which have a maximum
&nbsp;     * depth of 2.
&nbsp;     * @return true if this is a conventional infantry unit with non-mechanized SCUBA specialization
&nbsp;     */
&nbsp;    public boolean isNonMechSCUBA() {
<b class="nc">&nbsp;    	if (this instanceof BattleArmor) {</b>
<b class="nc">&nbsp;    		return false;</b>
&nbsp;    	}
<b class="nc">&nbsp;    	return getMovementMode() == EntityMovementMode.INF_UMU;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setPrimaryWeapon(InfantryWeapon w) {
<b class="nc">&nbsp;        primaryW = w;</b>
<b class="nc">&nbsp;        primaryName = w.getName();</b>
&nbsp;    }
&nbsp;
&nbsp;    public InfantryWeapon getPrimaryWeapon() {
<b class="nc">&nbsp;        return primaryW;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setSecondaryWeapon(InfantryWeapon w) {
<b class="nc">&nbsp;        secondW = w;</b>
<b class="nc">&nbsp;        if(null == w) {</b>
<b class="nc">&nbsp;            secondName = null;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            secondName = w.getName();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public InfantryWeapon getSecondaryWeapon() {
<b class="nc">&nbsp;        return secondW;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setSquadSize(int size) {
<b class="nc">&nbsp;        squadsize = size;</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getSquadSize() {
<b class="nc">&nbsp;        return squadsize;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setSquadN(int n) {
<b class="nc">&nbsp;        squadn = n;</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getSquadN() {
<b class="nc">&nbsp;        return squadn;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setSecondaryN(int n) {
<b class="nc">&nbsp;        secondn = n;</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getSecondaryN() {
<b class="nc">&nbsp;        return secondn;</b>
&nbsp;    }
&nbsp;
&nbsp;    public double getDamagePerTrooper() {
&nbsp;
<b class="nc">&nbsp;        if(null == primaryW) {</b>
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        double damage = primaryW.getInfantryDamage() * (squadsize - secondn);</b>
<b class="nc">&nbsp;        if(null != secondW) {</b>
<b class="nc">&nbsp;            damage += secondW.getInfantryDamage() * secondn;</b>
&nbsp;        }
<b class="nc">&nbsp;        return damage/squadsize;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean isSquad() {
<b class="nc">&nbsp;        return (squadn == 1);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Set the movement type of the entity
&nbsp;     */
&nbsp;    @Override
&nbsp;    public void setMovementMode(EntityMovementMode movementMode) {
<b class="nc">&nbsp;        super.setMovementMode(movementMode);</b>
&nbsp;        //movement mode will determine base mp
<b class="nc">&nbsp;        if (!(this instanceof BattleArmor)) {</b>
<b class="nc">&nbsp;            setOriginalJumpMP(0);</b>
<b class="nc">&nbsp;            switch (getMovementMode()) {</b>
&nbsp;                case INF_MOTORIZED:
<b class="nc">&nbsp;                    setOriginalWalkMP(3);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case HOVER:
<b class="nc">&nbsp;                    setOriginalWalkMP(5);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case TRACKED:
<b class="nc">&nbsp;                    setOriginalWalkMP(3);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case WHEELED:
<b class="nc">&nbsp;                    setOriginalWalkMP(4);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case SUBMARINE:
<b class="nc">&nbsp;                    setOriginalJumpMP(3);</b>
<b class="nc">&nbsp;                    setOriginalWalkMP(0);</b>
<b class="nc">&nbsp;                	setSpecializations(getSpecializations() | SCUBA);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case VTOL:
<b class="nc">&nbsp;                	if (hasMicrolite()) {</b>
<b class="nc">&nbsp;                    	setOriginalJumpMP(6);</b>
&nbsp;                	} else {
<b class="nc">&nbsp;                		setOriginalJumpMP(5);</b>
&nbsp;                	}
<b class="nc">&nbsp;                	setOriginalWalkMP(1);</b>
<b class="nc">&nbsp;                	break;</b>
&nbsp;                case INF_UMU:
<b class="nc">&nbsp;                	setOriginalJumpMP(1);</b>
<b class="nc">&nbsp;                	setOriginalWalkMP(1);</b>
<b class="nc">&nbsp;                	setSpecializations(getSpecializations() | SCUBA);</b>
<b class="nc">&nbsp;                	break;</b>
&nbsp;                case INF_JUMP:
&nbsp;                    //fall through to get the original Walk MP is deliberate
<b class="nc">&nbsp;                    setOriginalJumpMP(3);</b>
&nbsp;                case INF_LEG:
<b class="nc">&nbsp;                    setOriginalWalkMP(1);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                default:
<b class="nc">&nbsp;                    setOriginalWalkMP(1);</b>
&nbsp;            }
<b class="nc">&nbsp;            addTechComponent(Infantry.getMotiveTechAdvancement(movementMode));</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Standard and motorized SCUBA only differ in base movement, so they both use
&nbsp;     * INF_UMU. If the motion_type contains the string &quot;motorized&quot;,
&nbsp;     * the movement is set here instead.
&nbsp;     */
&nbsp;    public void setMotorizedScuba() {
<b class="nc">&nbsp;    	setMovementMode(EntityMovementMode.INF_UMU);</b>
<b class="nc">&nbsp;    	setOriginalJumpMP(2);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String getMovementModeAsString() {
<b class="nc">&nbsp;        if (!hasETypeFlag(Entity.ETYPE_BATTLEARMOR)) {</b>
<b class="nc">&nbsp;            if (getMovementMode().equals(EntityMovementMode.VTOL)) {</b>
<b class="nc">&nbsp;                return hasMicrolite()? &quot;Microlite&quot; : &quot;Microcopter&quot;;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (getMovementMode() == EntityMovementMode.INF_UMU) {</b>
<b class="nc">&nbsp;                return getOriginalJumpMP() &gt; 1? &quot;Motorized SCUBA&quot; : &quot;SCUBA&quot;;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;    	return super.getMovementModeAsString();</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean canMakeAntiMekAttacks() {
<b class="nc">&nbsp;        return !isMechanized();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getWeight() {
&nbsp;        double mult;
<b class="nc">&nbsp;        switch (getMovementMode()) {</b>
&nbsp;            case INF_MOTORIZED:
<b class="nc">&nbsp;                mult = 0.195;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case HOVER:
&nbsp;            case TRACKED:
&nbsp;            case WHEELED:
<b class="nc">&nbsp;                mult = 1.0;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case VTOL:
<b class="nc">&nbsp;            	mult = (hasMicrolite()? 1.4 : 1.9);</b>
<b class="nc">&nbsp;            	break;</b>
&nbsp;            case INF_JUMP:
<b class="nc">&nbsp;                mult = 0.165;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case INF_UMU:
<b class="nc">&nbsp;            	if (getActiveUMUCount() &gt; 1) {</b>
<b class="nc">&nbsp;            		mult = 0.295; //motorized + 0.1 for motorized scuba</b>
&nbsp;            	} else {
<b class="nc">&nbsp;            		mult = 0.135; //foot + 0.05 for scuba</b>
&nbsp;            	}
<b class="nc">&nbsp;            	break;</b>
&nbsp;            case SUBMARINE:
<b class="nc">&nbsp;            	mult = 0.9;</b>
<b class="nc">&nbsp;            	break;</b>
&nbsp;            case INF_LEG:
&nbsp;            default:
<b class="nc">&nbsp;                mult = 0.085;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (hasSpecialization(COMBAT_ENGINEERS)) {</b>
<b class="nc">&nbsp;        	mult += 0.1;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hasSpecialization(PARATROOPS)) {</b>
<b class="nc">&nbsp;        	mult += 0.05;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hasSpecialization(PARAMEDICS)) {</b>
<b class="nc">&nbsp;        	mult += 0.05;</b>
&nbsp;        }
<b class="nc">&nbsp;        if(isAntiMekTrained()){</b>
<b class="nc">&nbsp;        	mult +=.015;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        double ton = men * mult;</b>
&nbsp;
&nbsp;
&nbsp;        //add in field gun weight
<b class="nc">&nbsp;        for (Mounted mounted : getEquipment()) {</b>
<b class="nc">&nbsp;            if(mounted.getLocation() == LOC_FIELD_GUNS) {</b>
<b class="nc">&nbsp;                ton += mounted.getTonnage();</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
&nbsp;
<b class="nc">&nbsp;        return RoundWeight.nearestHalfTon(ton);</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    public String getArmorDesc() {
<b class="nc">&nbsp;        StringBuffer sArmor = new StringBuffer();</b>
<b class="nc">&nbsp;        sArmor.append(calcDamageDivisor());</b>
<b class="nc">&nbsp;        if(isArmorEncumbering()) {</b>
<b class="nc">&nbsp;            sArmor.append(&quot;E&quot;);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (hasSpaceSuit()) {</b>
<b class="nc">&nbsp;            sArmor.append(&quot; (Spacesuit) &quot;);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if(hasDEST()) {</b>
<b class="nc">&nbsp;            sArmor.append(&quot; (DEST) &quot;);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if(hasSneakCamo() ||</b>
<b class="nc">&nbsp;        		(getCrew() != null</b>
<b class="nc">&nbsp;        			&amp;&amp; hasAbility(OptionsConstants.MD_DERMAL_CAMO_ARMOR))) {</b>
<b class="nc">&nbsp;            sArmor.append(&quot; (Camo) &quot;);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if(hasSneakIR()) {</b>
<b class="nc">&nbsp;            sArmor.append(&quot; (IR) &quot;);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if(hasSneakECM()) {</b>
<b class="nc">&nbsp;            sArmor.append(&quot; (ECM) &quot;);</b>
&nbsp;        }
&nbsp;
&nbsp;
<b class="nc">&nbsp;        return sArmor.toString();</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Restores the entity after serialization
&nbsp;     */
&nbsp;    @Override
&nbsp;    public void restore() {
<b class="nc">&nbsp;        super.restore();</b>
&nbsp;
<b class="nc">&nbsp;        if (null != primaryName) {</b>
<b class="nc">&nbsp;            primaryW = (InfantryWeapon)EquipmentType.get(primaryName);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if(null != secondName) {</b>
<b class="nc">&nbsp;            secondW = (InfantryWeapon)EquipmentType.get(secondName);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public boolean hasActiveFieldArtillery() {
<b class="nc">&nbsp;        boolean hasArtillery = false;</b>
<b class="nc">&nbsp;        double smallestGun = 100.0;</b>
<b class="nc">&nbsp;        for(Mounted wpn : getWeaponList()) {</b>
<b class="nc">&nbsp;            if(wpn.getLocation() != LOC_FIELD_GUNS) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
<b class="nc">&nbsp;            if(wpn.getType().hasFlag(WeaponType.F_ARTILLERY)) {</b>
<b class="nc">&nbsp;                hasArtillery = true;</b>
<b class="nc">&nbsp;                if(wpn.getTonnage() &lt; smallestGun) {</b>
<b class="nc">&nbsp;                    smallestGun = wpn.getTonnage();</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;        }</b>
&nbsp;
&nbsp;        //you must have enough men to fire at least the smallest piece
<b class="nc">&nbsp;        return hasArtillery &amp;&amp; (getShootingStrength() &gt;= smallestGun);</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Infantry don&#39;t use MP to change facing, and don&#39;t
&nbsp;     * do PSRs, so just don&#39;t let them use maneuvering ace
&nbsp;     * otherwise, their movement gets screwed up
&nbsp;     */
&nbsp;    @Override
&nbsp;    public boolean isUsingManAce() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void setAlphaStrikeMovement(Map&lt;String,Integer&gt; moves) {
<b class="nc">&nbsp;        moves.put(getMovementModeAsBattleForceString(),</b>
<b class="nc">&nbsp;                Math.max(getWalkMP(), getJumpMP()) * 2);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public int getBattleForceSize() {
&nbsp;        //The tables are on page 356 of StartOps
<b class="nc">&nbsp;        return 1;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public int getBattleForceArmorPoints() {
&nbsp;        // Infantry armor points is # of men / 15
<b class="nc">&nbsp;        return (int) Math.ceil(getInternal(0)/15.0);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    /**
&nbsp;     * Each squad has 1 structure point
&nbsp;     */
&nbsp;    public int getBattleForceStructurePoints() {
<b class="nc">&nbsp;        return 1;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public int getNumBattleForceWeaponsLocations() {
<b class="nc">&nbsp;        if (hasFieldGun()) {</b>
<b class="nc">&nbsp;            return 2;</b>
&nbsp;        }
<b class="nc">&nbsp;        return 1;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getBattleForceLocationMultiplier(int index, int location, boolean rearMounted) {
<b class="nc">&nbsp;        if (index == location) {</b>
<b class="nc">&nbsp;            return 1.0;</b>
&nbsp;        }
<b class="nc">&nbsp;        return 0;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String getBattleForceLocationName(int index) {
<b class="nc">&nbsp;        if (index == 0) {</b>
<b class="nc">&nbsp;            return &quot;&quot;;</b>
&nbsp;        }
<b class="nc">&nbsp;        return LOCATION_ABBRS[index];</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void addBattleForceSpecialAbilities(Map&lt;BattleForceSPA,Integer&gt; specialAbilities) {
<b class="nc">&nbsp;        super.addBattleForceSpecialAbilities(specialAbilities);</b>
<b class="nc">&nbsp;        specialAbilities.put(BattleForceSPA.CAR, (int)Math.ceil(getWeight()));</b>
<b class="nc">&nbsp;        if (getMovementMode().equals(EntityMovementMode.INF_UMU)) {</b>
<b class="nc">&nbsp;            specialAbilities.put(BattleForceSPA.UMU, null);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hasSpecialization(FIRE_ENGINEERS)) {</b>
<b class="nc">&nbsp;            specialAbilities.put(BattleForceSPA.FF, null);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hasSpecialization(MINE_ENGINEERS)) {</b>
<b class="nc">&nbsp;            specialAbilities.put(BattleForceSPA.MSW, null);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hasSpecialization(MOUNTAIN_TROOPS)) {</b>
<b class="nc">&nbsp;            specialAbilities.put(BattleForceSPA.MTN, null);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hasSpecialization(PARATROOPS)) {</b>
<b class="nc">&nbsp;            specialAbilities.put(BattleForceSPA.PARA, null);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hasSpecialization(SCUBA)) {</b>
<b class="nc">&nbsp;            specialAbilities.put(BattleForceSPA.UMU, null);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hasSpecialization(TRENCH_ENGINEERS)) {</b>
<b class="nc">&nbsp;            specialAbilities.put(BattleForceSPA.TRN, null);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hasAbility(&quot;tsm_implant&quot;)) {</b>
<b class="nc">&nbsp;            specialAbilities.put(BattleForceSPA.TSI, null);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public int getEngineHits() {
<b class="nc">&nbsp;        return 0;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String getLocationDamage(int loc) {
<b class="nc">&nbsp;        return &quot;&quot;;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isCrippled() {
<b class="nc">&nbsp;        double activeTroopPercent = (double) getInternal(LOC_INFANTRY) / getOInternal(LOC_INFANTRY);</b>
<b class="nc">&nbsp;        if (activeTroopPercent &lt; 0.25) {</b>
<b class="nc">&nbsp;            MegaMek.getLogger().debug(getDisplayName() + &quot; CRIPPLED: Only &quot;</b>
<b class="nc">&nbsp;                    + NumberFormat.getPercentInstance().format(activeTroopPercent) + &quot; troops remaining.&quot;);</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isCrippled(boolean checkCrew) {
<b class="nc">&nbsp;        return isCrippled();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isDmgHeavy() {
<b class="nc">&nbsp;        return (((double) getInternal(LOC_INFANTRY) / getOInternal(LOC_INFANTRY)) &lt; 0.5);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isDmgModerate() {
<b class="nc">&nbsp;        return (((double) getInternal(LOC_INFANTRY) / getOInternal(LOC_INFANTRY)) &lt; 0.75);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isDmgLight() {
<b class="nc">&nbsp;        return (((double) getInternal(LOC_INFANTRY) / getOInternal(LOC_INFANTRY)) &lt; 0.9);</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean hasFieldGun() {
<b class="nc">&nbsp;        for (Mounted m : getWeaponList()) {</b>
<b class="nc">&nbsp;            if (m.getLocation() == Infantry.LOC_FIELD_GUNS) {</b>
<b class="nc">&nbsp;                return true;</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean hasEngine() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Mounts the specified equipment in the specified location.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public void addEquipment(Mounted mounted, int loc, boolean rearMounted) throws LocationFullException {
&nbsp;        // Implement parent&#39;s behavior.
<b class="nc">&nbsp;        super.addEquipment(mounted, loc, rearMounted);</b>
&nbsp;
&nbsp;        //we do need to equipment slots for ammo switching of field guns and field artillery
&nbsp;        // Add the piece equipment to our slots.
<b class="nc">&nbsp;        addCritical(loc, new CriticalSlot(mounted));</b>
&nbsp;
&nbsp;    }
&nbsp;    
&nbsp;    public boolean isConventionalInfantry() {
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public long getEntityType(){
<b class="nc">&nbsp;        return Entity.ETYPE_INFANTRY;</b>
&nbsp;    }
&nbsp;
&nbsp;    public PilotingRollData checkLandingInHeavyWoods(
&nbsp;            EntityMovementType overallMoveType, IHex curHex) {
<b class="nc">&nbsp;        PilotingRollData roll = getBasePilotingRoll(overallMoveType);</b>
<b class="nc">&nbsp;        roll.addModifier(TargetRoll.CHECK_FALSE,</b>
&nbsp;                         &quot;Infantry cannot fall&quot;);
<b class="nc">&nbsp;        return roll;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Determines if there is valid cover for an infantry unit to utilize the
&nbsp;     * Using Non-Infantry as Cover rules (TO pg 108).
&nbsp;     * @param game
&nbsp;     * @param pos
&nbsp;     * @param elevation
&nbsp;     * @return
&nbsp;     */
&nbsp;    public static boolean hasValidCover(IGame game, Coords pos, int elevation) {
&nbsp;        // Can&#39;t do anything if we don&#39;t have a position
&nbsp;        // If elevation &gt; 0, we&#39;re either flying, or in a building
&nbsp;        // In either case, we shouldn&#39;t be allowed to take cover
<b class="nc">&nbsp;        if ((pos == null) || (elevation &gt; 0)) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
<b class="nc">&nbsp;        boolean hasMovedEntity = false;</b>
&nbsp;        // First, look for ground untis in the same hex that have already moved
<b class="nc">&nbsp;        for (Entity e : game.getEntitiesVector(pos)) {</b>
<b class="nc">&nbsp;            if (e.isDone() &amp;&amp; !(e instanceof Infantry)</b>
<b class="nc">&nbsp;                    &amp;&amp; (e.getElevation() == elevation)) {</b>
<b class="nc">&nbsp;                hasMovedEntity = true;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
&nbsp;        // If we didn&#39;t find anything, check for wrecks
&nbsp;        // The rules don&#39;t explicitly cover this, but it makes sense
<b class="nc">&nbsp;        if (!hasMovedEntity) {</b>
<b class="nc">&nbsp;            Enumeration&lt;Entity&gt; wrecks = game.getWreckedEntities();</b>
<b class="nc">&nbsp;            while (wrecks.hasMoreElements()) {</b>
<b class="nc">&nbsp;                Entity e = wrecks.nextElement();</b>
<b class="nc">&nbsp;                if (pos.equals(e.getPosition())</b>
&nbsp;                        &amp;&amp; !(e instanceof Infantry)) {
<b class="nc">&nbsp;                    hasMovedEntity = true;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        return hasMovedEntity;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean isTakingCover() {
<b class="nc">&nbsp;        return isTakingCover;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setTakingCover(boolean isTakingCover) {
<b class="nc">&nbsp;        this.isTakingCover = isTakingCover;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    protected boolean hasViableWeapons() {
<b class="nc">&nbsp;        return !isCrippled();</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Used to determine the draw priority of different Entity subclasses.
&nbsp;     * This allows different unit types to always be draw above/below other
&nbsp;     * types.
&nbsp;     *
&nbsp;     * @return
&nbsp;     */
&nbsp;    public int getSpriteDrawPriority() {
<b class="nc">&nbsp;        return 1;</b>
&nbsp;    }
&nbsp;} // End class Infantry
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-04-13 20:46</div>
</div>
</body>
</html>
