


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > ComputeECMTest</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">megamek.common</a>
</div>

<h1>Coverage Summary for Class: ComputeECMTest (megamek.common)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">ComputeECMTest</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (6/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (8/8)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    98%
  </span>
  <span class="absValue">
    (478/488)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * MegaMek - Copyright (C) 2000,2001,2002,2003,2004,2005 Ben Mazur
&nbsp; * (bmazur@sev.org)
&nbsp; *
&nbsp; * This program is free software; you can redistribute it and/or modify it under
&nbsp; * the terms of the GNU General Public License as published by the Free Software
&nbsp; * Foundation; either version 2 of the License, or (at your option) any later
&nbsp; * version.
&nbsp; *
&nbsp; * This program is distributed in the hope that it will be useful, but WITHOUT
&nbsp; * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
&nbsp; * FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
&nbsp; * details.
&nbsp; */
&nbsp;package megamek.common;
&nbsp;
&nbsp;import junit.framework.TestCase;
&nbsp;import megamek.common.Entity;
&nbsp;import megamek.common.options.GameOptions;
&nbsp;import megamek.server.SmokeCloud;
&nbsp;
&nbsp;import org.junit.Test;
&nbsp;import org.junit.runner.RunWith;
&nbsp;import org.junit.runners.JUnit4;
&nbsp;import org.mockito.Mockito;
&nbsp;
&nbsp;import java.io.File;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Vector;
&nbsp;
&nbsp;/**
&nbsp; * Created with IntelliJ IDEA.
&nbsp; *
&nbsp; * @version $Id$
&nbsp; * @lastEditBy Deric &quot;Netzilla&quot; Page (deric dot page at usa dot net)
&nbsp; * @since 11/3/13 8:48 AM
&nbsp; */
&nbsp;@RunWith(JUnit4.class)
<b class="fc">&nbsp;public class ComputeECMTest {</b>
&nbsp;    
&nbsp;    @Test
&nbsp;    public void testEntityGetECMInfo() {
&nbsp;        // Mock Player
<b class="fc">&nbsp;        IPlayer mockPlayer = Mockito.mock(IPlayer.class);</b>
&nbsp;        
&nbsp;        // Mock the board
<b class="fc">&nbsp;        Board mockBoard = Mockito.mock(Board.class);</b>
<b class="fc">&nbsp;        Mockito.when(mockBoard.inSpace()).thenReturn(false);</b>
&nbsp;        
&nbsp;        // Mock Options
<b class="fc">&nbsp;        GameOptions mockOptions = Mockito.mock(GameOptions.class);</b>
<b class="fc">&nbsp;        Mockito.when(mockOptions.booleanOption(Mockito.anyString()))</b>
<b class="fc">&nbsp;                .thenReturn(false);</b>
<b class="fc">&nbsp;        Mockito.when(mockOptions.booleanOption(&quot;tacops_eccm&quot;)).thenReturn(true);</b>
&nbsp;        
&nbsp;        // Mock the game
<b class="fc">&nbsp;        Game mockGame = Mockito.mock(Game.class);</b>
<b class="fc">&nbsp;        Mockito.when(mockGame.getBoard()).thenReturn(mockBoard);</b>
<b class="fc">&nbsp;        Mockito.when(mockGame.getSmokeCloudList()).thenReturn(</b>
&nbsp;                new ArrayList&lt;SmokeCloud&gt;());
<b class="fc">&nbsp;        Mockito.when(mockGame.getOptions()).thenReturn(mockOptions);</b>
&nbsp;        
&nbsp;        ECMInfo ecmInfo, eccmInfo, testInfoECM, testInfoECCM;
&nbsp;        File f;
&nbsp;        MechFileParser mfp;
&nbsp;        Entity archer;
&nbsp;        
&nbsp;        try {
<b class="fc">&nbsp;            f = new File(&quot;data/mechfiles/mechs/3039u/Archer ARC-2R.mtf&quot;);</b>
<b class="fc">&nbsp;            mfp  = new MechFileParser(f);</b>
<b class="fc">&nbsp;            archer = mfp.getEntity();</b>
<b class="nc">&nbsp;        } catch (Exception exc){</b>
<b class="nc">&nbsp;            TestCase.fail(exc.getMessage());</b>
&nbsp;            return;
<b class="fc">&nbsp;        }</b>
&nbsp;
<b class="fc">&nbsp;        MiscType.initializeTypes();</b>
&nbsp;        EquipmentType eType;
&nbsp;
&nbsp;        // Test no ECM Info
<b class="fc">&nbsp;        ecmInfo = archer.getECMInfo();</b>
<b class="fc">&nbsp;        TestCase.assertEquals(null, ecmInfo);</b>
<b class="fc">&nbsp;        eccmInfo = archer.getECCMInfo();</b>
<b class="fc">&nbsp;        TestCase.assertEquals(null, eccmInfo);</b>
&nbsp;           
&nbsp;        /*********************************************************************/
&nbsp;        // Add ECM        
<b class="fc">&nbsp;        eType = EquipmentType.get(&quot;ISGuardianECMSuite&quot;);</b>
&nbsp;        try {
<b class="fc">&nbsp;            archer.addEquipment(eType, Mech.LOC_RT);</b>
<b class="nc">&nbsp;        } catch (LocationFullException e) {</b>
<b class="nc">&nbsp;            TestCase.fail(e.getMessage());</b>
<b class="fc">&nbsp;        }</b>
&nbsp;        
<b class="fc">&nbsp;        Coords pos = new Coords(0,0);</b>
<b class="fc">&nbsp;        archer.setPosition(pos);</b>
<b class="fc">&nbsp;        archer.setOwner(mockPlayer);</b>
<b class="fc">&nbsp;        archer.setGame(mockGame);</b>
&nbsp;        
<b class="fc">&nbsp;        testInfoECM = new ECMInfo(6, pos, mockPlayer, 1, 0);</b>
<b class="fc">&nbsp;        ecmInfo = archer.getECMInfo();</b>
<b class="fc">&nbsp;        TestCase.assertEquals(testInfoECM, ecmInfo);</b>
<b class="fc">&nbsp;        eccmInfo = archer.getECCMInfo();</b>
<b class="fc">&nbsp;        TestCase.assertEquals(null, eccmInfo);</b>
&nbsp;        
&nbsp;        /*********************************************************************/
&nbsp;        // Change mode from ECM to ECCM
<b class="fc">&nbsp;        Mounted ecm = null;</b>
<b class="fc">&nbsp;        for (Mounted m : archer.getMisc()) {</b>
<b class="fc">&nbsp;            if (m.getType().equals(eType)) {</b>
<b class="fc">&nbsp;                ecm = m;</b>
&nbsp;            }
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;        TestCase.assertNotNull(ecm);</b>
<b class="fc">&nbsp;        int rv = ecm.setMode(&quot;ECCM&quot;);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(1, rv);</b>
&nbsp;        // Need to update the round  to make the mode switch happen
<b class="fc">&nbsp;        archer.newRound(1);</b>
&nbsp;        
<b class="fc">&nbsp;        testInfoECCM = new ECMInfo(6, pos, mockPlayer, 0, 0);</b>
<b class="fc">&nbsp;        testInfoECCM.setECCMStrength(1);</b>
<b class="fc">&nbsp;        ecmInfo = archer.getECMInfo();</b>
<b class="fc">&nbsp;        TestCase.assertEquals(null, ecmInfo);</b>
<b class="fc">&nbsp;        eccmInfo = archer.getECCMInfo();</b>
<b class="fc">&nbsp;        TestCase.assertEquals(testInfoECCM, eccmInfo);</b>
&nbsp;        
&nbsp;        // Add a second ECM
&nbsp;        try {
<b class="fc">&nbsp;            archer.addEquipment(eType, Mech.LOC_RT);</b>
<b class="nc">&nbsp;        } catch (LocationFullException e) {</b>
<b class="nc">&nbsp;            TestCase.fail(e.getMessage());</b>
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;        ecmInfo = archer.getECMInfo();</b>
<b class="fc">&nbsp;        TestCase.assertEquals(testInfoECM, ecmInfo);</b>
<b class="fc">&nbsp;        eccmInfo = archer.getECCMInfo();</b>
<b class="fc">&nbsp;        TestCase.assertEquals(testInfoECCM, eccmInfo);</b>
&nbsp;        
&nbsp;        /*********************************************************************/
&nbsp;        // Add an Angel ECM
<b class="fc">&nbsp;        eType = EquipmentType.get(&quot;ISAngelECMSuite&quot;);</b>
&nbsp;        try {
<b class="fc">&nbsp;            archer.addEquipment(eType, Mech.LOC_LT);</b>
<b class="nc">&nbsp;        } catch (LocationFullException e) {</b>
<b class="nc">&nbsp;            TestCase.fail(e.getMessage());</b>
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;        testInfoECM = new ECMInfo(6, pos, mockPlayer, 0, 1);</b>
<b class="fc">&nbsp;        ecmInfo = archer.getECMInfo();</b>
<b class="fc">&nbsp;        TestCase.assertEquals(testInfoECM, ecmInfo);</b>
<b class="fc">&nbsp;        eccmInfo = archer.getECCMInfo();</b>
<b class="fc">&nbsp;        TestCase.assertEquals(testInfoECCM, eccmInfo);</b>
&nbsp;        
&nbsp;        // Add a second Angel ECM (adding a second Angel ECM shouldn&#39;t have 
&nbsp;        //  any effect)
&nbsp;        try {
<b class="fc">&nbsp;            archer.addEquipment(eType, Mech.LOC_LARM);</b>
<b class="nc">&nbsp;        } catch (LocationFullException e) {</b>
<b class="nc">&nbsp;            TestCase.fail(e.getMessage());</b>
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;        ecmInfo = archer.getECMInfo();</b>
<b class="fc">&nbsp;        TestCase.assertEquals(testInfoECM, ecmInfo);</b>
<b class="fc">&nbsp;        eccmInfo = archer.getECCMInfo();</b>
<b class="fc">&nbsp;        TestCase.assertEquals(testInfoECCM, eccmInfo);</b>
&nbsp;        
<b class="fc">&nbsp;        archer.setGameOptions();</b>
<b class="fc">&nbsp;        ecm = null;</b>
<b class="fc">&nbsp;        for (Mounted m : archer.getMisc()) {</b>
<b class="fc">&nbsp;            if (m.getType().equals(eType)) {</b>
<b class="fc">&nbsp;                ecm = m;</b>
&nbsp;            }
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;        TestCase.assertNotNull(ecm);</b>
<b class="fc">&nbsp;        rv = ecm.setMode(&quot;ECM &amp; ECCM&quot;);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(2, rv);</b>
&nbsp;        // Need to update the round  to make the mode switch happen
<b class="fc">&nbsp;        archer.newRound(2);</b>
&nbsp;
<b class="fc">&nbsp;        ecmInfo = archer.getECMInfo();</b>
<b class="fc">&nbsp;        TestCase.assertEquals(testInfoECM, ecmInfo);</b>
<b class="fc">&nbsp;        eccmInfo = archer.getECCMInfo();</b>
<b class="fc">&nbsp;        TestCase.assertEquals(testInfoECCM, eccmInfo);        </b>
&nbsp;        
&nbsp;    }
&nbsp;    
&nbsp;
&nbsp;    /**
&nbsp;     *  Basic tests for ECM on ground maps, includes single enemy single ally
&nbsp;     *  single hex. 
&nbsp;     */
&nbsp;    @Test
&nbsp;    public void testBasicECM() {
&nbsp;        
&nbsp;        // Create a player
<b class="fc">&nbsp;        IPlayer mockPlayer =  Mockito.mock(IPlayer.class);</b>
<b class="fc">&nbsp;        Mockito.when(mockPlayer.isEnemyOf(mockPlayer)).thenReturn(false);</b>
<b class="fc">&nbsp;        Mockito.when(mockPlayer.getName()).thenReturn(&quot;MockPlayer&quot;);</b>
&nbsp;        
&nbsp;        // Create an enemy player
<b class="fc">&nbsp;        IPlayer mockEnemy =  Mockito.mock(IPlayer.class);</b>
<b class="fc">&nbsp;        Mockito.when(mockEnemy.isEnemyOf(mockEnemy)).thenReturn(false);</b>
<b class="fc">&nbsp;        Mockito.when(mockEnemy.getName()).thenReturn(&quot;MockEnemy&quot;);</b>
<b class="fc">&nbsp;        Mockito.when(mockPlayer.isEnemyOf(mockEnemy)).thenReturn(true);</b>
<b class="fc">&nbsp;        Mockito.when(mockEnemy.isEnemyOf(mockPlayer)).thenReturn(true);</b>
&nbsp;        
&nbsp;        // Mock the board
<b class="fc">&nbsp;        Board mockBoard = Mockito.mock(Board.class);</b>
<b class="fc">&nbsp;        Mockito.when(mockBoard.inSpace()).thenReturn(false);</b>
&nbsp;        
&nbsp;        // Mock Options
<b class="fc">&nbsp;        GameOptions mockOptions = Mockito.mock(GameOptions.class);</b>
<b class="fc">&nbsp;        Mockito.when(mockOptions.booleanOption(Mockito.anyString()))</b>
<b class="fc">&nbsp;                .thenReturn(false);</b>
<b class="fc">&nbsp;        Mockito.when(mockOptions.booleanOption(&quot;tacops_eccm&quot;)).thenReturn(true);</b>
&nbsp;        
&nbsp;        // Mock the game
<b class="fc">&nbsp;        Game mockGame = Mockito.mock(Game.class);</b>
<b class="fc">&nbsp;        Mockito.when(mockGame.getBoard()).thenReturn(mockBoard);</b>
<b class="fc">&nbsp;        Mockito.when(mockGame.getSmokeCloudList()).thenReturn(</b>
&nbsp;                new ArrayList&lt;SmokeCloud&gt;());
<b class="fc">&nbsp;        Mockito.when(mockGame.getOptions()).thenReturn(mockOptions);</b>
&nbsp;        
&nbsp;        // Create a list of enemies, owned by the mockEnemy
<b class="fc">&nbsp;        Vector&lt;Entity&gt; entitiesVector = createECMEnemy(mockEnemy, mockGame);</b>
<b class="fc">&nbsp;        Mockito.when(mockGame.getEntitiesVector()).thenReturn(entitiesVector);</b>
&nbsp;
&nbsp;        Coords enemyPos;
&nbsp;        ECMInfo enemyECMInfo;
&nbsp;        
&nbsp;        /*********************************************************************/
&nbsp;        // Same Hex Tests
&nbsp;        
&nbsp;        // Attack Entity ECM Info
<b class="fc">&nbsp;        Coords aePos = new Coords(6,6);</b>
<b class="fc">&nbsp;        ECMInfo aeNullECM = null;</b>
<b class="fc">&nbsp;        ECMInfo aeECM = new ECMInfo(6, aePos, mockPlayer, 1, 0);</b>
<b class="fc">&nbsp;        ECMInfo aeAngelECM = new ECMInfo(6, aePos, mockPlayer, 0, 1);</b>
<b class="fc">&nbsp;        ECMInfo aeECCM = new ECMInfo(6, aePos, mockPlayer, 0, 0);</b>
<b class="fc">&nbsp;        aeECCM.setECCMStrength(1);</b>
<b class="fc">&nbsp;        ECMInfo aeAngelECCM = new ECMInfo(6, aePos, mockPlayer, 0, 0);</b>
<b class="fc">&nbsp;        aeAngelECCM.setAngelECCMStrength(1);</b>
&nbsp;        
<b class="fc">&nbsp;        Entity additionalEnemy = Mockito.mock(Tank.class);</b>
<b class="fc">&nbsp;        Mockito.when(additionalEnemy.getOwner()).thenReturn(mockEnemy);</b>
<b class="fc">&nbsp;        Mockito.when(additionalEnemy.getECMInfo()).thenReturn(null);</b>
<b class="fc">&nbsp;        Mockito.when(additionalEnemy.getGame()).thenReturn(mockGame);</b>
&nbsp;        
<b class="fc">&nbsp;        Entity additionalAlly = Mockito.mock(Tank.class);</b>
<b class="fc">&nbsp;        Mockito.when(additionalAlly.getOwner()).thenReturn(mockPlayer);</b>
<b class="fc">&nbsp;        Mockito.when(additionalAlly.getECMInfo()).thenReturn(null);</b>
<b class="fc">&nbsp;        Mockito.when(additionalAlly.getGame()).thenReturn(mockGame);</b>
&nbsp;        
&nbsp;        // Attacking Entity
<b class="fc">&nbsp;        Entity ae = Mockito.mock(Mech.class);</b>
<b class="fc">&nbsp;        entitiesVector.add(ae);</b>
<b class="fc">&nbsp;        Mockito.when(ae.getPosition()).thenReturn(aePos);</b>
<b class="fc">&nbsp;        Mockito.when(ae.getGame()).thenReturn(mockGame);</b>
<b class="fc">&nbsp;        Mockito.when(ae.isINarcedWith(INarcPod.ECM)).thenReturn(false);</b>
<b class="fc">&nbsp;        Mockito.when(ae.getOwner()).thenReturn(mockPlayer);</b>
<b class="fc">&nbsp;        Mockito.when(ae.getECMInfo()).thenReturn(aeNullECM);</b>
&nbsp;        
&nbsp;        /*********************************************************************/
&nbsp;        // Basic ECM Test
&nbsp;        //  Enemy has ECM, Player has no ECM
&nbsp;        //  Shoud be affected by ECM, no Angel, no ECCM
&nbsp;        boolean result;
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByAngelECM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECCM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
&nbsp;        
&nbsp;        // Basic ECM for Player
&nbsp;        //  Enemy has ECM, Player has ECM
&nbsp;        //  Shoud be affected by ECM, no Angel, no ECCM
<b class="fc">&nbsp;        Mockito.when(ae.getECMInfo()).thenReturn(aeECM);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByAngelECM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECCM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
&nbsp;        
&nbsp;        // Basic Angel ECM for Player
&nbsp;        //  Enemy has ECM, Player has Angel ECM
&nbsp;        //  Shoud be affected by ECM, no Angel, no ECCM
<b class="fc">&nbsp;        Mockito.when(ae.getECMInfo()).thenReturn(aeAngelECM);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByAngelECM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECCM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
&nbsp;        
&nbsp;        // Basic ECCM for Player
&nbsp;        //  Enemy has ECM, Player has ECCM
&nbsp;        //  Shoud not be affected by ECM, no Angel, no ECCM
<b class="fc">&nbsp;        Mockito.when(ae.getECCMInfo()).thenReturn(aeECCM);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByAngelECM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECCM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
&nbsp;        
&nbsp;        // Basic Angel ECCM for Player
&nbsp;        //  Enemy has ECM, Player has Angel ECCM
&nbsp;        //  Shoud not affected by ECM, no Angel, yes ECCM
<b class="fc">&nbsp;        Mockito.when(ae.getECMInfo()).thenReturn(aeAngelECM);</b>
<b class="fc">&nbsp;        Mockito.when(ae.getECCMInfo()).thenReturn(aeAngelECCM);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByAngelECM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECCM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
&nbsp;        
&nbsp;        // Add some Angel ECM to eliminate the ECCM
<b class="fc">&nbsp;        enemyPos = new Coords(4,4);</b>
<b class="fc">&nbsp;        enemyECMInfo = new ECMInfo(6, enemyPos, mockEnemy, 0, 1);</b>
<b class="fc">&nbsp;        Mockito.when(additionalEnemy.getECMInfo()).thenReturn(enemyECMInfo);</b>
<b class="fc">&nbsp;        entitiesVector.add(additionalEnemy);</b>
&nbsp;        
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByAngelECM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECCM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
&nbsp;        
&nbsp;
&nbsp;        
&nbsp;        
<b class="fc">&nbsp;        entitiesVector = createAngelEnemy(mockEnemy, mockGame);</b>
<b class="fc">&nbsp;        entitiesVector.add(ae);</b>
<b class="fc">&nbsp;        Mockito.when(mockGame.getEntitiesVector()).thenReturn(entitiesVector);</b>
<b class="fc">&nbsp;        Mockito.when(ae.getECCMInfo()).thenReturn(null);</b>
&nbsp;        
&nbsp;        /*********************************************************************/
&nbsp;        // Basic Angel ECM Test
&nbsp;        // Enemy has Angel ECM, Player has no EC(C)M 
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByAngelECM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECCM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);    </b>
&nbsp;        
&nbsp;        // Basic Angel ECM for Player
&nbsp;        //  Enemy has Angel ECM, Player has ECM
&nbsp;        //  Shoud be affected by ECM, Angel, no ECCM
<b class="fc">&nbsp;        Mockito.when(ae.getECMInfo()).thenReturn(aeECM);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByAngelECM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECCM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
&nbsp;        
&nbsp;        // Basic Angel ECM for Player
&nbsp;        //  Enemy has Angel ECM, Player has Angel ECM
&nbsp;        //  Shoud be affected by ECM, no Angel, no ECCM
<b class="fc">&nbsp;        Mockito.when(ae.getECMInfo()).thenReturn(aeAngelECM);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByAngelECM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECCM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
&nbsp;        
&nbsp;        // Basic ECCM for Player
&nbsp;        //  Enemy has Angel ECM, Player has ECCM
&nbsp;        //  Shoud be affected by ECM, Angel, no ECCM
<b class="fc">&nbsp;        Mockito.when(ae.getECCMInfo()).thenReturn(aeECCM);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByAngelECM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECCM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
&nbsp;        
&nbsp;        // Basic Angel ECCM for Player
&nbsp;        //  Enemy has Angel ECM, Player has Angel ECCM
&nbsp;        //  Shoud not affected by ECM, no Angel, no ECCM
<b class="fc">&nbsp;        Mockito.when(ae.getECMInfo()).thenReturn(aeAngelECM);</b>
<b class="fc">&nbsp;        Mockito.when(ae.getECCMInfo()).thenReturn(aeAngelECCM);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByAngelECM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECCM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
&nbsp;        
&nbsp;        // Add in another enemy basic ECM
<b class="fc">&nbsp;        enemyPos = new Coords(4,4);</b>
<b class="fc">&nbsp;        enemyECMInfo = new ECMInfo(6, enemyPos, mockEnemy, 1, 0);</b>
<b class="fc">&nbsp;        Mockito.when(additionalEnemy.getECMInfo()).thenReturn(enemyECMInfo);</b>
<b class="fc">&nbsp;        entitiesVector.add(additionalEnemy);</b>
&nbsp;        
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByAngelECM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECCM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
&nbsp;        
&nbsp;        // Replace basic ECM with Angel
<b class="fc">&nbsp;        enemyECMInfo = new ECMInfo(6, enemyPos, mockEnemy, 0, 1);</b>
<b class="fc">&nbsp;        Mockito.when(additionalEnemy.getECMInfo()).thenReturn(enemyECMInfo);</b>
&nbsp;        
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByAngelECM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECCM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
&nbsp;        
&nbsp;        // Multiple enemy ECM, one player Angel ECCM
<b class="fc">&nbsp;        Mockito.when(ae.getECCMInfo()).thenReturn(aeAngelECCM);</b>
<b class="fc">&nbsp;        enemyECMInfo = new ECMInfo(6, enemyPos, mockEnemy, 1, 0);</b>
<b class="fc">&nbsp;        Mockito.when(additionalEnemy.getECMInfo()).thenReturn(enemyECMInfo);</b>
<b class="fc">&nbsp;        entitiesVector = createECMEnemy(mockEnemy, mockGame);</b>
<b class="fc">&nbsp;        entitiesVector.add(ae);</b>
<b class="fc">&nbsp;        entitiesVector.add(additionalEnemy);</b>
<b class="fc">&nbsp;        Mockito.when(mockGame.getEntitiesVector()).thenReturn(entitiesVector);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByAngelECM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECCM(ae, aePos, aePos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);        </b>
&nbsp;
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     *  Basic tests for ECM on ground maps, includes single enemy single ally
&nbsp;     *  multiple hexes.
&nbsp;     */
&nbsp;    @Test
&nbsp;    public void testBasicECMMultiHex() {
&nbsp;        
&nbsp;        // Create a player
<b class="fc">&nbsp;        IPlayer mockPlayer =  Mockito.mock(IPlayer.class);</b>
<b class="fc">&nbsp;        Mockito.when(mockPlayer.isEnemyOf(mockPlayer)).thenReturn(false);</b>
<b class="fc">&nbsp;        Mockito.when(mockPlayer.getName()).thenReturn(&quot;MockPlayer&quot;);</b>
&nbsp;        
&nbsp;        // Create an enemy player
<b class="fc">&nbsp;        IPlayer mockEnemy =  Mockito.mock(IPlayer.class);</b>
<b class="fc">&nbsp;        Mockito.when(mockEnemy.isEnemyOf(mockEnemy)).thenReturn(false);</b>
<b class="fc">&nbsp;        Mockito.when(mockEnemy.getName()).thenReturn(&quot;MockEnemy&quot;);</b>
<b class="fc">&nbsp;        Mockito.when(mockPlayer.isEnemyOf(mockEnemy)).thenReturn(true);</b>
<b class="fc">&nbsp;        Mockito.when(mockEnemy.isEnemyOf(mockPlayer)).thenReturn(true);</b>
&nbsp;        
&nbsp;        // Mock the board
<b class="fc">&nbsp;        Board mockBoard = Mockito.mock(Board.class);</b>
<b class="fc">&nbsp;        Mockito.when(mockBoard.inSpace()).thenReturn(false);</b>
&nbsp;        
&nbsp;        // Mock Options
<b class="fc">&nbsp;        GameOptions mockOptions = Mockito.mock(GameOptions.class);</b>
<b class="fc">&nbsp;        Mockito.when(mockOptions.booleanOption(Mockito.anyString()))</b>
<b class="fc">&nbsp;                .thenReturn(false);</b>
<b class="fc">&nbsp;        Mockito.when(mockOptions.booleanOption(&quot;tacops_eccm&quot;)).thenReturn(true);</b>
&nbsp;        
&nbsp;        // Mock the game
<b class="fc">&nbsp;        Game mockGame = Mockito.mock(Game.class);</b>
<b class="fc">&nbsp;        Mockito.when(mockGame.getBoard()).thenReturn(mockBoard);</b>
<b class="fc">&nbsp;        Mockito.when(mockGame.getSmokeCloudList()).thenReturn(</b>
&nbsp;                new ArrayList&lt;SmokeCloud&gt;());
<b class="fc">&nbsp;        Mockito.when(mockGame.getOptions()).thenReturn(mockOptions);</b>
&nbsp;        
&nbsp;        // Create a list of enemies, owned by the mockEnemy
<b class="fc">&nbsp;        Vector&lt;Entity&gt; entitiesVector = createECMEnemy(mockEnemy, mockGame);</b>
<b class="fc">&nbsp;        Mockito.when(mockGame.getEntitiesVector()).thenReturn(entitiesVector);</b>
&nbsp;
&nbsp;        Coords enemyPos;
&nbsp;        ECMInfo enemyECMInfo;
&nbsp;        
&nbsp;        /*********************************************************************/
&nbsp;        // Same Hex Tests
&nbsp;        
&nbsp;        // Attack Entity ECM Info
<b class="fc">&nbsp;        Coords aePos = new Coords(2,2);</b>
<b class="fc">&nbsp;        ECMInfo aeNullECM = null;</b>
<b class="fc">&nbsp;        ECMInfo aeECM = new ECMInfo(6, aePos, mockPlayer, 1, 0);</b>
<b class="fc">&nbsp;        ECMInfo aeAngelECM = new ECMInfo(6, aePos, mockPlayer, 0, 1);</b>
<b class="fc">&nbsp;        ECMInfo aeECCM = new ECMInfo(6, aePos, mockPlayer, 0, 0);</b>
<b class="fc">&nbsp;        aeECCM.setECCMStrength(1);</b>
<b class="fc">&nbsp;        ECMInfo aeAngelECCM = new ECMInfo(6, aePos, mockPlayer, 0, 0);</b>
<b class="fc">&nbsp;        aeAngelECCM.setAngelECCMStrength(1);</b>
&nbsp;        
<b class="fc">&nbsp;        Entity additionalEnemy = Mockito.mock(Tank.class);</b>
<b class="fc">&nbsp;        Mockito.when(additionalEnemy.getOwner()).thenReturn(mockEnemy);</b>
<b class="fc">&nbsp;        Mockito.when(additionalEnemy.getECMInfo()).thenReturn(null);</b>
<b class="fc">&nbsp;        Mockito.when(additionalEnemy.getGame()).thenReturn(mockGame);</b>
&nbsp;        
<b class="fc">&nbsp;        Entity additionalAlly = Mockito.mock(Tank.class);</b>
<b class="fc">&nbsp;        Mockito.when(additionalAlly.getOwner()).thenReturn(mockPlayer);</b>
<b class="fc">&nbsp;        Mockito.when(additionalAlly.getECMInfo()).thenReturn(null);</b>
<b class="fc">&nbsp;        Mockito.when(additionalAlly.getGame()).thenReturn(mockGame);</b>
&nbsp;        
&nbsp;        // Attacking Entity
<b class="fc">&nbsp;        Entity ae = Mockito.mock(Mech.class);</b>
<b class="fc">&nbsp;        entitiesVector.add(ae);</b>
<b class="fc">&nbsp;        Mockito.when(ae.getPosition()).thenReturn(aePos);</b>
<b class="fc">&nbsp;        Mockito.when(ae.getGame()).thenReturn(mockGame);</b>
<b class="fc">&nbsp;        Mockito.when(ae.isINarcedWith(INarcPod.ECM)).thenReturn(false);</b>
<b class="fc">&nbsp;        Mockito.when(ae.getOwner()).thenReturn(mockPlayer);</b>
<b class="fc">&nbsp;        Mockito.when(ae.getECMInfo()).thenReturn(aeNullECM);</b>
&nbsp;        
<b class="fc">&nbsp;        Coords targetPos = new Coords(3,20);</b>
&nbsp;        
&nbsp;        /*********************************************************************/
&nbsp;        // Basic ECM Test
&nbsp;        //  Enemy has ECM, Player has no ECM
&nbsp;        //  Shoud be affected by ECM, no Angel, no ECCM
&nbsp;        boolean result;
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByAngelECM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECCM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
&nbsp;        
&nbsp;        // Basic ECM for Player
&nbsp;        //  Enemy has ECM, Player has ECM
&nbsp;        //  Shoud be affected by ECM, no Angel, no ECCM
<b class="fc">&nbsp;        Mockito.when(ae.getECMInfo()).thenReturn(aeECM);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByAngelECM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECCM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
&nbsp;        
&nbsp;        // Basic Angel ECM for Player
&nbsp;        //  Enemy has ECM, Player has Angel ECM
&nbsp;        //  Shoud be affected by ECM, no Angel, no ECCM
<b class="fc">&nbsp;        Mockito.when(ae.getECMInfo()).thenReturn(aeAngelECM);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByAngelECM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECCM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
&nbsp;        
&nbsp;        // Basic ECCM for Player
&nbsp;        //  Enemy has ECM, Player has ECCM
&nbsp;        //  Shoud not be affected by ECM, no Angel, no ECCM
<b class="fc">&nbsp;        Mockito.when(ae.getECCMInfo()).thenReturn(aeECCM);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByAngelECM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECCM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
&nbsp;        
&nbsp;        // Basic Angel ECCM for Player
&nbsp;        //  Enemy has ECM, Player has Angel ECCM
&nbsp;        //  Shoud not affected by ECM, no Angel, yes ECCM
<b class="fc">&nbsp;        Mockito.when(ae.getECMInfo()).thenReturn(aeAngelECM);</b>
<b class="fc">&nbsp;        Mockito.when(ae.getECCMInfo()).thenReturn(aeAngelECCM);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByAngelECM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECCM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
&nbsp;        
&nbsp;        // Add some Angel ECM to eliminate the ECCM
<b class="fc">&nbsp;        enemyPos = new Coords(4,4);</b>
<b class="fc">&nbsp;        enemyECMInfo = new ECMInfo(6, enemyPos, mockEnemy, 0, 1);</b>
<b class="fc">&nbsp;        Mockito.when(additionalEnemy.getECMInfo()).thenReturn(enemyECMInfo);</b>
<b class="fc">&nbsp;        entitiesVector.add(additionalEnemy);</b>
&nbsp;        
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByAngelECM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECCM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
&nbsp;        
&nbsp;
&nbsp;        
&nbsp;        
<b class="fc">&nbsp;        entitiesVector = createAngelEnemy(mockEnemy, mockGame);</b>
<b class="fc">&nbsp;        entitiesVector.add(ae);</b>
<b class="fc">&nbsp;        Mockito.when(mockGame.getEntitiesVector()).thenReturn(entitiesVector);</b>
<b class="fc">&nbsp;        Mockito.when(ae.getECCMInfo()).thenReturn(null);</b>
&nbsp;        
&nbsp;        /*********************************************************************/
&nbsp;        // Basic Angel ECM Test
&nbsp;        // Enemy has Angel ECM, Player has no EC(C)M 
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByAngelECM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECCM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);    </b>
&nbsp;        
&nbsp;        // Basic Angel ECM for Player
&nbsp;        //  Enemy has Angel ECM, Player has ECM
&nbsp;        //  Shoud be affected by ECM, Angel, no ECCM
<b class="fc">&nbsp;        Mockito.when(ae.getECMInfo()).thenReturn(aeECM);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByAngelECM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECCM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
&nbsp;        
&nbsp;        // Basic Angel ECM for Player
&nbsp;        //  Enemy has Angel ECM, Player has Angel ECM
&nbsp;        //  Shoud be affected by ECM, no Angel, no ECCM
<b class="fc">&nbsp;        Mockito.when(ae.getECMInfo()).thenReturn(aeAngelECM);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByAngelECM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECCM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
&nbsp;        
&nbsp;        // Basic ECCM for Player
&nbsp;        //  Enemy has Angel ECM, Player has ECCM
&nbsp;        //  Shoud be affected by ECM, Angel, no ECCM
<b class="fc">&nbsp;        Mockito.when(ae.getECCMInfo()).thenReturn(aeECCM);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByAngelECM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECCM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
&nbsp;        
&nbsp;        // Basic Angel ECCM for Player
&nbsp;        //  Enemy has Angel ECM, Player has Angel ECCM
&nbsp;        //  Shoud not affected by ECM, no Angel, no ECCM
<b class="fc">&nbsp;        Mockito.when(ae.getECMInfo()).thenReturn(aeAngelECM);</b>
<b class="fc">&nbsp;        Mockito.when(ae.getECCMInfo()).thenReturn(aeAngelECCM);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByAngelECM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECCM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
&nbsp;        
&nbsp;        // Add in another enemy basic ECM
<b class="fc">&nbsp;        enemyPos = new Coords(4,4);</b>
<b class="fc">&nbsp;        enemyECMInfo = new ECMInfo(6, enemyPos, mockEnemy, 1, 0);</b>
<b class="fc">&nbsp;        Mockito.when(additionalEnemy.getECMInfo()).thenReturn(enemyECMInfo);</b>
<b class="fc">&nbsp;        entitiesVector.add(additionalEnemy);</b>
&nbsp;        
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByAngelECM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECCM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
&nbsp;        
&nbsp;        // Replace basic ECM with Angel
<b class="fc">&nbsp;        enemyECMInfo = new ECMInfo(6, enemyPos, mockEnemy, 0, 1);</b>
<b class="fc">&nbsp;        Mockito.when(additionalEnemy.getECMInfo()).thenReturn(enemyECMInfo);</b>
&nbsp;        
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByAngelECM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECCM(ae, aePos, targetPos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
&nbsp;
&nbsp;        // Test whether ECCM range is working properly, on acccount of bug #4577
&nbsp;        // Basic ECCM for Player
&nbsp;        //  Enemy has ECM, Player has ECCM, Enemy ECM outside range of ECCM
&nbsp;        //  Shoud be affected by ECM, no Angel, no ECCM
<b class="fc">&nbsp;        entitiesVector = new Vector&lt;Entity&gt;();</b>
<b class="fc">&nbsp;        Entity enemy1 = Mockito.mock(Mech.class);</b>
<b class="fc">&nbsp;        Coords ecm1Pos = new Coords(14,14);</b>
<b class="fc">&nbsp;        ECMInfo ecm1 = new ECMInfo(6, ecm1Pos, mockEnemy, 1, 0);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getOwner()).thenReturn(mockEnemy);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getECMInfo()).thenReturn(ecm1);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getGame()).thenReturn(mockGame);</b>
<b class="fc">&nbsp;        entitiesVector.add(enemy1);</b>
<b class="fc">&nbsp;        entitiesVector.add(ae);</b>
<b class="fc">&nbsp;        Mockito.when(mockGame.getEntitiesVector()).thenReturn(entitiesVector);</b>
&nbsp;
<b class="fc">&nbsp;        aeECCM = new ECMInfo(6, aePos, mockPlayer, 0, 0);</b>
<b class="fc">&nbsp;        aeECCM.setECCMStrength(1);</b>
<b class="fc">&nbsp;        Mockito.when(ae.getECCMInfo()).thenReturn(aeECCM);</b>
<b class="fc">&nbsp;        Mockito.when(ae.getECMInfo()).thenReturn(null);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECM(ae, aePos, ecm1Pos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByAngelECM(ae, aePos, ecm1Pos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(false, result);</b>
<b class="fc">&nbsp;        result = ComputeECM.isAffectedByECCM(ae, aePos, ecm1Pos);</b>
<b class="fc">&nbsp;        TestCase.assertEquals(true, result);</b>
&nbsp;
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Creates a single enemy with basic ECM owned by the supplied owner and 
&nbsp;     * returning the supplied game.  Other enemies are created without ECM. 
&nbsp;     * 
&nbsp;     * @param owner
&nbsp;     * @param mockGame
&nbsp;     * @return
&nbsp;     */
&nbsp;    private static Vector&lt;Entity&gt; createECMEnemy(IPlayer owner, 
&nbsp;            IGame mockGame) {
<b class="fc">&nbsp;        Vector&lt;Entity&gt; entitiesVector = new Vector&lt;Entity&gt;();</b>
&nbsp;        
&nbsp;        // Add Entity with ECM
<b class="fc">&nbsp;        Entity enemy1 = Mockito.mock(Mech.class);</b>
<b class="fc">&nbsp;        Coords ecm1Pos = new Coords(5,5);</b>
<b class="fc">&nbsp;        ECMInfo ecm1 = new ECMInfo(6, ecm1Pos, owner, 1, 0);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getOwner()).thenReturn(owner);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getECMInfo()).thenReturn(ecm1);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getGame()).thenReturn(mockGame);</b>
<b class="fc">&nbsp;        entitiesVector.add(enemy1);</b>
&nbsp;        
&nbsp;        // Add Entity with ECM out of range
<b class="fc">&nbsp;        enemy1 = Mockito.mock(Mech.class);</b>
<b class="fc">&nbsp;        ecm1Pos = new Coords(20,20);</b>
<b class="fc">&nbsp;        ecm1 = new ECMInfo(6, ecm1Pos, owner, 1, 0);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getOwner()).thenReturn(owner);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getECMInfo()).thenReturn(ecm1);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getGame()).thenReturn(mockGame);</b>
<b class="fc">&nbsp;        entitiesVector.add(enemy1);</b>
&nbsp;        
&nbsp;        // Add several non-ECM enemies
<b class="fc">&nbsp;        enemy1 = Mockito.mock(Tank.class);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getOwner()).thenReturn(owner);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getECMInfo()).thenReturn(null);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getGame()).thenReturn(mockGame);</b>
<b class="fc">&nbsp;        entitiesVector.add(enemy1);</b>
&nbsp;        
<b class="fc">&nbsp;        enemy1 = Mockito.mock(Aero.class);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getOwner()).thenReturn(owner);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getECMInfo()).thenReturn(null);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getGame()).thenReturn(mockGame);</b>
<b class="fc">&nbsp;        entitiesVector.add(enemy1);</b>
&nbsp;        
<b class="fc">&nbsp;        enemy1 = Mockito.mock(BattleArmor.class);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getOwner()).thenReturn(owner);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getECMInfo()).thenReturn(null);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getGame()).thenReturn(mockGame);</b>
<b class="fc">&nbsp;        entitiesVector.add(enemy1);</b>
&nbsp;        
<b class="fc">&nbsp;        enemy1 = Mockito.mock(Mech.class);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getOwner()).thenReturn(owner);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getECMInfo()).thenReturn(null);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getGame()).thenReturn(mockGame);</b>
<b class="fc">&nbsp;        entitiesVector.add(enemy1);</b>
&nbsp;        
<b class="fc">&nbsp;        return entitiesVector;</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Creates a single enemy with Angel ECM owned by the supplied owner and 
&nbsp;     * returning the supplied game. Other enemies are created without ECM.
&nbsp;     * 
&nbsp;     * @param owner
&nbsp;     * @param mockGame
&nbsp;     * @return
&nbsp;     */    
&nbsp;    private static Vector&lt;Entity&gt; createAngelEnemy(IPlayer owner, 
&nbsp;            IGame mockGame) {
<b class="fc">&nbsp;        Vector&lt;Entity&gt; entitiesVector = new Vector&lt;Entity&gt;();</b>
&nbsp;        
&nbsp;        // Attacking Entity
<b class="fc">&nbsp;        Entity enemy1 = Mockito.mock(Mech.class);</b>
<b class="fc">&nbsp;        Coords ecm1Pos = new Coords(5,5);</b>
<b class="fc">&nbsp;        ECMInfo ecm1 = new ECMInfo(6, ecm1Pos, owner, 0, 1);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getOwner()).thenReturn(owner);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getECMInfo()).thenReturn(ecm1);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getGame()).thenReturn(mockGame);</b>
<b class="fc">&nbsp;        entitiesVector.add(enemy1);</b>
&nbsp;        
&nbsp;        // Add Entity with ECM out of range
<b class="fc">&nbsp;        enemy1 = Mockito.mock(Mech.class);</b>
<b class="fc">&nbsp;        ecm1Pos = new Coords(20,20);</b>
<b class="fc">&nbsp;        ecm1 = new ECMInfo(6, ecm1Pos, owner, 1, 0);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getOwner()).thenReturn(owner);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getECMInfo()).thenReturn(ecm1);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getGame()).thenReturn(mockGame);</b>
<b class="fc">&nbsp;        entitiesVector.add(enemy1);</b>
&nbsp;        
&nbsp;        // Add several non-ECM enemies
<b class="fc">&nbsp;        enemy1 = Mockito.mock(Tank.class);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getOwner()).thenReturn(owner);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getECMInfo()).thenReturn(null);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getGame()).thenReturn(mockGame);</b>
<b class="fc">&nbsp;        entitiesVector.add(enemy1);</b>
&nbsp;        
<b class="fc">&nbsp;        enemy1 = Mockito.mock(Aero.class);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getOwner()).thenReturn(owner);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getECMInfo()).thenReturn(null);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getGame()).thenReturn(mockGame);</b>
<b class="fc">&nbsp;        entitiesVector.add(enemy1);</b>
&nbsp;        
<b class="fc">&nbsp;        enemy1 = Mockito.mock(BattleArmor.class);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getOwner()).thenReturn(owner);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getECMInfo()).thenReturn(null);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getGame()).thenReturn(mockGame);</b>
<b class="fc">&nbsp;        entitiesVector.add(enemy1);</b>
&nbsp;        
<b class="fc">&nbsp;        enemy1 = Mockito.mock(Mech.class);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getOwner()).thenReturn(owner);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getECMInfo()).thenReturn(null);</b>
<b class="fc">&nbsp;        Mockito.when(enemy1.getGame()).thenReturn(mockGame);</b>
<b class="fc">&nbsp;        entitiesVector.add(enemy1);</b>
&nbsp;        
<b class="fc">&nbsp;        return entitiesVector;</b>
&nbsp;    }
&nbsp;   
&nbsp;
&nbsp;    
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-04-13 20:57</div>
</div>
</body>
</html>
